<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Erlang to Elixir</title>
    <url>/2017/12/24/Erlang2Elixir/</url>
    <content><![CDATA[<h1>Erlang to Elixir</h1>
<h2 id="åŸºç¡€">åŸºç¡€</h2>
<ul>
<li>åŸå­æœ‰å†’å· <code>:ok</code> æˆ–è€… <code>Atom</code></li>
<li>å˜é‡<code>ok </code></li>
<li><code>"hello"</code> æ˜¯<code>bianry</code> ï¼Œ<code>'hello'</code> æ˜¯<code>list</code></li>
</ul>
<blockquote>
<p><span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ‰€æœ‰å®šä¹‰æ¯”å¦‚<code>def</code> <code>defp</code> ç­‰ç­‰ä»¥<code>p</code>ç»“æŸçš„éƒ½æ˜¯ç§æœ‰çš„</p>
</blockquote>
<ul>
<li>å¯¹åº” Erlangçš„å®å®šä¹‰ï¼š<code>@is_running false</code></li>
<li>record å®šä¹‰ <code>defrecordp</code>  <code>defrecord</code></li>
<li>ç»“æ„ä½“ä½“æ˜¯å­—å…¸çš„ç‰¹æ®Šå½¢å¼ï¼Œå®ƒä»¬çš„é”®æ˜¯é¢„å®šä¹‰çš„ï¼Œä¸€èˆ¬éƒ½æœ‰é»˜è®¤å€¼ã€‚ç»“æ„ä½“å¿…é¡»å®šä¹‰åœ¨æŸä¸ªæ¨¡å—å†…éƒ¨ï¼Œå› æ­¤ä¹Ÿå¿…é¡»é€šè¿‡æ¨¡å—çš„å‘½åç©ºé—´æ¥è®¿é—®ã€‚å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>defstruct</code> å…³é”®å­—ï¼Œåé¢è·Ÿç€å…³é”®å­—åˆ—è¡¨å’Œé»˜è®¤å€¼ (é€šä¿—çš„å°†å°±æ˜¯é”®åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šäº†çš„map)</li>
</ul>
<figure class="highlight elixir"><table><tbody><tr><td class="code"><pre><span class="line">   <span class="class"><span class="keyword">defmodule</span>  <span class="title">Example.User</span></span>  <span class="keyword">do</span>  </span><br><span class="line">    <span class="keyword">defstruct</span>  <span class="symbol">name:</span>  <span class="string">"Sean"</span>,  <span class="symbol">roles:</span>  []  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">iex&gt;  %<span class="title class_">Example</span>.<span class="title class_">User</span>{}</span><br><span class="line">iex&gt;  steve  =  <span class="comment">#Example.User&lt;name: "Steve", roles: []&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<span id="more"></span>
<ul>
<li>æ¨¡å—å®šä¹‰ <code>defmodule</code></li>
<li>elixiré‡Œé¢çš„<code>å®</code>(<code>defmacro</code>)è·Ÿerlangé‡Œçš„<code>å®</code>å®Œå…¨ä¸åŒ,æ¶‰åŠåˆ°å…ƒç¼–ç¨‹</li>
<li>æŠ›å¼‚å¸¸ä¸ç”¨<code>throw</code> ç”¨<code>raise</code></li>
<li>elixir ä¸€åˆ‡å®šä¹‰éƒ½å¿…é¡»åŒ…å«åœ¨ æ¨¡å—é‡Œ<code>defmoudlue XXX do  ... end</code></li>
<li>elixiræœ‰å››ä¸ªå…³é”®å­—å¾ˆé‡è¦  <code>alias</code>  <code>require</code> <code>import</code> <code>use</code>å…·ä½“æ„ä¹‰å‚è€ƒå®˜æ–¹è¯´æ˜æ–‡æ¡£</li>
</ul>
<figure class="highlight elixir"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Alias the module so it can be called as Bar instead of Foo.Bar</span></span><br><span class="line"><span class="keyword">alias</span> <span class="title class_">Foo</span>.<span class="title class_">Bar</span>, <span class="symbol">as:</span> <span class="title class_">Bar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Require the module in order to use its macros</span></span><br><span class="line"><span class="keyword">require</span> <span class="title class_">Foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Import functions from Foo so they can be called without the `Foo.` prefix</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Invokes the custom code defined in Foo as an extension point</span></span><br><span class="line"><span class="keyword">use</span> <span class="title class_">Foo</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>æ§åˆ¶ç»“æ„åœ¨erlangä¸­æœ‰ <code>case</code> <code>if</code>ï¼ŒElixirä¸­æœ‰ <code>case</code> <code>if else</code> <code>unless</code> <code>cond</code> <code>with</code></li>
</ul>
<blockquote>
<p><code>cond</code> ç±»ä¼¼äº erlangä¸­çš„<code>if</code></p>
</blockquote>
<figure class="highlight elixir"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># é‡ç‚¹è¯´æ˜withçš„ç”¨æ³•ï¼Œç®€åŒ–ä»£ç </span></span><br><span class="line"><span class="keyword">case</span> read_line(socket) <span class="keyword">do</span>  </span><br><span class="line"> {<span class="symbol">:ok</span>, data} -&gt;  </span><br><span class="line">	 <span class="keyword">case</span> <span class="title class_">KVServer</span>.<span class="title class_">Command</span>.parse(data) <span class="keyword">do</span>  </span><br><span class="line">		 {<span class="symbol">:ok</span>, command} -&gt;  </span><br><span class="line">				 <span class="title class_">KVServer</span>.<span class="title class_">Command</span>.run(command)  </span><br><span class="line">		 {<span class="symbol">:error</span>, _} = err -&gt;  </span><br><span class="line">				  err  </span><br><span class="line">    <span class="keyword">end</span>  </span><br><span class="line"> {<span class="symbol">:error</span>, _} = err -&gt;  </span><br><span class="line">  err  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨withç®€åŒ–ä¸‹</span></span><br><span class="line"> <span class="keyword">with</span> {<span class="symbol">:ok</span>, data} &lt;- read_line(socket),</span><br><span class="line">         {<span class="symbol">:ok</span>, command} &lt;- <span class="title class_">KVServer</span>.<span class="title class_">Command</span>.parse(data),</span><br><span class="line">         <span class="symbol">do:</span> <span class="title class_">KVServer</span>.<span class="title class_">Command</span>.run(command)</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>å­—ç¬¦ä¸²æ’å€¼ä¸å­—ç¬¦ä¸²æ‹¼æ¥<code>&lt;&gt;</code></li>
</ul>
<blockquote>
<p>iex&gt;  name  =  â€œSeanâ€<br>
iex&gt;  â€œHello #{name}â€<br>
â€œHello Seanâ€<br>
"Hello "  &lt;&gt;  name<br>
â€œHello Seanâ€</p>
</blockquote>
<ul>
<li>elixir  æ²¡æœ‰<code>andalso</code> <code>orelse</code> ï¼›<code>and </code>  <code>or</code>  æ„ä¹‰ä¸erlangä¸åŒ</li>
<li><code>and </code>  <code>or</code>  <code>||</code> <code>&amp;&amp;</code></li>
<li><code>and</code>ï¼Œ<code>or</code> å¯¹åº”Erlangä¸­çš„ <code>andalso</code> å’Œ <code>orelse</code> æ“ä½œç¬¦ã€‚æ‰€ä»¥å®ƒä»¬ä¸ä¼šè®¡ç®—ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ï¼Œè€Œåªä¼šè®¡ç®—ç¬¬äºŒä¸ªå‚æ•°</li>
<li><code>and</code>ã€<code>or</code>ã€<code>not</code>ï¼Œå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°_å¿…é¡»_æ˜¯å¸ƒå°”ç±»å‹ï¼ˆ<code>true</code> å’Œ <code>false</code>ï¼‰</li>
</ul>
<figure class="highlight elixir"><table><tbody><tr><td class="code"><pre><span class="line"><span class="literal">true</span> || <span class="string">"runtime error"</span>  <span class="comment"># true</span></span><br><span class="line"><span class="literal">false</span> || <span class="string">"runtime error"</span> <span class="comment"># "runtime error"</span></span><br><span class="line"><span class="literal">true</span> &amp;&amp; <span class="string">"runtime error"</span> <span class="comment">#  "runtime error"</span></span><br><span class="line"><span class="literal">false</span> &amp;&amp; <span class="string">"runtime error"</span> <span class="comment"># false </span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>map</li>
</ul>
 <figure class="highlight elixir"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="title class_">Erlang</span></span><br><span class="line"> M = <span class="comment">#{a =&gt; 1, 1 =&gt; 1000}.</span></span><br><span class="line"> <span class="comment">#{a := X, X := Z} = M</span></span><br><span class="line"> </span><br><span class="line"> <span class="title class_">Elixir</span></span><br><span class="line"> m = %{<span class="symbol">:a</span> =&gt; <span class="number">1</span>, <span class="number">1</span> =&gt; <span class="number">1000</span>}</span><br><span class="line"> m[m.a]</span><br><span class="line">å­˜å‚¨é”®åªæœ‰åŸå­çš„æ˜ å°„ï¼Œå¯ä»¥ä¸ç”¨ `=&gt;`ï¼Œç›´æ¥ä½¿ç”¨å…³é”®å­—åˆ—è¡¨çš„è¯­æ³•ï¼š</span><br><span class="line"> x = %{<span class="symbol">foo:</span>  <span class="string">"bar"</span>,  <span class="symbol">hello:</span>  <span class="string">"world"</span>}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>^</code> æ“ä½œç¬¦, ä½¿ç”¨ pin æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å°±æ˜¯ç”¨å·²ç»ç»‘å®šçš„å€¼å»åŒ¹é…ï¼Œè€Œä¸æ˜¯é‡æ–°ç»‘å®šä¸€ä¸ªæ–°å€¼</li>
</ul>
<figure class="highlight elixir"><table><tbody><tr><td class="code"><pre><span class="line">iex&gt;  x  =  <span class="number">1</span>  </span><br><span class="line"><span class="number">1</span>  </span><br><span class="line">iex&gt;  ^x  =  <span class="number">2</span>  </span><br><span class="line">**  (<span class="title class_">MatchError</span>)  no  match  of  right  hand  side  <span class="symbol">value:</span>  <span class="number">2</span>  </span><br><span class="line">iex&gt;  {x,  ^x}  =  {<span class="number">2</span>,  <span class="number">1</span>}  </span><br><span class="line">{<span class="number">2</span>,  <span class="number">1</span>} </span><br><span class="line">iex&gt;  x  </span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="å‡½æ•°">å‡½æ•°</h2>
<ul>
<li>å‡½æ•°å¯ä»¥çœç•¥æ‰æ‹¬å·æ¯”å¦‚ fn x, y -&gt; x + y end</li>
<li>åŒ¿åå‡½æ•°</li>
</ul>
<figure class="highlight elixir"><table><tbody><tr><td class="code"><pre><span class="line">f =  <span class="keyword">fn</span>(x, y) -&gt; x + y <span class="keyword">end</span>;</span><br><span class="line">a = &amp;(&amp;<span class="number">1</span> + &amp;<span class="number">2</span>)</span><br><span class="line">f.(<span class="number">1</span>,<span class="number">2</span>)   </span><br><span class="line">a.(<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>æ¨¡å—åé¦–å­—æ¯å¤§å†™ Server.Listener</li>
<li>å‡½æ•°ååæœ‰?è¡¨ç¤ºè¿”å›å€¼ä¸ºboolean æ¯”å¦‚ def is_ok? -&gt; true end</li>
<li>å‡½æ•°ååæœ‰!</li>
</ul>
<figure class="highlight elixir"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ `var!/2` å¯ä»¥è®©æŸä¸ªå˜é‡çš„æ“ä½œå˜æˆå¯¹ä¸Šä¸‹æ–‡å˜é‡çš„æ“ä½œã€‚</span></span><br><span class="line"><span class="comment"># `var!/2`ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ“ä½œ `val` å˜é‡è€Œä¸éœ€è¦å®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ã€‚å®çš„è¿™ç§ä½¿ç”¨æ–¹å¼åº”è¯¥å°½å°‘ä½¿ç”¨ï¼Œå¼•å…¥ `var!/2` ä¼šå¢åŠ å˜é‡å†²çªçš„é£é™©</span></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Example</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">hygienic</span></span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="symbol">do:</span> val = <span class="number">-1</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">unhygienic</span></span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="symbol">do:</span> var!(val) = <span class="number">-1</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">ç„¶åæ¯”è¾ƒä¸€ä¸‹å®ƒä»¬æ˜¯æ€ä¹ˆå’Œä»£ç çš„ä¸Šä¸‹æ–‡äº¤äº’çš„ï¼š</span><br><span class="line">iex&gt; <span class="keyword">require</span> <span class="title class_">Example</span></span><br><span class="line"><span class="literal">nil</span></span><br><span class="line">iex&gt; val = <span class="number">42</span></span><br><span class="line"><span class="number">42</span></span><br><span class="line">iex&gt; <span class="title class_">Example</span>.hygienic</span><br><span class="line"><span class="number">-1</span></span><br><span class="line">iex&gt; val</span><br><span class="line"><span class="number">42</span></span><br><span class="line">iex&gt; <span class="title class_">Example</span>.unhygienic</span><br><span class="line"><span class="number">-1</span></span><br><span class="line">iex&gt; val</span><br><span class="line"><span class="number">-1</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>è®¿é—®Erlangå‡½æ•° :erlang:length([])</li>
<li>æ¨¡å—çš„å‡½æ•°ä¸éœ€è¦exportï¼Œä½¿ç”¨defå®šä¹‰ä¸ºå…¬å…±è®¿é—® defp ä¸ºç§æœ‰</li>
</ul>
<figure class="highlight elixir"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Example</span></span> <span class="keyword">do</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">of_public</span></span> <span class="keyword">do</span></span><br><span class="line">		<span class="title class_">IO</span>.puts <span class="string">"public funtcion"</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line">	<span class="function"><span class="keyword">defp</span> <span class="title">of_private</span></span> <span class="keyword">do</span></span><br><span class="line">		<span class="title class_">IO</span>.puts <span class="string">"private function"</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Example</span>.of_public <span class="comment"># "public funtcion"</span></span><br><span class="line"><span class="title class_">Example</span>.of_private  <span class="comment"># ** (UndefinedFunctionError) function Example.of_private/0 is undefined or </span></span><br><span class="line"><span class="comment"># private Example.of_private()</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="thumbsup"><span class="github-emoji"><span>ğŸ‘</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f44d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></h2>
<ul>
<li>pipeline</li>
</ul>
<h2 id="thumbsdown"><span class="github-emoji"><span>ğŸ‘</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f44e.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></h2>
<ul>
<li>è°ƒç”¨åŒ¿åå‡½æ•°éœ€è¦åŠ ä¸ª<code>.</code></li>
</ul>
]]></content>
      <categories>
        <category>Erlang</category>
      </categories>
      <tags>
        <tag>Erlang</tag>
      </tags>
  </entry>
  <entry>
    <title>Eralngç³»åˆ—æ–‡ç« </title>
    <url>/2017/12/24/Erlang/</url>
    <content><![CDATA[<h1>Eralngç³»åˆ—æ–‡ç« </h1>
<table>
<thead>
<tr>
<th>Author</th>
<th>snail</th>
</tr>
</thead>
<tbody>
<tr>
<td>E-mail</td>
<td><a href="mailto:254262243@qq.com">254262243@qq.com</a></td>
</tr>
</tbody>
</table>
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>ä»ä¸šä»¥æ¥ä¸€ç›´ç”¨C++ï¼Œé¢å¯¹å„ç§é—®é¢˜ç‰¹åˆ«ç®¡ç†ä¸€ä¸ªC++å›¢é˜Ÿæ—¶åœ¨æœåŠ¡å™¨å¥å£®æ€§ã€æ•ˆç‡ç­‰ç­‰æ–¹é¢åšçš„å·¥ä½œåˆå¤šåˆç¹çï¼Œäººå·¥ä»¥åŠå„ç§å·¥å…·é½ä¸Šé˜µï¼Œæ·±æ„Ÿå¿ƒåŠ›äº¤ç˜ã€‚åæ¥æœºç¼˜å·§åˆæ¥è§¦åˆ°Erlangï¼Œåˆè¯†Erlangæ„Ÿè§‰å¾ˆç¥å¥‡æ— ä¸ä¸ºå…¶å„ç§ç‰¹æ€§æ‰€æŠ˜æœã€‚ä½†éšåå®é™…é¡¹ç›®çš„åº”ç”¨è¿‡ç¨‹ä¸­è¿˜æ˜¯å‡ºç°äº†å„ç§é—®é¢˜ï¼Œè™½ç„¶ç›¸å¯¹äºC++éš¾åº¦æœ‰æ‰€é™ä½ï¼Œä½†æ˜¯å¯¹äºC++æœ‰å¤šå¹´çš„ç»éªŒï¼Œåœ¨å¤„ç†å„ç§é—®é¢˜ä¸Šéƒ½æœ‰ç›¸åº”çš„ç»éªŒï¼›ä½†æ˜¯Erlangè¿è¡ŒäºErlang VMä¸Šè¿˜æœ‰å„ç§å°è£…ï¼Œå¦‚æœä¸äº†è§£ä¸€äº›å†…éƒ¨ç»†èŠ‚åœ¨å¤„ç†å„ç§é—®é¢˜æ—¶çœŸæ˜¯æ‘¸ä¸ç€å¤´è„‘ã€‚æˆ‘åœ¨å·¥ä½œä¸­åˆ«äººé—®çš„æœ€å¤šçš„é—®é¢˜æˆ–è€…æˆ‘å½“åˆåœ¨å†™ä»£ç æ—¶æœ€æƒ³çŸ¥é“çš„é—®é¢˜å¤§æ¦‚æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆä¸€ä¸ªè¿›ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—å †ç§¯ä¼šå¯¼è‡´çœŸä¸ªVMæ•ˆç‡ä¸‹é™?<br>
å˜é‡åœ¨ä»€ä¹ˆåœ°æ–¹åˆ†é…åœ¨å †ï¼Ÿæ ˆï¼Ÿè¿˜æ˜¯ä»€ä¹ˆåœ°æ–¹ï¼Ÿ<br>
å¯¹äºå˜é‡ä¸å¯ä»¥å˜æ¯æ¬¡ä¿®æ”¹æ˜¯å¦ä¼šé‡æ–°åˆ†é…?åœ¨å“ªé‡Œåˆ†é…ï¼Ÿæ•ˆç‡æ€ä¹ˆæ ·?<br>
è¿›ç¨‹ä»€ä¹ˆæ—¶å€™GCï¼Ÿæ€æ ·åšGCï¼ŸGCå †è¿›ç¨‹å½±å“ï¼Ÿ<br>
è¿›ç¨‹å†…å­˜(erlang:memory/1) ç”±å“ªäº›éƒ¨åˆ†ç»„æˆï¼Ÿ<br>
æ€æ ·è°ƒä¼˜VMä»¥åŠè‡ªå·±é€»è¾‘çš„ä»£ç ï¼Ÿ<br>
â€¦</p>
</blockquote>
<p>ä¸Šé¢çš„è¿™äº›é—®é¢˜å¦‚æœä¸äº†Erlangçš„è°ƒåº¦å™¨ã€VMã€å†…å­˜ç®¡ç†ç­–ç•¥ã€GCã€ä»¥åŠè¿›ç¨‹çš„å®ç°ç­‰ç­‰å¾ˆéš¾æ‰¾å‡†æ–¹å‘ï¼Œåœ¨<a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒå¾ˆå¤šèµ„æ–™</a>ï¼Œå†™äº†åé¢<a href="#%E6%96%87%E7%AB%A0">å››ä¸ªæ–‡æ¡£</a>ç”¨æ¥å¯¹æˆ‘çœ‹è¿‡çš„èµ„æ–™åšä¸ªæ€»ç»“</p>
<h2 id="æ–‡ç« ">æ–‡ç« </h2>
<ul>
<li>
<a href="/2017/12/24/ErlangScheduler/" title="[Eralng VM Scheduler]">[Eralng VM Scheduler]</a>  
</li>
<li>
<a href="/2017/12/24/ErlangMemoryAllocator/" title="[Eralng Memory Allocator]">[Eralng Memory Allocator]</a>
</li>
<li>
<a href="/2017/12/24/ErlangGarbageCollection/" title="[Eralng Garbage Collection]">[Eralng Garbage Collection]</a>
</li>
<li>
<a href="/2017/12/24/ErlangProcess/" title="[Eralng Process]">[Eralng Process]</a>
</li>
</ul>
<h2 id="å…¶ä»–">å…¶ä»–</h2>
<ul>
<li>
<a href="/2017/12/24/ErlangNodeConnect/" title="[Eralng èŠ‚ç‚¹äº’è”]">[Eralng èŠ‚ç‚¹äº’è”]</a>
</li>
<li>
<a href="/2017/12/24/ReadingNotes/" title="[Eralng è¯»ä¹¦ç¬”è®°]">[Eralng è¯»ä¹¦ç¬”è®°]</a>
</li>
<li>
<a href="/2017/12/24/Erlang2Elixir/" title="[Eralng to Elixir]">[Eralng to Elixir]</a>
</li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<blockquote>
<p><a href="http://blog.yufeng.info/">éœ¸çˆ·çš„åšå®¢</a><br>
<a href="https://happi.github.io/theBeamBook">The Beam Book</a><br>
é«˜ä¼¸ç¼©æ€§ç³»ç»Ÿï¼šErlang/OTPå¤§å‹åˆ†å¸ƒå¼å®¹é”™è®¾è®¡<br>
<a href="https://github.com/ferd">Fred Hebert</a><br>
<a href="https://github.com/garazdawi">Lukas Larsson</a><br>
<a href="https://www.erlang-solutions.com/">Erlang solution</a><br>
<a href="https://github.com/erlang/otp/blob/master/erts/emulator/internal_doc/">Erlang Otp Internal Doc</a><br>
<a href="http://www.erlang-factory.com/">Erlang Factory</a><br>
<a href="http://bit.ly/2FtbBAL">Code BEAM SF</a><br>
<a href="https://codesync.global/">Code Sync</a><br>
å…¶ä»–çš„åšå®¢ã€æ–‡æ¡£ ç­‰ç­‰</p>
</blockquote>
]]></content>
      <categories>
        <category>Erlang</category>
      </categories>
      <tags>
        <tag>Erlang</tag>
      </tags>
  </entry>
  <entry>
    <title>Erlang Garbage Collection</title>
    <url>/2017/12/24/ErlangGarbageCollection/</url>
    <content><![CDATA[<h1>Garbage Collection</h1>
<p>Erlangçš„GCæ˜¯åˆ†ä»£å¤åˆ¶ï¼Œè¿˜æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å‹çš„GCè¿è¡Œåœ¨å…±äº«å †ï¼ˆBinary&gt;64å­—èŠ‚ï¼‰ä¸Š</p>
<h3 id="Private-Heap-GC-ç§æœ‰å †åƒåœ¾å›æ”¶">Private Heap GC ç§æœ‰å †åƒåœ¾å›æ”¶</h3>
<p>ç§æœ‰å †çš„åƒåœ¾å›æ”¶æ˜¯åˆ†ä»£çš„. åˆ†ä»£æœºåˆ¶æŠŠè¿›ç¨‹çš„å †å†…å­˜åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†,å¹´è½»ä»£å’Œå¹´è€ä»£. åŒºåˆ†æ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªè€ƒè™‘, å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨è¿è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ä¹‹åæ²¡æœ‰è¢«å›æ”¶,é‚£ä¹ˆè¿™ä¸ªå¯¹è±¡çŸ­æœŸå†…è¢«å›æ”¶çš„å¯èƒ½æ€§å°±å¾ˆä½. æ‰€ä»¥, å¹´è½»ä»£å°±ç”¨æ¥å­˜å‚¨æ–°åˆ†é…çš„æ•°æ®,å¹´è€ä»£å°±ç”¨æ¥å­˜æ”¾è¿è¡Œä¸€å®šæ¬¡æ•°çš„åƒåœ¾å›æ”¶ä¹‹åä¾ç„¶å¹¸å­˜çš„æ•°æ®. è¿™æ ·çš„åŒºåˆ†å¯ä»¥å¸®åŠ©GCå‡å°‘å¯¹é‚£äº›å¾ˆå¯èƒ½è¿˜ä¸æ˜¯åƒåœ¾çš„æ•°æ®ä¸å¿…è¦çš„æ‰«æ. å¯¹åº”äºæ­¤, Erlangçš„GCæ‰«ææœ‰ä¸¤ä¸ªç­–ç•¥, Generational(Minor) å’Œ Fullsweep(Major). Generational GCåªå›æ”¶å¹´è½»ä»£çš„åŒºåŸŸ, è€ŒFullsweepåˆ™åŒæ—¶å›æ”¶å¹´è½»ä»£å’Œå¹´è€ä»£.</p>
<p><strong>åœºæ™¯ 1</strong>:</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">Spawn &gt; No GC &gt; Terminate</span><br></pre></td></tr></tbody></table></figure>
<p>å‡è®¾ä¸€ä¸ªç”Ÿå­˜æœŸè¾ƒçŸ­çš„è¿›ç¨‹, åœ¨å­˜æ´»æœŸé—´ä½¿ç”¨çš„å †å†…å­˜ä¹Ÿæ²¡æœ‰è¶…è¿‡  _min_heap_size,_é‚£ä¹ˆåœ¨è¿›ç¨‹ç»“æŸæ˜¯å…¨éƒ¨å†…å­˜å³è¢«å›æ”¶.</p>
<p><strong><strong>åœºæ™¯</strong> 2</strong>:</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">Spawn &gt; Fullsweep &gt; Generational &gt; Terminate</span><br></pre></td></tr></tbody></table></figure>
<p>å‡è®¾ä¸€ä¸ªæ–°åˆ›å»ºçš„è¿›ç¨‹,å½“è¿›ç¨‹çš„æ•°æ®å¢é•¿è¶…è¿‡äº†_min_heap_size_æ—¶, fullsweep GCå³è¢«è§¦å‘, å› ä¸ºåœ¨æ­¤ä¹‹å‰è¿˜æ²¡æœ‰ä»»ä½•GCè¢«è§¦å‘,æ‰€ä»¥å †åŒºè¿˜æ²¡æœ‰è¢«åˆ†æˆå¹´è½»ä»£å’Œå¹´è€ä»£. åœ¨ç¬¬ä¸€æ¬¡fullsweep GCç»“æŸä»¥å, å †åŒºå°±ä¼šè¢«åˆ†ä¸ºå¹´è½»ä»£å’Œå¹´è€ä»£äº†, ä»è¿™ä¸ªæ—¶å€™èµ·, GCçš„ç­–ç•¥å°±è¢«åˆ‡æ¢ä¸º generational GCäº†, ç›´åˆ°è¿›ç¨‹ç»“æŸ.</p>
<p><strong><strong>åœºæ™¯</strong> 3</strong>:</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">Spawn &gt; Fullsweep &gt; Generational &gt; Fullsweep &gt; Generational &gt; ... &gt; Terminate</span><br></pre></td></tr></tbody></table></figure>
<p>åœ¨æŸäº›æƒ…æ™¯ä¸‹, GCç­–ç•¥ä¼šä»generationå†åˆ‡æ¢å›fullsweep. ä¸€ç§æƒ…æ™¯æ˜¯, åœ¨è¿è¡Œäº†ä¸€å®šæ¬¡æ•°(fullsweep_after)çš„genereration GCä¹‹å,ç³»ç»Ÿä¼šå†æ¬¡åˆ‡æ¢å›fullsweep. è¿™ä¸ªå‚æ•°fullsweep_afterå¯ä»¥æ˜¯å…¨å±€çš„ä¹Ÿå¯ä»¥æ˜¯å•è¿›ç¨‹çš„. å…¨å±€çš„å€¼å¯ä»¥é€šè¿‡å‡½æ•°erlang:system_info(fullsweep_after)è·å–, è¿›ç¨‹çš„å¯ä»¥é€šè¿‡å‡½æ•°erlang:process_info(self(),garbage_collection)æ¥è·å–. å¦å¤–ä¸€ç§æƒ…æ™¯æ˜¯, å½“generation GC(minor GC)ä¸èƒ½å¤Ÿæ”¶é›†åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´æ—¶. æœ€åä¸€ç§æƒ…å†µæ˜¯, å½“æ‰‹åŠ¨è°ƒç”¨å‡½æ•°garbage_collector(PID)æ—¶. åœ¨è¿è¡Œfullsweepä¹‹å, GCç­–ç•¥å†æ¬¡åˆ‡æ¢å›generation GCç›´åˆ°ä»¥ä¸Šçš„ä»»æ„ä¸€ä¸ªæƒ…æ™¯å†æ¬¡å‡ºç°.</p>
<p><strong><strong>åœºæ™¯</strong> 4</strong>:</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">Spawn &gt; Fullsweep &gt; Generational &gt; Fullsweep &gt; Increase Heap &gt; Fullsweep &gt; ... &gt; Terminate</span><br></pre></td></tr></tbody></table></figure>
<p>å‡è®¾åœ¨åœºæ™¯3é‡Œé¢,ç¬¬äºŒä¸ªfullsweep GCä¾ç„¶æ²¡æœ‰å›æ”¶åˆ°è¶³å¤Ÿçš„å†…å­˜, é‚£ä¹ˆç³»ç»Ÿå°±ä¼šä¸ºè¿›ç¨‹å¢åŠ å †å†…å­˜, ç„¶åè¯¥è¿›ç¨‹å°±å›åˆ°ç¬¬ä¸€ä¸ªåœºæ™¯,åƒåˆšåˆ›å»ºçš„è¿›ç¨‹ä¸€æ ·é¦–å…ˆå¼€å§‹ä¸€ä¸ªfullsweep,ç„¶åå¾ªç¯å¾€å¤.</p>
<span id="more"></span>
<h3 id="Shared-Heap-GC-å…±äº«å †åƒåœ¾å›æ”¶">Shared Heap GC å…±äº«å †åƒåœ¾å›æ”¶</h3>
<ul>
<li>å¤§äº64ä¸ªå­—èŠ‚çš„äºŒè¿›åˆ¶terms,è¢«ç§°ä¸ºReference Counted Binaryã€‚å¯¹Refcçš„binaryè¿›è¡Œsub binaryçš„æ“ä½œï¼Œæ˜¯ä¸ä¼šå¤åˆ¶binaryè€Œæ˜¯å¯¹äºŒè¿›åˆ¶éƒ¨åˆ†çš„å¼•ç”¨ï¼Œè¿™ç§å¼•ç”¨ä¼šå¢åŠ åŸå§‹bianryçš„å¼•ç”¨è®¡æ•°ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æŸäº›é—®é¢˜ï¼Œæ¯”å¦‚æœ‰ä¸ª100Mçš„äºŒè¿›åˆ¶ï¼Œä½†æ˜¯ä½ åªéœ€è¦å®ƒçš„sub bianry åªæœ‰2Mï¼Œå› ä¸ºsub binary çš„åŸå› ä¼šå¯¼è‡´100Mçš„äºŒè¿›åˆ¶é•¿æ—¶é—´é‡Šæ”¾ä¸æ‰ï¼Œè¿™ä¸ªæ—¶å€™æœ€å¥½ä½¿ç”¨copyï¼Œè€Œä¸æ˜¯ä½¿ç”¨sub binaryç›¸å…³çš„æ“ä½œã€‚</li>
<li>å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯é•¿äº‹ä»¶å­˜æ´»çš„ä¸­é—´è¿›ç¨‹ï¼ˆç”¨äºè¯·æ±‚æ§åˆ¶æˆ–è€…æ¶ˆæ¯è·¯ç”±ï¼‰ï¼Œè¿™æ ·ä¸­é—´è¿›ç¨‹è½¬å‘çš„æ¯ä¸ªProcBin ç±»å‹çš„æ¯æ¬¡è½¬å‘éƒ½ä¼šå¢åŠ åŸå§‹binaryçš„å¼•ç”¨è®¡æ•°ï¼Œä½†æ˜¯ç”±äºProcBinç±»å‹åœ¨è¿›ç¨‹å†…éƒ¨ä»…ä»…æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€æœ‰å¯èƒ½ä¼šå¾ˆé•¿æ—¶é—´ä¸ä¼šè¢«é‡Šæ”¾ï¼Œä»è€Œå¯¼è‡´åŸå§‹binaryçš„å¼•ç”¨è®¡æ•°ä¸ä¼šå‡å°‘ï¼Œè¿›è€Œå¯¼è‡´åŸå§‹binaryé•¿æ—¶é—´ä¸èƒ½è¢«é‡Šæ”¾ã€‚å…³äºRefc binaryå†…å­˜æ³„æ¼å¯ä»¥æŸ¥çœ‹<a href="http://ferd.ca/">Fred Hebert</a> çš„ä¹¦ <a href="http://www.erlang-in-anger.com/">Erlang in Anger</a></li>
</ul>
<h3 id="æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯»</h3>
<p>erlangä½¿ç”¨young heap å’Œold heapæ¥åŒºåˆ†æ•°æ®ï¼Œyoung heapæ”¾æ–°æ•°æ®ï¼Œold heapæ”¾æ—§æ•°æ®ï¼Œä¹Ÿå°±æ˜¯gcåå­˜æ´»çš„æ•°æ®ã€‚<br>
<strong>æµ…æ‰«æï¼ˆminor collectionï¼‰</strong><br>
åœ¨young heapä¸­ï¼Œerlangä½¿ç”¨äº†é«˜æ°´ä½çº¿æ¥åŒºåˆ†æ ‡è®°ä¸€æ¬¡ä»¥ä¸Šçš„æ•°æ®å’Œæœªæ ‡è®°çš„æ•°æ®ï¼Œé‚£ä¹ˆyoung heapç§»å…¥old heapçš„å°±æ˜¯è¶…è¿‡é«˜æ°´ä½çº¿çš„æ•°æ®ã€‚<br>
<img src="/images/MinorCollection.png" alt="minor collection"></p>
<p><strong>æ·±æ‰«æï¼ˆmajor collectionï¼‰</strong><br>
æ·±æ‰«ææ˜¯ä¸€èˆ¬å½“old heapç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œerlangä¼šå¯¹young heapå’Œold heapåšæ‰«æï¼ŒæŠŠæœ‰ç”¨çš„æ•°æ®æ”¾å…¥æ–°ç”³è¯·çš„young heapï¼Œåˆ æ‰åŸæ¥çš„heapã€‚æ·±æ‰«æçš„è§¦å‘æ¡ä»¶è¿˜æœ‰æ‰‹åŠ¨æ‰§è¡Œgcï¼Œå’Œgcæ¬¡æ•°è¶…è¿‡fullsweep_afterçš„å‚æ•°é™å®šã€‚<br>
<img src="/images/MajorCollectin.png" alt="minor collection"></p>
<h3 id="äºŒè¿›åˆ¶æ•°æ®åƒåœ¾å›æ”¶æœºåˆ¶">äºŒè¿›åˆ¶æ•°æ®åƒåœ¾å›æ”¶æœºåˆ¶</h3>
<p>heap binariesï¼ˆå¤§å°ä¸åˆ° 64 bytesï¼Œå°±ç›´æ¥å­˜åœ¨è¿›ç¨‹å †å†…ï¼‰å’Œrefc binariesï¼ˆè¶…è¿‡äº†64 bytesï¼Œå°±è¢«ä¿å­˜åˆ°è¿›ç¨‹å¤–çš„å…±äº«å †é‡Œï¼Œå¯ä»¥ç»™èŠ‚ç‚¹å†…æ‰€æœ‰è¿›ç¨‹å…±äº«ï¼‰ã€‚</p>
<ul>
<li>heap binaries</li>
</ul>
<blockquote>
<p>Heap binaries are small binaries, up to 64 bytes, that are stored directly on the process heap. They will be copied when the process is garbage collected and when they are sent as a message. They donâ€™t require any special handling by the garbage collector.<br>
è¿™éƒ¨åˆ†äºŒè¿›åˆ¶èµ°çš„è¿›ç¨‹çš„GCï¼Œä½†æ˜¯æœ‰ä¸ªè™šæ‹ŸäºŒè¿›åˆ¶å †(vheap)æ¥è®¡ç®—è¿™äº›äºŒè¿›åˆ¶çš„ä½¿ç”¨æƒ…å†µï¼ŒåŠ å¿«å†…å­˜å›æ”¶é€Ÿåº¦ã€‚</p>
</blockquote>
<ul>
<li>refc binaries</li>
</ul>
<blockquote>
<p>Refc binaries consist of two parts: an object stored on the process heap, called a ProcBin, and the binary object itself stored outside all process heaps.The binary object can be referenced by any number of ProcBins from any number of processes; the object contains a reference counter to keep track of the number of references, so that it can be removed when the last reference disappears.</p>
</blockquote>
<p>æ•°æ®ä¿å­˜åœ¨è¿›ç¨‹å¤–çš„å…±äº«å †ï¼Œå†æŠŠè¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®çš„åœ°å€ç»™æ‹¥æœ‰è¿™ä¸ªæ•°æ®çš„è¿›ç¨‹ã€‚è¿›ç¨‹å †å†…ä¿å­˜çš„æ˜¯è¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®çš„å¼•ç”¨ï¼Œå«ProcBinã€‚å¦‚æœè¿›ç¨‹æŠŠè¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®å‘ç»™å…¶ä»–è¿›ç¨‹ï¼Œerlangä¹Ÿä¸å†å¤åˆ¶æ•´ä¸ªäºŒè¿›åˆ¶æ•°æ®ï¼Œè€Œæ˜¯ç›´æ¥å†ç”Ÿæˆä¸€ä»½ProcBinåˆ°åˆ«çš„è¿›ç¨‹å †å†…ã€‚é‚£ä¹ˆï¼Œè¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®å°±å¯ä»¥å¤šä¸ªè¿›ç¨‹çš„ProcBinå¼•ç”¨ï¼Œå½“æ²¡æœ‰ä¸€ä¸ªProcBinå¼•ç”¨åˆ°è¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®ï¼Œè¿™ä¸ªäºŒè¿›åˆ¶å°±è¢«erlangå›æ”¶ã€‚</p>
<blockquote>
<p>ProcBinæ˜¯è¿›ç¨‹å †å†…æ•°æ®ï¼Œèµ°çš„æ˜¯è¿›ç¨‹å †æ•°æ®çš„å›æ”¶æ–¹å¼ã€‚</p>
</blockquote>
<ul>
<li>sub binaryä¸match context</li>
</ul>
<blockquote>
<p>A sub binary is created by split_binary/2 and when a binary is matched out in a binary pattern. A sub binary is a reference into a part of another binary (refc or heap binary, never into a another sub binary). Therefore, matching out a binary is relatively cheap because the actual binary data is never copied.</p>
<p>A match context is similar to a sub binary, but is optimized for binary matching; for instance, it contains a direct pointer to the binary data. For each field that is matched out of a binary, the position in the match context will be incremented.</p>
</blockquote>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<ul>
<li>Erlang Garbage Collection Details and Why It Matters <a href="https://hamidreza-s.github.io/erlang%20garbage%20collection%20memory%20layout%20soft%20realtime/2015/08/24/erlang-garbage-collection-details-and-why-it-matters.html">[åŸæ–‡]</a>   <a href="https://blog.csdn.net/swedenfeng/article/details/53897789">[ç¿»è¯‘]</a></li>
<li><a href="https://blog.csdn.net/mycwq/article/details/26613275">Erlangè¿›ç¨‹å †åƒåœ¾å›æ”¶æœºåˆ¶</a></li>
<li><a href="https://blog.csdn.net/mycwq/article/details/26741387">ErlangäºŒè¿›åˆ¶æ•°æ®åƒåœ¾å›æ”¶æœºåˆ¶</a></li>
<li><a href="https://www.cnblogs.com/me-sa/archive/2011/11/13/erlang0014.html">Erlang 0014Erlangåƒåœ¾å›æ”¶æœºåˆ¶</a></li>
<li><a href="https://github.com/erlang/otp/blob/master/erts/emulator/internal_doc/GarbageCollection.md">å®˜æ–¹æ–‡æ¡£</a></li>
</ul>
]]></content>
      <categories>
        <category>Erlang</category>
        <category>gc</category>
      </categories>
      <tags>
        <tag>Erlang</tag>
        <tag>gc</tag>
      </tags>
  </entry>
  <entry>
    <title>ErlangèŠ‚ç‚¹äº’è”</title>
    <url>/2017/12/24/ErlangNodeConnect/</url>
    <content><![CDATA[<h1>ErlangèŠ‚ç‚¹äº’è”</h1>
<h2 id="epmd">epmd</h2>
<ul>
<li>Epmdæ˜¯Erlang Port Mapper Daemonçš„ç¼©å†™ï¼Œåœ¨Erlangé›†ç¾¤ä¸­çš„ä½œç”¨ç›¸å½“äºdnsçš„ä½œç”¨ï¼Œæä¾›èŠ‚ç‚¹åç§°åˆ°ç«¯å£çš„æŸ¥è¯¢æœåŠ¡ï¼Œepmdé»˜è®¤ç»‘å®š4369ç«¯å£ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ ERL_EPMD_PORT=XXXæˆ–è€… erl -epmd_port NNNN æ¥ä¿®æ”¹æ¬¡ç«¯å£</li>
<li>epmdæ–‡æ¡£ï¼š<a href="http://www.erlang.org/doc/man/epmd.html">è¿™é‡Œ</a></li>
<li>epmdåè®®ï¼š<a href="http://www.erlang.org/doc/apps/erts/erl_dist_protocol.html">è¿™é‡Œ</a></li>
</ul>
<blockquote>
<p><img src="http://erlang.org/doc/apps/erts/erl_ext_fig.gif" alt="enter image description here"><br>
<img src="/images/epmd.png" alt="enter image description here"></p>
</blockquote>
<ul>
<li>net_kernelä¼šå¯åŠ¨proto_distæ¯”å¦‚è¯´inet_tcp_distç›‘å¬ç«¯å£,åŒæ—¶æŠŠç«¯å£æŠ¥åˆ°epmd. è¿™æ—¶å€™ertså°±å‡†å¤‡å¥½äº†èŠ‚ç‚¹é€šè®¯ã€‚è¿™æ—¶å€™å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹è¦å’Œæˆ‘ä»¬é€šè®¯çš„æ—¶å€™ï¼Œé¦–å…ˆè¦è¿æ¥ï¼Œæµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</li>
</ul>
<ol>
<li>æ ¹æ®èŠ‚ç‚¹åæ‰¾åˆ°èŠ‚ç‚¹åœ°å€ã€‚</li>
<li>æŸ¥è¯¢èŠ‚ç‚¹çš„4369ç«¯å£,ä¹Ÿå°±æ˜¯epmd,å‘å®ƒè¦èŠ‚ç‚¹å¯¹åº”çš„inet_tcp_distç›‘å¬çš„ç«¯å£ã€‚</li>
<li>å‘èµ·è¿æ¥, æ¡æ‰‹ï¼Œcookieè®¤è¯ï¼Œå¦‚æœæœªæˆæƒå°±å¤±è´¥ã€‚</li>
<li>è®°å½•èŠ‚ç‚¹åç§°å’Œå“åº”çš„ä¿¡æ¯ã€‚</li>
</ol>
<span id="more"></span>
<h2 id="net-kernel">net_kernel</h2>
<ul>
<li>é‡ç‚¹å…³æ³¨ <strong>net_ticktime</strong>å‚æ•°</li>
</ul>
<blockquote>
<p>èŠ‚ç‚¹ä¼šåœ¨æ¯TickTime/4 ç§’æ£€æŸ¥ä¸€ä¸‹è¿æ¥çš„èŠ‚ç‚¹æ˜¯ä¸æ˜¯æ­£å¸¸ï¼Œå¦‚æœè¿ç»­4æ¬¡æ²¡æœ‰æ”¶åˆ°(TickTimeæ—¶é—´å†…)æ²¡æœ‰æ”¶åˆ°å¿ƒè·³æ¶ˆæ¯ï¼Œå°±ä¼šè®¤ä¸ºè¿™ä¸ªèŠ‚ç‚¹æŒ‚äº†</p>
</blockquote>
<p>Specifies the net_kernel tick time. TickTime is given in seconds. Once every TickTime/4 second, all connected nodes are ticked (if anything else has been written to a node) and if nothing has been received from another node within the last four (4) tick times that node is considered to be down. This ensures that nodes which are not responding, for reasons such as hardware errors, are considered to be down.<br>
The time T, in which a node that is not responding is detected, is calculated as: MinT &lt; T &lt; MaxT where:<br>
MinT = TickTime - TickTime / 4<br>
MaxT = TickTime + TickTime / 4<br>
TickTime is by default 60 (seconds). Thus, 45 &lt; T &lt; 75 seconds.<br>
<strong>Note:</strong>  All communicating nodes should have the same TickTime value specified.<br>
<strong>Note:</strong>  Normally, a terminating node is detected immediately.</p>
<p><a href="http://erlang.org/doc/man/net_kernel.html">net_kernel</a><br>
<a href="http://www.erlang.org/doc/man/kernel_app.html">kernel_app</a></p>
<h2 id="èŠ‚ç‚¹äº’è”å¤±è´¥æ’æŸ¥">èŠ‚ç‚¹äº’è”å¤±è´¥æ’æŸ¥</h2>
<blockquote>
<p>æ£€æŸ¥èŠ‚ç‚¹cookie<br>
æ£€æŸ¥otpç‰ˆæœ¬<br>
æ£€æŸ¥æœºå™¨ç½‘ç»œ<br>
æ£€æŸ¥epmdç«¯å£<br>
æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦è¢«ç¦ç”¨net_kernel:allowed()</p>
</blockquote>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a href="http://blog.yufeng.info/archives/539">Erlang epmdçš„è§’è‰²ä»¥åŠä½¿ç”¨</a><br>
<a href="https://www.cnblogs.com/zhongwencool/p/erlang_nodedown.html">æ€æ ·æ¨¡æ‹ŸèŠ‚ç‚¹äº’è¿åçš„å„ç§å¤±è´¥æƒ…å†µ</a><br>
<a href="https://mryufeng.iteye.com/blog/120666">net_adm:ping(Node)å‘ç”Ÿäº†ä»€ä¹ˆ</a></p>
]]></content>
      <categories>
        <category>Erlang</category>
      </categories>
      <tags>
        <tag>Erlang</tag>
      </tags>
  </entry>
  <entry>
    <title>Memory Allocator</title>
    <url>/2017/12/24/ErlangMemoryAllocator/</url>
    <content><![CDATA[<h1>Memory Allocator</h1>
<h3 id="blocks">blocks</h3>
<p>blockæ˜¯Erlang VMéœ€è¦çš„ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œæ¯”å¦‚å‘etsä¸­æ’å…¥çš„æ•°æ®ä¼šå˜æˆä¸€ä¸ªblockï¼ŒErlangè¿›ç¨‹çš„stackå’Œheap ä¹Ÿæ˜¯ä¸€ä¸ªblockï¼›è¿›ç¨‹é—´å‘é€çš„æ¶ˆæ¯åœ¨blockå†…è¢«å¤åˆ¶ã€‚æ€»æ˜¯blockå°±æ˜¯ä¸€å—è¿ç»­çš„C å†…å­˜ã€‚blockä¹Ÿæ˜¯Erlang Allocatorå†…å­˜åˆ†é…çš„åŸºæœ¬å•ä½ã€‚</p>
<h3 id="carriers">carriers</h3>
<p>carriers æ˜¯ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªblockçš„å®¹å™¨ï¼Œcarrierç»“æ„ä¸­æœ‰ä¸ªå¤´éƒ¨ï¼Œç”¨äºæ ‡è¯†carrierçš„ç±»å‹ç­‰ç­‰<br>
carrieræ˜¯18bitå¯¹é½çš„ï¼ˆæ‰€ä»¥æœ€å°å€¼æ˜¯256KBï¼‰</p>
<h3 id="single-block-carriers-and-multi-block-carriers">single-block carriers and multi-block carriers</h3>
<blockquote>
<p>single-block carrier å°±æ˜¯åªåŒ…å«ä¸€ä¸ªblockçš„carrier<br>
multi-block carrier åŒ…å«å¤šä¸ªblockçš„carrier<br>
å°†å¤§å°è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆ +sbct(single block carrier threshol)ï¼‰çš„blockæ”¾äºä¸€ä¸ªsingle-block carrierï¼›å¦åˆ™blockä¼šè¢«æ”¾äºä¸€ä¸ª multi-block carrierä¸­ï¼Œè¿™ä¸ªé˜ˆå€¼å¤šå¤§ç®—å¤§ï¼Œæ˜¯æ ¹æ®å„ä¸ªå®é™…åº”ç”¨åœºæ™¯æ¥å†³å®šçš„ï¼Œæœ‰äº›æƒ…å†µä¸‹256å­—èŠ‚å°±ç®—å¾ˆå¤§ï¼Œæœ‰äº›æƒ…å†µä¸‹å¯èƒ½5MBæ‰ç®—å¤§ï¼›æ‰€ä»¥è¦æ ¹æ®åº”ç”¨åœºæ™¯æ¥è°ƒæ•´è¯¥å€¼ã€‚é»˜è®¤å€¼æ˜¯512KB(The default is half MB)<br>
ä¸€èˆ¬æƒ…å†µæ¥è®²ï¼Œæ‰€æœ‰è‡³å°‘80%-90%çš„æ•°æ®çš„éƒ½åº”è¯¥åœ¨multi-block carrierï¼Œ</p>
</blockquote>
<span id="more"></span>
<p><code>When manipulating the threshold you probably also want to change the size of carriers that are being   allocated. So if you are increasing the size of individual blocks, you will wanting increase the actual   carriers that are being created. So if you increase the threshold to 1 MB, the.. I believe the default size   of multiblock carriers is 2 MB, the smallest one, and it grows up into 8 MB, depending on how many carriers   you have.Since you doubled the initial amount, you might want to double the next one as well, so you   started at 4 MB might grow up to 16 MB, or something of that effect.  </code></p>
<h3 id="main-multi-block-carrier">main multi-block carrier</h3>
<p>æ¯ä¸ªallocatorå®ä¾‹éƒ½æœ‰åˆ›å»º ä¸€ä¸ª ä¸ä¼šè¢«é”€æ¯çš„ â€œmain multiblock carrierâ€, è¿™ä¸ªcarrierçš„å¤§å°ç”±mmbcsæŒ‡å®š</p>
<h3 id="super-carrier">super carrier</h3>
<p>åœ¨R16B03åŠ å…¥ï¼Œåœ¨å¯åŠ¨æ—¶åˆ†é…å¾ˆå¤§ä¸€å—å†…å­˜ä¾›è™šæ‹Ÿæœºä½¿ç”¨çš„ <strong>+MMscç³»åˆ—å‚æ•°è®¾å®š</strong></p>
<blockquote>
<p>åŠ å…¥è¿™ä¸ªçš„åŸå› å‚è€ƒ- <a href="https://www.cnblogs.com/zhengsyao/p/erts_allocators_speech_by_lukas_larsson.html">Erlang è™šæ‹Ÿæœºå†…çš„å†…å­˜ç®¡ç†_Lukas Larssonï¼‰</a>,å¤§æ¦‚æ˜¯ä¸€ä¸ªå®¢æˆ·åœ¨å¯åŠ¨é˜¶æ®µè°ƒç”¨mallocè€—æ—¶20ç§’</p>
</blockquote>
<h3 id="å†…å­˜carrierè¿ç§»">å†…å­˜carrierè¿ç§»</h3>
<p><a href="https://github.com/erlang/otp/blob/master/erts/emulator/internal_doc/CarrierMigration.md">More</a></p>
<h3 id="allocators">allocators</h3>
<p><img src="/images/Allocators.png" alt="system allocators"></p>
<ul>
<li>eheap_alloc(heap)ã€binary_alloc(binary)ã€driver_alloc(driver)ã€ets_alloc(ets) è¿™å‡ ä¸ªåˆ†é…å™¨å¯ä¾›æˆ‘ä»¬è°ƒä¼˜</li>
<li>temp_alloc(temporary)ã€sl_alloc(short lived)ã€std_alloc(standard lived)ã€ll_alloc(long lived)ã€ fix_alloc(fix size) æ˜¯æ¨¡æ‹Ÿå™¨å†…éƒ¨ä½¿ç”¨çš„ã€‚</li>
</ul>
<blockquote></blockquote>
<table>
<thead>
<tr>
<th>allocator</th>
<th>types</th>
</tr>
</thead>
<tbody>
<tr>
<td>temp_alloc</td>
<td><code>cå‡½æ•°</code> <code>temp gc rootset</code> <code>dist msg decode</code></td>
</tr>
<tr>
<td>sl_alloc</td>
<td><code>ets match specs</code> <code>short timers</code> <code>fs select list</code></td>
</tr>
<tr>
<td>std_alloc</td>
<td><code>links</code> <code>monitors</code></td>
</tr>
<tr>
<td>ll_alloc</td>
<td><code>code</code> <code>atoms</code></td>
</tr>
<tr>
<td>fix_alloc</td>
<td><code>process control block</code>  <code>port control block</code></td>
</tr>
<tr>
<td>eheap_alloc</td>
<td><code>heap</code> <code>list</code> <code>tuple</code></td>
</tr>
<tr>
<td>binary_alloc</td>
<td><code>binary</code></td>
</tr>
<tr>
<td>driver_alloc</td>
<td><code>driver</code></td>
</tr>
<tr>
<td>ets_alloc</td>
<td><code>ets</code></td>
</tr>
<tr>
<td>â€¦</td>
<td><code>...</code></td>
</tr>
<tr>
<td>æ›´å¤šæ›´å…·ä½“çš„åœ¨<a href="https://github.com/erlang/otp/blob/master/erts/emulator/beam/erl_alloc.types">è¿™é‡Œ</a></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="åˆ†é…ç­–ç•¥">åˆ†é…ç­–ç•¥</h3>
<table>
<thead>
<tr>
<th>Block oriented</th>
<th>Carrier oriented</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>best fit</code></td>
<td><code>address order first fit carrier best fit</code></td>
</tr>
<tr>
<td><code>address order best fit</code></td>
<td><code>address order first fit  carrier address order best  fit</code></td>
</tr>
<tr>
<td><code>address order first fit</code></td>
<td></td>
</tr>
<tr>
<td><code>good fit</code></td>
<td></td>
</tr>
<tr>
<td><code>a fit</code></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="Carrier-Allocators">Carrier Allocators</h3>
<ul>
<li>mseg_alloc</li>
<li>sys_alloc</li>
</ul>
<h3 id="Statistics">Statistics</h3>
<ul>
<li>erlang:system_info({allocator,Type})</li>
</ul>
<blockquote>
<p>å¤§éƒ¨åˆ†æ˜¾ç¤ºä¸€ç›®äº†ç„¶<br>
blocksã€blocks_sizeã€carriersã€carriers_size éƒ½æ˜¯ä¸€ä¸ªä¸‰å…ƒç»„{_, Current, Max(Last),Max}<br>
block_size å¯ä»¥ç†è§£æˆä½¿ç”¨çš„å†…å­˜<br>
carriers_size å¯ä»¥ç†è§£æˆErlangå‘ç³»ç»Ÿç”³è¯·çš„å†…å­˜</p>
</blockquote>
<h3 id="mbcs-poolä»¥åŠCarrier-è¿ç§»">mbcs_poolä»¥åŠCarrier è¿ç§»</h3>
<blockquote>
<p>carrierè¿ç§»åªèƒ½åŒç±»å‹çš„åˆ†é…å™¨ä¹‹é—´è¿›è¡Œ(Migration of carriers of same type )</p>
</blockquote>
<ul>
<li><a href="http://erlang.org/doc/man/erts_alloc.html#M_acul">+M acul de</a> <a href="https://github.com/erlang/otp/blob/master/erts/emulator/beam/erl_alloc.c#L1301">é»˜è®¤å€¼ get_acul_value</a></li>
<li>è§£å†³çš„é—®é¢˜</li>
</ul>
<blockquote>
<p>å„ç§ç±»å‹çš„åˆ†é…å™¨åœ¨æ¯ä¸ªè°ƒåº¦å™¨ä¸­éƒ½æœ‰ä¸ªå®ä¾‹ï¼Œå¦‚æœæŸä¸ªè°ƒåº¦å™¨æ²¡æœ‰å·¥ä½œï¼Œé‚£ä¹ˆåœ¨æ•´ä¸ªVMçœ‹æ¥å†…å­˜ç¢ç‰‡ç‡å¾ˆé«˜ï¼Œæˆ‘ä»¬åœ¨è®¾  è®¡ç³»ç»Ÿçš„æ—¶å€™ï¼Œé€šå¸¸ä»æ•°æ®é‡å»åæ¨éœ€è¦çš„å†…å­˜ï¼Œä½†æ˜¯å¦‚æœæœ‰ç¢ç‰‡æˆ–è€…æµªè´¹å­˜åœ¨ä¸¥é‡çš„è¯ï¼Œæˆ‘ä»¬å°±æ— æ³•å‡†ç¡®ï¼Œå°±å¯èƒ½å¯¼è‡´ç¾  éš¾ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ€ç›´æ¥çš„ååº”å°±æ˜¯å½“æ¯ä¸ªè°ƒåº¦å™¨æ± å­é‡Œé¢çš„å†…å­˜ä½¿ç”¨ç‡ä½äºä¸€å®šç¨‹åº¦çš„æ—¶å€™ï¼Œå°±æŠŠè¯¥å—å†…å­˜å‡ºè®©å‡º  æ¥ï¼Œè®©æœ‰éœ€è¦çš„è°ƒåº¦å™¨èƒ½å¤Ÿåˆ©ç”¨èµ·æ¥ã€‚è¿™å°±æ˜¯å†…å­˜carriersè¿ç§»è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ã€‚</p>
</blockquote>
<ul>
<li>å¸¦æ¥çš„å½±å“</li>
</ul>
<blockquote>
<p>å†…å­˜ç”³è¯·çš„æ•ˆç‡å°†ä¼šå—åˆ°å½±å“(é™ä½)ï¼Œå…ˆåœ¨è‡ªå·±çš„æ± å­é‡Œæ‰¾ï¼Œä¸æ»¡è¶³å°±å» cpoolæ‰¾ï¼Œåœ¨ä¸æ»¡è¶³å°±å‘ç³»ç»Ÿè¦<br>
å†…éƒ¨ä¸ä»…åœ¨è‡ªå·±çš„æ± å­é‡Œï¼Œè¿˜åœ¨cpoolé‡Œï¼Œæ‰€ä»¥ç»Ÿè®¡å†…å­˜ä½¿ç”¨å¾ˆéº»çƒ¦ï¼Œä½†æ˜¯å¯ç”¨<a href="https://github.com/ferd/recon">recon</a></p>
</blockquote>
<ul>
<li>æ›´è¯¦ç»†è§£é‡Šåœ¨<a href="https://github.com/erlang/otp/blob/master/erts/emulator/internal_doc/CarrierMigration.md">è¿™é‡Œ</a><br>
<img src="/images/MemoryArchitecture.png" alt="Memory Architecture"></li>
</ul>
<h3 id="å…¶ä»–é›¶ç¢">å…¶ä»–é›¶ç¢</h3>
<ul>
<li>æ¯ç§ç±»å‹çš„åˆ†é…å™¨åœ¨æ¯ä¸ªè°ƒåº¦å™¨é‡Œéƒ½æœ‰ä¸ªå®ä¾‹(å‚è€ƒ<a href="#mbcs_pool">mbcs_pool</a>ï¼‰</li>
<li>IDä¸º0åˆ†é…å™¨å®ä¾‹æ˜¯å¼‚æ­¥çº¿ç¨‹(async threads)ä½¿ç”¨çš„å…¨å±€åˆ†é…å™¨</li>
<li>IDä¸º1åˆ†é…å™¨å®ä¾‹æ˜¯è°ƒåº¦å™¨1(scheduler 1)çš„å®ä¾‹ï¼Œä»¥æ­¤ç±»æ¨</li>
<li></li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<ul>
<li><a href="https://github.com/erlang/otp/blob/master/erts/emulator/internal_doc/CarrierMigration.md">CarrierMigration</a></li>
<li><a href="http://erlang.org/doc/man/erts_alloc.html">erts_alloc</a></li>
<li><a href="http://blog.yufeng.info/archives/3118">Erlangå†…å­˜åˆ†é…å™¨ä¹‹mbcs_pool</a></li>
<li><a href="http://blog.yufeng.info/archives/2946">R16B03æ–°å¢åŠ super carrieræ¥å‡å°‘mmapçš„ç³»ç»Ÿè°ƒç”¨</a></li>
<li><a href="https://www.cnblogs.com/zhengsyao/p/erts_allocators_speech_by_lukas_larsson.html">Erlang è™šæ‹Ÿæœºå†…çš„å†…å­˜ç®¡ç†_Lukas Larssonï¼‰</a></li>
<li><a href="https://blog.heroku.com/logplex-down-the-rabbit-hole">Troubleshooting Down the Logplex Rabbit Hole</a></li>
</ul>
]]></content>
      <categories>
        <category>Erlang</category>
        <category>memory allocator</category>
      </categories>
      <tags>
        <tag>Erlang</tag>
      </tags>
  </entry>
  <entry>
    <title>Erlang Process</title>
    <url>/2017/12/24/ErlangProcess/</url>
    <content><![CDATA[<h1>Process</h1>
<h3 id="ä»€ä¹ˆæ˜¯è¿›ç¨‹">ä»€ä¹ˆæ˜¯è¿›ç¨‹</h3>
<p>è¿™é‡Œçš„è¿›ç¨‹ä¸æ˜¯æŒ‡æ“ä½œç³»ç»Ÿæ„ä¹‰ä¸Šçš„è¿›ç¨‹ï¼Œè€Œæ˜¯ä¸€ä¸ªå­¤ç«‹çš„å®ä½“ï¼Œè¿›ç¨‹æ˜¯è¿è¡Œä½ çš„ä»£ç çš„åœ°æ–¹ï¼Œé€šè¿‡å°†é”™è¯¯çš„å½±å“éš”ç¦»åˆ°æ‰§è¡Œé”™è¯¯ä»£ç çš„è¿›ç¨‹ï¼Œè¿›ç¨‹å¯ä»¥ä¿æŠ¤ç³»ç»Ÿå…å—ä»£ç é”™è¯¯çš„å½±å“ã€‚</p>
<h3 id="è¿›ç¨‹å†…å­˜">è¿›ç¨‹å†…å­˜</h3>
<p>è¿›ç¨‹çš„å†…å­˜åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼šæ ˆã€å †ã€é‚®ç®±ã€è¿›ç¨‹æ§åˆ¶å—ï¼ˆProcess Control Blockï¼‰ã€‚</p>
<blockquote>
<p>å¯ä»¥ç”¨ä½¿ç”¨æŸ¥çœ‹å†…éƒ¨è¡¨ç¤ºï¼Œä½†æ˜¯è¿™äº›ä»…ä»…ç”¨æ¥è°ƒè¯•æˆ–è€…ç†è§£å†…éƒ¨æœºåˆ¶ç”¨<br>
hipe_bifs:show_estack/1ã€ hipe_bifs:show_nstack/1ã€hipe_bifs:show_heap/1ã€<br>
hipe_bifs:show_pcb/1ã€ hipe_bifs:show_term/1</p>
</blockquote>
<ul>
<li>å¯ä»¥å‚è€ƒä¸‹é¢ä¸¤å¼ å›¾ç†è§£</li>
</ul>
<span id="more"></span> 
<p><img src="/images/ProcessMemory.png" alt="è¿›ç¨‹å†…å­˜"></p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">           Shared Heap                        Erlang Process Memory Layout                  </span><br><span class="line">                                                                                            </span><br><span class="line">+----------------------------------+      +----------------------------------+              </span><br><span class="line">|                                  |      |                                  |              </span><br><span class="line">|                                  |      |  PID / Status / Registered Name  |       Process</span><br><span class="line">|                                  |      |                                  |       Control</span><br><span class="line">|                                  |      |   Initial Call / Current Call    +----&gt;  Block  </span><br><span class="line">|                                  |      |                                  |       (PCB)  </span><br><span class="line">|                                  |      |         Mailbox Pointers         |              </span><br><span class="line">|                                  |      |                                  |              </span><br><span class="line">|                                  |      +----------------------------------+              </span><br><span class="line">|                                  |      |                                  |              </span><br><span class="line">|                                  |      |        Function Parameters       |              </span><br><span class="line">|                                  |      |                                  |       Process</span><br><span class="line">|                                  |      |         Return Addresses         +----&gt;  Stack  </span><br><span class="line">|                                  |      |                                  |              </span><br><span class="line">|    +--------------+              |      |         Local Variables          |              </span><br><span class="line">|    |              |              |      |                                  |              </span><br><span class="line">|    | +------------+--+           |      +-------------------------------+--+              </span><br><span class="line">|    | |               |           |      |                               |  |              </span><br><span class="line">|    | | +-------------+--+        |      |  ^                            v  +----&gt;  Free   </span><br><span class="line">|    | | |                |        |      |  |                               |       Space  </span><br><span class="line">|    | | | +--------------+-+      |      +--+-------------------------------+              </span><br><span class="line">|    +-+ | |                |      |      |                                  |              </span><br><span class="line">|      +-+ |  Refc Binary   |      |      |  Mailbox Messages (Linked List)  |              </span><br><span class="line">|        +-+                |      |      |                          â€‰       |              </span><br><span class="line">|          +------^---------+      |      |  Compound Terms (List, Tuples)   |       Process</span><br><span class="line">|                 |                |      |                                  +----&gt;  Private</span><br><span class="line">|                 |                |      |     Terms Larger than a word     |       Heap   </span><br><span class="line">|                 |                |      |                                  |              </span><br><span class="line">|                 +--+ ProcBin +-------------+ Pointers to Large Binaries    |              </span><br><span class="line">|                                  |      |                                  |              </span><br><span class="line">+----------------------------------+      +----------------------------------+              </span><br></pre></td></tr></tbody></table></figure>
<h3 id="è¿›ç¨‹æ§åˆ¶å—">è¿›ç¨‹æ§åˆ¶å—</h3>
<p>è®°å½•è¿›ç¨‹çš„å„ç§ä¿¡æ¯çš„ä¸€ä¸ªç»“æ„ï¼Œè¿™ä¸ªç»“æ„çš„æ¯ä¸ªå­—æ®µè®°å½•ç€è¿›ç¨‹çŠ¶æ€ï¼Œå¯¹åº”æºä»£ç ä¸­æœ‰ä¸ªå«åš<code>process</code>çš„ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“ä½äº<a href="https://github.com/erlang/otp/blob/OTP-19.3/erts/emulator/beam/erl_process.h"><code>erl_process.h</code></a></p>
<ul>
<li>PCB å†…éƒ¨ç»“æ„ä»¥åŠéƒ¨åˆ†å­—æ®µçš„å«ä¹‰</li>
</ul>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">---------------------------------------------------------------</span><br><span class="line">Offset| Name        | Value              | *Value             |</span><br><span class="line">    0 | id          | 0x000001d0000003a3 |PID             </span><br><span class="line">   72 | htop        | 0x00007f7f33f15298 |pointers to the top of the heap                   </span><br><span class="line">   96 | hend        | 0x00007f7f33f16540 |points to the stop of the whole heap                  </span><br><span class="line">   88 | heap        | 0x00007f7f33f11470 |points to heap start                 </span><br><span class="line">  104 | heap_sz     | 0x0000000000000a1a | gives the size of the heap in words <span class="params">(hend - heap = heap_sz * <span class="number">8</span> on a <span class="number">64</span> bit machine )</span>                    </span><br><span class="line">   80 | stop        | 0x00007f7f33f16480 |pointers to the top of the stack                   </span><br><span class="line">  592 | gen_gcs     | 0x0000000000000012 |Number of <span class="params">(minor)</span> generational GCs.</span><br><span class="line">  <span class="number">594</span> | max_gen_gcs | <span class="number">0</span>x000000000000ffff |Max minor gen GCs before fullsweep.</span><br><span class="line">  <span class="number">552</span> | high_water  | <span class="number">0</span>x00007f7f33f11c50 |                    |</span><br><span class="line">  <span class="number">560</span> | old_hend    | <span class="number">0</span>x00007f7f33e90648 |                    |</span><br><span class="line">  <span class="number">568</span> | old_htop    | <span class="number">0</span>x00007f7f33e8f8e8 |                    |</span><br><span class="line">  <span class="number">576</span> | old_head    | <span class="number">0</span>x00007f7f33e8e770 |                    |</span><br><span class="line">  <span class="number">112</span> | min_heap_size | <span class="number">0</span>x00000000000000e9 |in words, that the heap starts with <span class="keyword">and</span> which it will <span class="keyword">not</span> shrink smaller than, the default value is <span class="number">233</span>.</span><br><span class="line">  <span class="number">328</span> | rcount      | <span class="number">0</span>x0000000000000000 | suspend count </span><br><span class="line">  <span class="number">336</span> | reds        | <span class="number">0</span>x0000000000002270 | keep track <span class="keyword">of</span> the total number <span class="keyword">of</span> reductions a process has done up until it was last suspended  </span><br><span class="line">   <span class="number">16</span> | tracer      | <span class="number">0</span>xfffffffffffffffb |                    |</span><br><span class="line">   <span class="number">24</span> | trace_fla.. | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">344</span> | group_lea.. | <span class="number">0</span>x0000019800000333 |                    |</span><br><span class="line">  <span class="number">352</span> | flags       | <span class="number">0</span>x0000000000002000 |Trap exit, etc (no trace flags anymore)                    </span><br><span class="line">  <span class="number">360</span> | fvalue      | <span class="number">0</span>xfffffffffffffffb |Exit &amp; Throw value (failure reason)</span><br><span class="line">  <span class="number">368</span> | freason     | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">320</span> | fcalls      | <span class="number">0</span>x00000000000005a2 | keeps the number <span class="keyword">of</span> reductions left to execute   </span><br><span class="line">  <span class="number">384</span> | next        | <span class="number">0</span>x0000000000000000 |next ready(runnable) process  in the ready queue <span class="keyword">of</span> scheduler    </span><br><span class="line">   <span class="number">48</span> | reg         | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">   <span class="number">56</span> | nlinks      | <span class="number">0</span>x00007f7f3cbc0750 |                    |</span><br><span class="line">  <span class="number">616</span> | mbuf        | <span class="number">0</span>x0000000000000000 |a memory area outside <span class="keyword">of</span> a process heap where other processes can safely write data                    </span><br><span class="line">  <span class="number">640</span> | mbuf_sz     | <span class="number">0</span>x0000000000000000 |Total size <span class="keyword">of</span> heap fragments <span class="keyword">and</span> message fragments</span><br><span class="line">  <span class="number">464</span> | dictionary  | <span class="number">0</span>x0000000000000000 | Process Dictionary                   </span><br><span class="line">  <span class="number">472</span> | seq..clock  | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">480</span> | seq..astcnt | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">488</span> | seq..token  | <span class="number">0</span>xfffffffffffffffb |                    |</span><br><span class="line">  <span class="number">496</span> | intial[<span class="number">0</span>]   | <span class="number">0</span>x000000000000320b |                    |</span><br><span class="line">  <span class="number">504</span> | intial[<span class="number">1</span>]   | <span class="number">0</span>x0000000000000c8b |                    |</span><br><span class="line">  <span class="number">512</span> | intial[<span class="number">2</span>]   | <span class="number">0</span>x0000000000000002 |                    |</span><br><span class="line">  <span class="number">520</span> | current     | <span class="number">0</span>x00007f7f3be87c20 | <span class="number">0</span>x000000000000ed8b |</span><br><span class="line">  <span class="number">296</span> | cp          | <span class="number">0</span>x00007f7f3d3a5100 | <span class="number">0</span>x0000000000440848 |</span><br><span class="line">  <span class="number">304</span> | i           | <span class="number">0</span>x00007f7f3be87c38 | <span class="number">0</span>x000000000044353a |</span><br><span class="line">  <span class="number">312</span> | catches     | <span class="number">0</span>x0000000000000001 |                    |</span><br><span class="line">  <span class="number">224</span> | arity       | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">232</span> | arg_reg     | <span class="number">0</span>x00007f7f3cbc04f8 | <span class="number">0</span>x000000000000320b |</span><br><span class="line">  <span class="number">240</span> | max_arg_reg | <span class="number">0</span>x0000000000000006 |                    |</span><br><span class="line">  <span class="number">248</span> | def..reg[<span class="number">0</span>] | <span class="number">0</span>x000000000000320b |                    |</span><br><span class="line">  <span class="number">256</span> | def..reg[<span class="number">1</span>] | <span class="number">0</span>x0000000000000c8b |                    |</span><br><span class="line">  <span class="number">264</span> | def..reg[<span class="number">2</span>] | <span class="number">0</span>x00007f7f33ec9589 |                    |</span><br><span class="line">  <span class="number">272</span> | def..reg[<span class="number">3</span>] | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">280</span> | def..reg[<span class="number">4</span>] | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">288</span> | def..reg[<span class="number">5</span>] | <span class="number">0</span>x00000000000007d0 |                    |</span><br><span class="line">  <span class="number">136</span> | nsp         | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">144</span> | nstack      | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">152</span> | nstend      | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">160</span> | ncallee     | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">   <span class="number">56</span> | ncsp        | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">   <span class="number">64</span> | narity      | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">---------------------------------------------------------------</span><br></pre></td></tr></tbody></table></figure>
<h3 id="é‚®ç®±ä»¥åŠæ¶ˆæ¯ä¼ é€’">é‚®ç®±ä»¥åŠæ¶ˆæ¯ä¼ é€’</h3>
<p>Erlangæ‰€æœ‰çš„è¿›ç¨‹é€šè¿‡æ¶ˆæ¯ç›¸äº’æ²Ÿé€šã€‚<br>
æ¶ˆæ¯æ€ä¹ˆå‘é€å‘¢ï¼Ÿ</p>
<ol>
<li><a href="https://github.com/erlang/otp/blob/OTP-18.0/erts/emulator/beam/erl_message.c#L1031">è®¡ç®—æ¶ˆæ¯çš„å¤§å°</a></li>
<li><a href="https://github.com/erlang/otp/blob/OTP-18.0/erts/emulator/beam/erl_message.c#L1033">åˆ†é…è¶³å¤Ÿç©ºé—´</a>ï¼ˆåœ¨å‘é€è€…è¿›ç¨‹(<code>on_heap</code>)æˆ–è€…åœ¨ä¸åœ¨å‘é€è€…ï¼ˆ<code>off_heap</code>ï¼‰å †ä¸Šï¼‰</li>
<li><a href="https://github.com/erlang/otp/blob/OTP-18.0/erts/emulator/beam/erl_message.c#L1040">å¤åˆ¶æ¶ˆæ¯</a> (ä»å‘é€è€…çš„å †ä¸Šå¤åˆ¶åˆ°æ–°åˆ†é…çš„ç©ºé—´ä¸Š)</li>
<li>åˆ†é…ä¸€ä¸ª<code>ErlMessage</code>ç»“æ„ç”¨äºåŒ…è£…æ¶ˆæ¯</li>
<li>å°†æ¶ˆæ¯(<code>ErlMessage</code>)<a href="https://github.com/erlang/otp/blob/OTP-18.0/erts/emulator/beam/erl_message.c#L502">æ’å…¥</a>  æ¶ˆæ¯æ¥æ”¶è¿›ç¨‹<a href="https://github.com/erlang/otp/blob/OTP-18.0/erts/emulator/beam/erl_process.h#L1042">é‚®ç®±</a>ï¼ˆæˆ–è€…å¤–éƒ¨æ¶ˆæ¯é˜Ÿåˆ—ï¼‰</li>
</ol>
<blockquote>
<p>è¿˜æœ‰è¿›ç¨‹æ¶ˆæ¯ç›¸å…³è®¾ç½®<code>message_queue_data</code> <code>on_heap</code> <code>off_heap</code>, æ˜¯å¦éœ€è¦è®¾ç½®<code>message_queue_data</code> è¦æ ¹æ®å®é™…æƒ…å†µä»¥åŠåŸºå‡†æµ‹è¯•å†³å®šã€‚<a href="https://github.com/erlang/otp/blob/master/erts/emulator/internal_doc/GarbageCollection.md#messages">More</a></p>
</blockquote>
<p><span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> on_heap</p>
<blockquote>
<p>åœ¨ä¸Šé¢ç¬¬äº”æ­¥æ—¶ï¼Œå‘é€æ¶ˆæ¯çš„è¿›ç¨‹åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šé¦–å…ˆå°è¯•è·å–æ¥æ”¶æ¶ˆæ¯è¿›ç¨‹çš„ <code>main lock</code> ï¼Œå¦‚æœèƒ½è·å¾—äº†é”ï¼Œå°±æŠŠæ¶ˆæ¯å†™å…¥ æ¥å—è€…çš„é‚®ç®±ï¼Œå¦åˆ™å°±ä¸ä¼šæŠŠæ¶ˆæ¯å†™å…¥<code>m_buf</code>ä¸­ï¼ˆä¹Ÿç§°ä¸º <code>heap fragments</code>ï¼‰ï¼Œåœ¨è¿›ç¨‹GCçš„æ—¶å¦‚æœæœ‰å¤§é‡çš„æ¶ˆæ¯æ²¡æœ‰è¢«å¤„ç†ï¼Œæ¶ˆæ¯è¢«ç§»åŠ¨åˆ° <code>old heap</code>ï¼Œè¿™å°†ä¼šå¯¼è‡´è¿›ç¨‹å †å†…å­˜å¢é•¿ï¼Œå¹¶æ¶ˆè€—æ›´å¤šçš„å†…å­˜ä½¿ç”¨ã€‚</p>
</blockquote>
<p><span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> off_heap</p>
<blockquote>
<p>åœ¨ä¸Šé¢ç¬¬äº”æ­¥æ—¶ï¼Œä¸ä¼šå°è¯•å»è·å–<code>main lock</code>ï¼Œæ¶ˆæ¯ç›´æ¥å¸å…¥ <code>m_buf</code> ã€‚è™½ç„¶è¿™è¿™å›é™ä½é”å†²çªï¼Œä½†æ˜¯åˆ†é… <code>heap fragment</code>ç›¸æ¯”ç›´æ¥å¸å…¥è¿›ç¨‹å †æ¶ˆè€—æ›´é«˜ï¼Œä¼šå¯¼è‡´æ›´é«˜çš„å†…å­˜ä½¿ç”¨ç‡ï¼Œå¯èƒ½ä¼šå‡ºç°è¿›ç¨‹å †å†…å­˜ç”±å¾ˆå¤šç©ºä½™ï¼Œä½†æ˜¯æ–°çš„æ¶ˆæ¯ä¾ç„¶è¢«å†™å…¥ æ–°çš„ <code>heap fragment</code></p>
</blockquote>
<p><span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åœ¨GCæ—¶å¤„äºé‚®ç®±ï¼ˆ<code>internal message queue</code>ï¼‰ä¸­çš„æ¶ˆæ¯å°†ä¼šè¢«æ£€æŸ¥ï¼Œè€Œå¤„äº"external" <code>message in queue</code>(<code>m_buf</code>)ä¼šè¢«GCå¿½ç•¥ã€‚</p>
<h3 id="è¿›ç¨‹å­—å…¸">è¿›ç¨‹å­—å…¸</h3>
<p>è¿›ç¨‹æœ¬åœ°kvå­˜å‚¨ï¼Œæœ€å¤§ä¼˜åŠ¿æ˜¯æ‰€æœ‰é”®å€¼éƒ½å­˜å‚¨åœ¨è¿›ç¨‹å †å†…å­˜ï¼Œæ•ˆç‡ç›¸å½“çš„é«˜è€Œä¸”ç”±äºåœ¨è¿›ç¨‹å†…éƒ¨ä½¿ç”¨æ‰€ä»¥ä¸ä¼šè¢«å¤åˆ¶ã€‚ï¼ˆæ¶ˆæ¯æˆ–è€…ETSä¸­çš„å˜é‡ä¼šå¤åˆ¶ï¼‰ã€‚ è¿›ç¨‹å­—å…¸æ˜¯ç”±ä¸€ä¸ªæ•°ç»„å®ç°çš„ï¼Œæ¯ä¸ªå“ˆå¸Œå€¼æŒ‡å‘å…·æœ‰é”®å€¼å¯¹çš„æ¡¶(<code>bucket</code>)ã€‚æ¡¶å®é™…ä¸ŠErlangä¸­çš„<code>list</code>,æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå­˜æ”¾äºè¿›ç¨‹å †ä¸Šçš„å…ƒç»„({key, Value})ã€‚<br>
<span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä½†æ˜¯è¿™å¹¶ä¸æ˜¯æ²¡æœ‰ä»£ä»·çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¿›ç¨‹GCæˆ–è€…å½“æ›´æ–°æŸä¸ªkeyå¯¹åº”çš„å€¼æ—¶ï¼Œä¼šå¯¼è‡´æ•´ä¸ªæ¡¶è¢«é‡æ–°åˆ†é…ã€‚</p>
<h3 id="è¿›ç¨‹çŠ¶æ€">è¿›ç¨‹çŠ¶æ€</h3>
<p><img src="/images/ProcessStateMachine.png" alt="è¿›ç¨‹çŠ¶æ€æœº"></p>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<p><a href="https://happi.github.io/theBeamBook">The Beam Book</a></p>
]]></content>
      <categories>
        <category>Erlang</category>
      </categories>
      <tags>
        <tag>Erlang</tag>
      </tags>
  </entry>
  <entry>
    <title>Erlang Scheduler</title>
    <url>/2017/12/24/ErlangScheduler/</url>
    <content><![CDATA[<h1>Erlang Scheduler</h1>
<table>
<thead>
<tr>
<th>Author</th>
<th>snail</th>
</tr>
</thead>
<tbody>
<tr>
<td>E-mail</td>
<td>**@qq.com</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="ç›®å½•">ç›®å½•</h2>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%B0%83%E5%BA%A6">ä»€ä¹ˆæ˜¯è°ƒåº¦</a></li>
<li><a href="#Erlang%E8%B0%83%E5%BA%A6">Erlangè°ƒåº¦</a></li>
<li><a href="#%E8%B0%83%E5%BA%A6%E5%99%A8%E7%9A%84%E5%8E%86%E5%8F%B2">è°ƒåº¦å™¨çš„å†å²</a><br>
- <a href="#Before-R11B">Before R11B</a><br>
- <a href="#In-R11B-and-R12B">In R11B and R12B</a><br>
- <a href="#After-R13B">After R13B</a><br>
- <s><a href="#In-latest-Version">In latest Version</a></s></li>
<li><a href="#%E8%B0%83%E5%BA%A6%E5%99%A8%E9%98%9F%E5%88%97">è°ƒåº¦å™¨é˜Ÿåˆ—</a></li>
<li><a href="#%E8%BF%9B%E7%A8%8B%E8%BF%81%E7%A7%BB/%E7%AA%83%E5%8F%96">è¿›ç¨‹è¿ç§»/çªƒå–</a></li>
<li><a href="#%E6%8E%A7%E5%88%B6%E5%8F%82%E6%95%B0%E4%B8%8EAPI">æ§åˆ¶å‚æ•°ä¸API</a></li>
<li><a href="#%E5%85%B6%E4%BB%96%E9%9B%B6%E7%A2%8E">å…¶ä»–é›¶ç¢</a><br>
- <a href="#Reduction">Reduction </a><br>
- <a href="#Port">Port</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li>
</ul>
<hr>
<p><span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>æœ¬æ–‡æ¡£ä¸­è°ƒåº¦å™¨è°ƒåº¦çš„åŸºæœ¬å•ä½ä½¿ç”¨ç¨‹åºã€æ´»ã€ä»»åŠ¡ç­‰ç­‰ï¼Œå…¶å®å¯ä»¥ç†è§£æˆ <strong>Work</strong>ï¼Œ<em>Work</em>å¯ä»¥æ˜¯å¤„äº<a href="(/md/priv/ProcessStateMachine.png)">å°±ç»ªçŠ¶æ€</a>çš„<a href="http://erlang.org/doc/reference_manual/processes.html">è¿›ç¨‹</a>ã€ <a href="#Port">Port</a> ã€ç³»ç»Ÿäº‹ä»¶ç­‰ç­‰</p>
<hr>
<h3 id="ä»€ä¹ˆæ˜¯è°ƒåº¦">ä»€ä¹ˆæ˜¯è°ƒåº¦</h3>
<ul>
<li>è°ƒåº¦å°±æ˜¯å°†å·¥ä½œåˆ†å‘ç»™å·¥ä½œè€…ï¼Œè¿™äº›å·¥ä½œè€…å¯ä»¥æ˜¯æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹<a href="https://en.wikipedia.org/wiki/Thread_%28computing%29">Native Threads</a>æˆ–<a href="https://en.wikipedia.org/wiki/Green_threads">Green Threads</a>ã€‚è°ƒåº¦å™¨åˆ†ä¸ºä¸¤ç§ï¼š</li>
</ul>
<blockquote>
<p><a href="https://en.wikipedia.org/wiki/Preemption_%28computing%29">æŠ¢å å¼</a><br>
<a href="https://en.wikipedia.org/wiki/Cooperative_multitasking">åä½œå¼</a></p>
</blockquote>
<p>ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜åŠ£ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨<a href="https://en.wikipedia.org/wiki/Preemption_%28computing%29">æŠ¢å å¼</a> ï¼Œå› ä¸ºErlangå°±æ˜¯ä½¿ç”¨çš„è¿™ç§æ–¹å¼ã€‚</p>
<span id="more"></span>
<h3 id="Erlangè°ƒåº¦">Erlangè°ƒåº¦</h3>
<p>Erlangçš„è°ƒåº¦å™¨è¿è¡Œä¸¤ç§ä»»åŠ¡ï¼š<a href="http://erlang.org/doc/reference_manual/processes.html">è¿›ç¨‹</a>ä»»åŠ¡å’Œ <a href="#Port">Port</a> ä»»åŠ¡ï¼ŒåŒæ—¶è´Ÿè´£GCå’Œå†…å­˜ç®¡ç†ã€‚<br>
è°ƒåº¦å™¨èŒè´£æ˜¯é€‰æ‹©è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡å°†æ‰§è¡Œä¸€å®šæ—¶é—´ã€‚æ€æ ·é€‰å–ï¼Ÿæ‰§è¡Œå¤šé•¿æ—¶é—´å‘¢ï¼Ÿ<br>
è°ƒåº¦å™¨åŸºäºä¼˜å…ˆçº§é€‰æ‹©è¦æ‰§è¡Œçš„è¿›ç¨‹ï¼Œå¯¹äºåŒä¸€ä¼˜å…ˆçº§çš„è¿›ç¨‹ä½¿ç”¨è½®è¯¢çš„æ–¹å¼é€‰æ‹©ï¼Œå¦å¤–è¿˜è¦æ ¹æ®<a href="#Reduction"><strong>Reductions</strong></a>æ¥ä¸­æ–­ç¨‹åºè¿è¡Œã€‚reductionæˆ‘ä»¬å¯ä»¥ç†è§£æˆä¸€æ¬¡å‡½æ•°è°ƒç”¨å°±+1çš„ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“å®ƒè¾¾åˆ°æœ€å¤§å€¼<a href="https://github.com/erlang/otp/blob/master/erts/emulator/beam/erl_vm.h#L39">CONTEXT_REDS</a>çš„æ—¶å€™ï¼Œè°ƒåº¦å™¨å°†ä¼šä¸­æ–­å½“å‰è¿›ç¨‹è¿›è¡Œä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼Œé€‰å–æ–°çš„è¿›ç¨‹æ¥æ‰§è¡Œã€‚<br>
è¿›ç¨‹ä¹Ÿæ ¹æ®ä¸€å®šç­–ç•¥(éå¸¸å¤æ‚)åœ¨è°ƒåº¦å™¨ä¹‹é—´åš<a href="#%E8%BF%9B%E7%A8%8B%E8%BF%81%E7%A7%BB/%E7%AA%83%E5%8F%96">å¹³è¡¡</a>ï¼ŒErlangçš„è°ƒåº¦å™¨é‡‡ç”¨å¯å‘å¼ç®—æ³•åœ¨å¤šä¸ªè°ƒåº¦å™¨ä¹‹é—´å¹³è¡¡è´Ÿè½½ï¼Œä»¥ä¾¿å……åˆ†åˆ©ç”¨æ‰€æœ‰CPUæ ¸å¿ƒã€‚é»˜è®¤ç­–ç•¥æ˜¯è®©ä½IDçš„è°ƒåº¦å™¨å…ˆè·‘æ»¡ï¼Œç„¶ååœ¨å¯åŠ¨æ–°çš„ï¼›å½“è´Ÿè½½ä¸‹é™åï¼Œä¼šå…³é—­æ‰éƒ¨åˆ†è°ƒåº¦å™¨ï¼Œè¿›å…¥æ‰€è°“çš„çœç”µæ¨¡å¼ï¼ˆè¯´èƒ½çœç”µï¼Œæˆ‘éƒ½æœ‰ç‚¹æƒ³ç¬‘<span class="github-emoji"><span>ğŸ˜†</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f606.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ï¼‰ã€‚<span class="github-emoji"><span>âš¡</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/26a1.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>è°ƒåº¦å™¨ä¼šæ»åå¯åŠ¨æˆ–è€…åœæ­¢ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ“ä½œçš„ä»£ä»·å¾ˆå¤§ï¼Œåªæœ‰åœ¨å®ƒçœŸæ­£éœ€è¦çš„æ—¶å€™æ‰è¿™æ ·åšã€‚ å¦‚æœæ²¡æœ‰å·¥ä½œå¯åšï¼Œè°ƒåº¦å™¨ä¼šè‡ªæ—‹(Spin)ç­‰ä¸€ä¼šï¼ŒæœŸå¾…æœ‰æ´»åˆ°æ¥ï¼Œå¦‚æœæ´»å„¿æ¥äº†ï¼Œå¯ä»¥ç«‹é©¬å¤„ç†ï¼›å¦‚æœæ²¡æ´»å„¿é‚£åªèƒ½ç¡è§‰ <span class="github-emoji"><span>ğŸ˜´</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f634.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ã€‚<br>
å½“æ‰§è¡Œäº†<a href="https://github.com/erlang/otp/blob/maint-19/erts/emulator/beam/erl_vm.h#L49">INPUT_REDUCTIONS</a>(OTP/19 è¿™ä¸ªå€¼2*CONTEXT_REDS,ä½†æ˜¯åœ¨æœ€æ–°çš„OTP/21æœªæ‰¾åˆ°è¿™ä¸ªå€¼çš„å®šä¹‰)ä¸ªreductions æˆ–è€…æ²¡æœ‰å¯è¿è¡Œçš„è¿›ç¨‹ï¼Œè°ƒåº¦å™¨å°†ä¼šæ”¶å‰²ç³»ç»Ÿåº•å±‚äº‹ä»¶(<a href="(https://github.com/erlang/otp/blob/maint-19/erts/emulator/beam/erl_process.c#L9844)">erl_sys_schedule</a>)</p>
<blockquote>
<p><span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>å…³äºè°ƒåº¦çš„å…¬å¹³æ€§å¯ä»¥å‚è€ƒéœ¸çˆ·çš„æ–‡ç« <a href="http://blog.yufeng.info/archives/3130">Erlangå…¬å¹³è°ƒåº¦çš„è¯¯è§£</a><br>
ç®€å•è¯´VMå°±æ˜¯ä¸ªè¶…å¤§çš„å¾ªç¯ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ï¼š</p>
<ol>
<li>æ‹¿æ¶ˆæ¯</li>
<li>æ‰§è¡Œopcodeæˆ–è€…nif,bif</li>
<li>æ”¶å‰²osåº•å±‚äº‹ä»¶</li>
</ol>
<p>å…¶ä¸­2åœ¨åŠªåŠ›ä¿è¯å…¬å¹³ï¼Œä½†æ˜¯1å’Œ3åœ¨è®¾è®¡å±‚é¢ä¸è€ƒè™‘å…¬å¹³<br>
å–æ¶ˆæ¯ã€‚ erlangçš„æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å•å‘é˜Ÿåˆ—å®ç°çš„ï¼Œæ¶ˆæ¯æ˜¯æŒ‰ç…§å…ˆæ¥ååˆ°çš„é¡ºåºè¿›æ¥çš„ï¼Œè€Œä¸”æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ²¡æœ‰ä¿æŠ¤çš„ï¼Œåªè¦å¯¹ç«¯åŸå› æ‰”æ¶ˆæ¯ï¼Œæ¶ˆæ¯å°±ä¼šè¿›å…¥é˜Ÿåˆ—ã€‚åŒ¹é…çš„æ—¶å€™ï¼Œæ¯”å¦‚æœ‰Nä¸ªåŒ¹é…æ¡ä»¶ï¼ŒMä¸ªæ¶ˆæ¯ï¼Œé‚£ä¹ˆè®¡ç®—é‡æ˜¯N*Mã€‚åœ¨æç«¯çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¿›ç¨‹çš„æ¶ˆæ¯å¤„ç†èƒ½åŠ›è·Ÿä¸ä¸Šï¼Œé©¬ä¸Šå°±ä¼šå‡ºç°é˜Ÿåˆ—çˆ†é•¿ï¼Œç„¶åè®¡ç®—é‡å’Œå†…å­˜æ¿€å¢ï¼Œæœ€ç»ˆå¯¼è‡´VMå¥”æºƒã€‚<br>
å†…å­˜çš„ä½¿ç”¨ã€‚ä»»ä½•æœ‰æ„ä¹‰çš„æ“ä½œéƒ½å·®ä¸å¤šéœ€è¦å†…å­˜é…åˆï¼Œè€Œå†…å­˜æ˜¯ä»åˆ†é…å™¨ä¸­å–çš„ï¼Œè™½ç„¶erlangè®¾è®¡äº†éå¸¸ç²¾å·§çš„å†…å­˜åˆ†é…å™¨ï¼Œæ¯ä¸ªè°ƒåº¦å™¨éƒ½æœ‰ä¸ªè‡ªå·±çš„æ± ã€‚ä½†æ˜¯å‡¡æ˜¯æ± å­ï¼ˆCache)ï¼Œæ€»æœ‰ä¸æ»¡è¶³çš„æ—¶å€™ï¼Œè¿™éƒ¨åˆ†å†…å­˜å°±éœ€è¦å‘åº•å±‚å†…å­˜æ‰¹å‘å™¨æ¯”å¦‚mseg_allocæˆ–è€…sys_allocè¦ï¼Œé‚£å°±ä¸å¯é¿å…çš„ç”¨åˆ°äº†é”ã€‚è¿™ä¸ªé”çš„å†²çªå¯¼è‡´çš„ä¸å…¬å¹³å°±çœ‹ä¸šåŠ¡æ¨¡å¼å’Œé€ åŒ–äº†ã€‚<br>
è¿˜æœ‰æ›´å¤šã€‚è¿™äº›ä¸œè¥¿éƒ½ä¼šç ´åå…¬å¹³æ€§ï¼Œåœ¨å®é™…çš„ç³»ç»Ÿä¸­ä¼šå¾ˆä¸¥é‡ï¼Œå½±å“erlangçš„å…¬å¹³æ€§å£°èª‰ã€‚æ‰€ä»¥æœ€è¿‘erlangè¦å¼•å…¥dirty scheduler, native processç­‰å°è¯•éƒ½æ˜¯ä¸ºäº†å‡å°‘è¿™ç±»é—®é¢˜é€ æˆçš„å½±å“ã€‚<br>
æ¶æ„å¸ˆéœ€è¦æ›´å¤šçš„äº†è§£ç³»ç»Ÿå’Œä¸šåŠ¡ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œåœ¨ä¸šåŠ¡å±‚é¢ä¹Ÿéœ€è¦è®¾è®¡æˆæ›´å…¬å¹³çš„ç³»ç»Ÿ</p>
</blockquote>
<h3 id="è°ƒåº¦å™¨çš„å†å²">è°ƒåº¦å™¨çš„å†å²</h3>
<h4 id="Before-R11B">Before-R11B</h4>
<ul>
<li>Scheduler:Run Queue  1 : 1</li>
</ul>
<blockquote>
<p>è¿™ç§æ–¹å¼æ— éœ€å¯¹æ•°æ®ç»“æ„åŠ é”ï¼Œä½†åŒæ—¶ä¹Ÿæ— æ³•äº«å—å¹¶å‘å¸¦æ¥çš„å¥½å¤„</p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">+--------------------------------------------------------+</span><br><span class="line">|  +-----------------+              +-----------------+  |</span><br><span class="line">|  |    Scheduler    +--------------&gt;     Task # 1    |  |</span><br><span class="line">|  +-----------------+              |     Task # 2    |  |</span><br><span class="line">|                                   |     Task # 3    |  |</span><br><span class="line">|                                   |     Task # N    |  |</span><br><span class="line">|                                   +-----------------+  |</span><br><span class="line">|                                   |    Run Queue    |  |</span><br><span class="line">|                                   +-----------------+  |</span><br><span class="line">+--------------------------------------------------------+</span><br></pre></td></tr></tbody></table></figure>
<h4 id="In-R11B-and-R12B">In R11B and R12B</h4>
<ul>
<li>Scheduler:Run Queue  N : 1</li>
</ul>
<blockquote>
<p>å¯¹æ¯”å‰é¢çš„æ–¹å¼åœ¨å¤šæ ¸ç³»ç»Ÿä¸Šçš„æ€§èƒ½æå‡<br>
<span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>éšç€è°ƒåº¦å™¨æ•°é‡çš„å¢åŠ ï¼Œå…±äº«çš„è¿è¡Œé˜Ÿåˆ—ä¼šæˆä¸ºç“¶é¢ˆ<br>
<span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>å¢åŠ äº†ETSé”çš„å¤æ‚åº¦ï¼Œè¿›è€Œå½±å“Mnesia<br>
<span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>å½“å¤šä¸ªè¿›ç¨‹å‘åŒä¸€ä¸ªè¿›ç¨‹å‘é€æ¶ˆæ¯æ˜¯ï¼Œé”å†²çªå‡ ç‡å¢åŠ <br>
<span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>å½“ä¸€ä¸ªè¿›ç¨‹åœ¨è·å–é”æ—¶ä¼šé˜»å¡è¿›ç¨‹æ‰€åœ¨çš„è°ƒåº¦å™¨</p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">+--------------------------------------------------------+</span><br><span class="line">|  +-----------------+              +-----------------+  |</span><br><span class="line">|  |  Scheduler # 1  +--------------&gt;     Task # 1    |  |</span><br><span class="line">|  |                 |    +---------&gt;                 |  |</span><br><span class="line">|  +-----------------+    |    +----&gt;     Task # 2    |  |</span><br><span class="line">|  +-----------------+    |    |    |     Task # 3    |  |</span><br><span class="line">|  |  Scheduler # 2  +----+    |    |     Task # 4    |  |</span><br><span class="line">|  +-----------------+         |    |     Task # N    |  |</span><br><span class="line">|  +-----------------+         |    +-----------------+  |</span><br><span class="line">|  |  Scheduler # N  +---------+    |    Run Queue    |  |</span><br><span class="line">|  +-----------------+              +-----------------+  |</span><br><span class="line">+--------------------------------------------------------+</span><br></pre></td></tr></tbody></table></figure>
<h4 id="After-R13B">After R13B</h4>
<ul>
<li>Scheduler:Run Queue  N : N</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">+--------------------------------------------------------+</span><br><span class="line">|  +-----------------+-----------------+                 |</span><br><span class="line">|  |  Scheduler # 1  |  Run Queue # 1  &lt;--+              |</span><br><span class="line">|  +-----------------+-----------------+  |              |</span><br><span class="line">|  +-----------------+-----------------+  |              |</span><br><span class="line">|  |  Scheduler # 2  |  Run Queue # 2  &lt;--|-&gt; Migration  |</span><br><span class="line">|  +-----------------+-----------------+  |   Logic      |</span><br><span class="line">|  +-----------------+-----------------+  |              |</span><br><span class="line">|  |  Scheduler # N  |  Run Queue # N  &lt;--+              |</span><br><span class="line">|  +-----------------+-----------------+                 |</span><br><span class="line">+--------------------------------------------------------+</span><br></pre></td></tr></tbody></table></figure>
<h3 id="è°ƒåº¦å™¨å¾ªç¯">è°ƒåº¦å™¨å¾ªç¯:</h3>
<p><span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ä»ç†è§£çš„è§’åº¦ä¸Šçœ‹ï¼Œå¯å°†<a href="https://github.com/erlang/otp/blob/master/erts/emulator/beam/erl_process.c#L9198">è°ƒåº¦å™¨å¾ªç¯ erts_schedule</a>ç†è§£æˆå¦‚ä¸‹æ‰€ç¤º(<a href="https://happi.github.io/theBeamBook/#_the_scheduler_loop">Link</a>)ï¼š</p>
<ol>
<li>Update reduction counters.</li>
<li>Check timers</li>
<li>If needed <a href="https://github.com/erlang/otp/blob/master/erts/emulator/beam/erl_process.c#L4637">check balance</a></li>
<li>If needed migrate processes and ports</li>
<li>Do auxiliary scheduler work</li>
<li>If needed check IO and update time</li>
<li>While needed pick a port task to execute</li>
<li>Pick a process to execute</li>
</ol>
<h3 id="è°ƒåº¦å™¨é˜Ÿåˆ—">è°ƒåº¦å™¨é˜Ÿåˆ—</h3>
<p>ç›®å‰æœ‰ä¸ªå››ä¸ªé˜Ÿåˆ—ï¼ˆä¼˜å…ˆçº§)  <code>low</code>  <code>normal</code>  <code>high</code> <code>max</code>ï¼Œé˜Ÿåˆ—é‡Œçš„è¿›ç¨‹å…¨éƒ¨å¤„äº<a href="/md/priv/ProcessStateMachine.png">runnable</a>çŠ¶æ€</p>
<blockquote>
<p><span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ€»ç»“æ¥è‡ªäº<a href="http://erlang.org/pipermail/erlang-questions/">Erlang MailList</a>ä¸­çš„é—®é¢˜<a href="http://erlang.org/pipermail/erlang-questions/2001-April/003132.html">Erlang Scheduler: what does it do</a>ï¼Œå¯èƒ½å·²ç»è¿‡æ—¶åé¢å†æ ¹æ®æœ€æ–°æ–‡æ¡£åšä¿®æ­£</p>
</blockquote>
<ul>
<li>è°ƒåº¦å™¨ä¼˜å…ˆé€‰æ‹© <code>max</code>é˜Ÿåˆ—é‡Œçš„è¿›ç¨‹æ‰§è¡Œï¼›å¦‚æœè¯¥é˜Ÿåˆ—ä¸ºç©ºåˆ™é€‰æ‹©<code>high</code>é˜Ÿåˆ—é‡Œçš„è¿›ç¨‹æ¥æ‰§è¡Œ</li>
<li><code>normal</code> <code>low</code>å…·æœ‰å…¬å¹³å±æ€§ã€‚å‡è®¾æ²¡æœ‰è¿›ç¨‹åœ¨<code>max</code> <code>high</code>é˜Ÿåˆ—é‡Œï¼Œå½“<code>normal</code>é˜Ÿåˆ—æ‰€æœ‰è¿›ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œæˆ–è€…æ‰§è¡Œäº† 8*<a href="https://github.com/erlang/otp/blob/master/erts/emulator/beam/erl_vm.h#L39">CONTEXT_REDS</a>æ‰ä¼šé€‰æ‹©<code>low</code>é˜Ÿåˆ—é‡Œçš„è¿›ç¨‹æ‰§è¡Œï¼›ä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ï¼Œæ¯”å¦‚<code>normal</code>é˜Ÿåˆ—é‡Œæœ‰æ•°ç™¾ä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯<code>low</code>é˜Ÿåˆ—é‡Œè¿›ç¨‹åªæœ‰å¾ˆå°‘çš„å‡ ä¸ªï¼Œè¿™ç§æƒ…å†µä¸‹<code>low</code>é˜Ÿåˆ—é‡Œè¿›ç¨‹ä¼šä¼˜å…ˆæ‰§è¡Œ</li>
</ul>
<blockquote>
<p><span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ ¹æ®<a href="https://happi.github.io/theBeamBook/#_process_queues">Process Queues</a>åšéƒ¨åˆ†ä¿®æ­£</p>
</blockquote>
<ul>
<li>æ¯ä¸ªè°ƒåº¦å™¨æœ‰ä¸‰ä¸ªé˜Ÿåˆ—åˆ†åˆ«æ˜¯ <code>low normal</code>  <code>high</code> <code>max</code></li>
<li><code>max</code> <code>high</code>è·Ÿå‰é¢çš„ä¸€æ ·</li>
<li><code>low normal</code> æœ‰å·®åˆ«ã€‚å½“è¿›ç¨‹è¢«æ”¾å…¥<code>normal</code>é˜Ÿåˆ—æ˜¯è·å¾—ä¸€ä¸ªè°ƒåº¦å™¨è®¡æ•°ï¼ˆ<em>schedule count</em>ï¼‰1ï¼Œè¢«æ”¾å…¥<code>low</code>è·å¾—ä¸€ä¸ªè°ƒåº¦å™¨è®¡æ•°8ï¼Œä»é˜Ÿé¦–å–å‡ºè¿›ç¨‹æ—¶ï¼Œå°†è°ƒåº¦å™¨è®¡æ•°å‡1ï¼Œè®¡æ•°ä¸º0è¿›ç¨‹è¢«è°ƒåº¦ï¼Œå¦åˆ™å°±è¢«æ”¾åˆ°é˜Ÿå°¾</li>
</ul>
<h3 id="è¿›ç¨‹è¿ç§»-çªƒå–">è¿›ç¨‹è¿ç§»/çªƒå–</h3>
<p><span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <a href="http://erlang.org/euc/08/euc_smp.pdf">Inside the Erlang VM</a><br>
<span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <a href="https://happi.github.io/theBeamBook/#_load_balancing">Load Balancing</a></p>
<blockquote>
<p>è´Ÿè½½å‡è¡¡å™¨çš„å½“å‰ç­–ç•¥æ˜¯å°½å¯èƒ½å°‘åœ°ä½¿ç”¨è°ƒåº¦ç¨‹åºè€Œä¸ä¼šä½¿ä»»ä½•CPUè¿‡è½½ã€‚<br>
æ¯ä¸ªåœ¨onlineçš„è°ƒåº¦çš„æ¯ä¸ªä¼˜å…ˆçº§éƒ½ä¼šæ‰§è¡Œå¦‚ä¸‹æ“ä½œ<br>
å†…éƒ¨å®ç°æ›´ä¸ºå¤æ‚(ç‰¹åˆ«æ˜¯ç‰µæ¶‰åˆ°è¿›ç¨‹ä¼˜å…ˆçº§ï¼Œå¯ä»¥è°ƒåº¦å™¨é›†æˆ offlineç­‰ç­‰)æˆ‘ä»¬å¯ä»¥ç®€å•ç†è§£æˆï¼š</p>
</blockquote>
<ul>
<li>è¿ç§»</li>
</ul>
<blockquote>
<p>è¿ç§»é¦–å…ˆæ˜¯é€šè¿‡è®¾ç½®ä¸€ä¸ªè¿ç§»è®¡åˆ’ï¼Œè®©è°ƒåº¦å™¨åœ¨è¯¥è®¡åˆ’ä¸Šæ‰§è¡Œç›´åˆ°è®¾ç½®ä¸‹ä¸€ä¸ªè®¡åˆ’ï¼Œæ¯ä¸ªè¿è¡Œ<a href="https://github.com/erlang/otp/blob/master/erts/emulator/beam/erl_process.c#L61">2000*[CONTEXT_REDS]</a>è§„çº¦ï¼ˆreductionsï¼‰ï¼Œè°ƒåº¦ç¨‹åºé€šè¿‡æŸ¥çœ‹æ‰€æœ‰è°ƒåº¦ç¨‹åºçš„å·¥ä½œè´Ÿè½½æ¥è®¡ç®—æ¯ä¸ªè°ƒåº¦å™¨çš„æ¯ä¸ªä¼˜å…ˆçº§çš„è¿ç§»è·¯å¾„ã€‚è¿ç§»è·¯å¾„æœ‰ä¸‰ç§å€¼:</p>
<ol>
<li>cleared</li>
<li>migrate to scheduler</li>
<li>immigrate from scheduler</li>
</ol>
<p>å½“ä¸€ä¸ªè¿›ç¨‹å¤„äºå°±ç»ªçŠ¶æ€æ—¶ï¼Œå‡è®¾æœ€åä¸€æ¬¡è°ƒåº¦è¯¥è¿›ç¨‹çš„è°ƒåº¦å™¨ï¼ˆS1ï¼‰<br>
å¦‚æœè¯¥è¿›ç¨‹ä¼˜å…ˆçº§çš„è¿ç§»è·¯å¾„è¢« clearedï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹è¿è¡ŒäºS1<br>
å¦‚æœS1è°ƒåº¦å™¨çš„è¿ç§»ï¼ˆmigrate ï¼‰è·¯å¾„è¢«è®¾ç½®æˆï¼ˆS2ï¼‰ï¼Œä¸”S1ä¸S2çš„run queue éƒ½ä¸å¹³è¡¡ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹å¯èƒ½ä¼šè¢«è¿ç§»åˆ°S2<br>
å½“S1é€‰å–ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œæ—¶ï¼Œå®ƒæ£€æŸ¥ç§»æ°‘è·¯å¾„(immigration path)ï¼Œå¦‚æœè¢«è®¾ç½®æˆS2ä¸”S1ä¸S2çš„run queue éƒ½ä¸å¹³è¡¡ï¼Œé‚£ä¹ˆS1å¯èƒ½ä¼šä»S2çªƒå–ä¸€ä¸ªè¿›ç¨‹</p>
<p>é€šè¿‡æ¯”è¾ƒæ¯ä¸ªè°ƒåº¦ç¨‹åºçš„ç‰¹å®šä¼˜å…ˆçº§çš„æœ€å¤§è¿è¡Œé˜Ÿåˆ—æ¥è®¡ç®—è¿ç§»è·¯å¾„ï¼Œæ¯æ¬¡è°ƒåº¦å™¨loopéƒ½ä¼šæ›´æ–°run queueçš„é•¿åº¦ï¼Œè¿™äº›å€¼ç”¨äºè®¡ç®—run queueçš„å¹³å‡ï¼ˆæœ€å¤§ï¼‰é•¿åº¦<br>
run queueé•¿åº¦ä½äºå¹³å‡é•¿åº¦çš„è°ƒåº¦å™¨ä¼šè¢«æ ‡è®°æˆ immigrationï¼Œå½“è¯¥è°ƒåº¦å™¨ä¼šä»åˆ«çš„é«˜è´Ÿè½½çš„è°ƒåº¦å™¨è¿å…¥ä»»åŠ¡<br>
run queueé•¿åº¦é«˜äºå¹³å‡é•¿åº¦ä¼šè¢«æ ‡è®°æˆemigrationï¼Œè¿›ç¨‹ä¼šä»è¿™ä¸ªè°ƒåº¦å™¨è¿ç§»å‡ºå»</p>
<p>æœ‰ä¸¤ç§æƒ…å†µä¼šå¿½ç•¥ä¸Šé¢çš„æ ‡è®°åšå¼ºåˆ¶è¿ç§»ï¼Œ</p>
<ol>
<li>è°ƒåº¦å™¨offline</li>
<li>è°ƒåº¦å™¨æ£€æµ‹åˆ°æŸäº›ä¼˜å…ˆçº§çš„ä»»åŠ¡ä¸€ç›´æ²¡æœ‰è¿è¡Œ</li>
</ol>
</blockquote>
<ul>
<li>çªƒå–</li>
</ul>
<blockquote>
<p>å¦‚æœä¸€ä¸ªè°ƒåº¦å™¨çš„run queueä¸ºç©ºçš„æ—¶å€™ï¼Œè¯¥è°ƒåº¦å™¨å°†ä¼šå°è¯•ä»åˆ«çš„è°ƒåº¦å™¨çªƒå–ä»»åŠ¡<br>
é¦–å…ˆè¯¥è°ƒåº¦å™¨ä¼šé”ä½è‡ªå·±ï¼Œé˜²æ­¢åˆ«çš„è°ƒåº¦å™¨çªƒå–è‡ªå·±çš„ä»»åŠ¡<br>
ç„¶åè¯¥è°ƒåº¦å™¨ä¼šæ£€æŸ¥æ˜¯å¦æœ‰å¯ä»¥è¢«çªƒå–ä»»åŠ¡çš„éæ´»è·ƒçš„è°ƒåº¦å™¨(inactive schedulers) ï¼Œå¦‚æœæ²¡æœ‰<br>
åœ¨ä»IDæ¯”è‡ªå·±å¤§çš„æ´»è·ƒè°ƒåº¦å™¨å¼€å§‹å°è¯•çªƒå–ä¸€ä¸ªä»»åŠ¡<br>
æ¯æ¬¡æŸ¥çœ‹ä¸€ä¸ªè°ƒåº¦å™¨ï¼Œç„¶åå°è¯•çªƒå–ç›®æ ‡è°ƒå–æœ€é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡<br>
æ‰¾åˆ°å¯ä»¥çªƒå–çš„ä»»åŠ¡å°±æŠŠè¯¥ä»»åŠ¡ä»åˆ«çš„è°ƒåº¦å™¨ç§»åŠ¨åˆ°å½“å‰è°ƒåº¦å™¨<br>
<span class="github-emoji"><span>ğŸ‘</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f44d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä»»åŠ¡çªƒå–çš„æ•ˆç‡å¾ˆé«˜ï¼Œæ‰€ä»¥å½“ä¸€ä¸ªè°ƒåº¦å™¨æ²¡æœ‰å·¥ä½œå¯åšæ—¶ï¼Œåœ¨æ¯æ¬¡è°ƒåº¦å™¨loopä¸­éƒ½ä¼šæ‰§è¡Œ</p>
</blockquote>
<h3 id="æ§åˆ¶å‚æ•°ä¸API">æ§åˆ¶å‚æ•°ä¸API</h3>
<blockquote>
<p><span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> éœ€è¦åœ¨å¯åŠ¨èŠ‚ç‚¹æ—¶é€šè¿‡è¿è¡Œå‚æ•°æ‰èƒ½ç”Ÿæ•ˆ<br>
<span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æœ€å¤§è°ƒåº¦å™¨æ•°ï¼ˆMaxAvailableSchedulersï¼‰å’Œå¯ç”¨è°ƒåº¦å™¨æ•°ï¼ˆOnlineSchedulersï¼‰</p>
</blockquote>
<ul>
<li><a href="http://erlang.org/doc/man/erl.html#+S">+S MaxAvailableSchedulers:OnlineSchedulers</a></li>
<li><a href="http://erlang.org/doc/man/erl.html#+SP">+SP</a> å¯ä»¥ä»¥ç™¾åˆ†æ¯”å½¢å¼è®¾å®šä»¥ä¸Šå‚æ•°</li>
<li><a href="http://erlang.org/doc/man/erl.html#+sbt">+sbt</a> å¯ä»¥ç»‘å®šè°ƒåº¦å™¨åˆ°CPUçš„æŸä¸ªæ ¸å¿ƒä¸Šï¼Œè¿™æ ·è°ƒåº¦å™¨å°±ä¸ä¼šåœ¨CPUæ ¸å¿ƒåˆ‡æ¢</li>
<li><a href="http://erlang.org/doc/man/erl.html#+sub">+sub</a> è®©æ‰€æœ‰è°ƒåº¦å™¨éƒ½å‚ä¸å·¥ä½œï¼Œè€Œä¸”ä¼šåšå¹³è¡¡</li>
<li><a href="http://erlang.org/doc/man/erl.html#+scl">+scl</a>  <em>true</em>é€šè¿‡è¿ç§»æŠŠä»»åŠ¡é›†ä¸­è®©è°ƒåº¦å™¨å…¨é€Ÿå·¥ä½œï¼Œä¸å¤Ÿç”¨å°±å¼€å¯åˆ«çš„è°ƒåº¦å™¨</li>
<li><a href="http://erlang.org/doc/man/erl.html#+IOp">+IOp</a> æ–‡ä»¶æè¿°ç¬¦çš„è½®è¯¢é›†çš„æ•°é‡ <a href="http://blog.yufeng.info/archives/2998">é—®é¢˜æè¿°</a></li>
<li><a href="http://erlang.org/doc/man/erl.html#+IOt">+IOt</a> æ§åˆ¶æŠ•é€’äº‹ä»¶çº¿ç¨‹æ•°é‡<a href="http://blog.yufeng.info/archives/2998">é—®é¢˜æè¿°</a></li>
<li><a href="http://erlang.org/doc/man/erl.html">+A</a> å¼‚æ­¥çº¿ç¨‹æ± çº¿ç¨‹æ•°é‡</li>
</ul>
<blockquote>
<p>å¼‚æ­¥çº¿ç¨‹æ± æ˜¯ä¾›é©±åŠ¨å™¨ä½¿ç”¨çš„ï¼Œä¸»è¦æ˜¯é˜²æ­¢Driverçš„æ“ä½œé•¿æ—¶é—´å ç”¨Erlangè™šæ‹Ÿæœº<br>
<span class="github-emoji"><span>â—</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä»…ä¾› file driver æˆ–è€…ç”¨æˆ·è‡ªå·±å®ç°çš„driverä½¿ç”¨ï¼Œæ‰€ä»¥æœ‰å¤§é‡æ–‡ä»¶æ“ä½œå¯ä»¥å¢å¤§æ­¤å‚æ•°</p>
</blockquote>
<ul>
<li><code>erlang:system_info/1</code>  <code>schedulers | schedulers_online</code></li>
<li><code>erlang:system_flag/2</code>  <code> schedulers_online, OnlineSchedulers</code></li>
<li><code>erlang:statistics(run_queue)</code>ç»Ÿè®¡è¿è¡Œé˜Ÿåˆ—ä¸­å­˜æ”¾äº†å·²ç»å°±ç»ªä½†å°šæœªè¢«è°ƒåº¦å™¨æ‰§è¡Œçš„è¿›ç¨‹</li>
</ul>
<h3 id="å…¶ä»–é›¶ç¢">å…¶ä»–é›¶ç¢</h3>
<h4 id="Reduction">Reduction</h4>
<blockquote>
<p>æ¯ä¸ªè¿›ç¨‹æˆ–è€…portsæ¯æ¬¡è·å¾—<a href="https://github.com/erlang/otp/blob/master/erts/emulator/beam/erl_vm.h#L39">CONTEXT_REDS</a>ä¸ªreductionsã€‚ä»»ä½•æ“ä½œéƒ½ä¼šæ¶ˆè€—reductionsï¼Œæ¯”å¦‚å‡½æ•°è°ƒç”¨ã€è°ƒç”¨BIFs(built-in-functions )ã€è¿›ç¨‹GCã€è¯»å†™ETSã€å‘é€æ¶ˆæ¯ï¼ˆå¦‚æœæ”¶æ¶ˆæ¯çš„è¿›ç¨‹é‚®ç®±ä¸­æ¶ˆæ¯è¶Šå¤šæ¶ˆè€—è¶Šé«˜ï¼‰ã€å‘é€åˆ†å¸ƒå¼æ¶ˆæ¯ã€Portçš„I/Oæ“ä½œç­‰ç­‰éƒ½ä¼šæ¶ˆè€—è¿›ç¨‹çš„reductionsã€‚æ€»ä¹‹è¿›ç¨‹ä¸€åˆ‡æ“ä½œéƒ½ä¼šæ¶ˆè€—reductions<a href="https://happi.github.io/theBeamBook/#_reductions_2">More</a></p>
</blockquote>
<h4 id="Port">Port</h4>
<blockquote>
<p>Portæ˜¯Erlangä¸å¤–éƒ¨ä¸–ç•Œæ²Ÿé€šäº¤æµçš„ä¸€ç§æœºåˆ¶ï¼Œæ¯”å¦‚ Filesã€Socketã€é¢å‘å…¶ä»–ç¨‹åºçš„Pipeéƒ½ç§°ä¹‹ä¸ºPortï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Cä»£ç è‡ªå·±ç»™Erlangå¢åŠ æ–°çš„ "port drivers"<a href="http://erlang.org/doc/reference_manual/ports.html">More</a></p>
</blockquote>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<ul>
<li><a href="http://jlouisramblings.blogspot.co.uk/2013/01/how-erlang-does-scheduling.html">How Erlang Does Scheduling</a></li>
<li><a href="https://hamidreza-s.github.io/erlang/scheduling/real-time/preemptive/migration/2016/02/09/erlang-scheduler-details.html">Erlang Scheduler Details and Why It Matters</a> <a href="https://blog.csdn.net/qq_31369609/article/details/51834576">ä¸­æ–‡</a></li>
<li><a href="http://erlang.org/euc/08/euc_smp.pdf">Inside the Erlang VM</a></li>
<li><a href="http://erlang.org/pipermail/erlang-questions/2001-April/003132.html">Erlang Scheduler: What Does It Do</a></li>
<li><a href="https://blog.yufeng.info/archives/3149">R17æ–°çš„è°ƒåº¦ç­–ç•¥+sub</a></li>
<li><a href="http://blog.yufeng.info/archives/2998">Erlangç½‘ç»œå¯†é›†å‹æœåŠ¡å™¨çš„ç“¶é¢ˆå’Œè§£å†³æ€è·¯</a></li>
<li><a href="http://blog.yufeng.info/archives/3130">Erlangå…¬å¹³è°ƒåº¦çš„è¯¯è§£</a></li>
<li><a href="https://happi.github.io/theBeamBook/#CH-Scheduling">Scheduling</a></li>
<li><a href="http://www.erlang-factory.com/static/upload/media/14979662889302503kennethlundinerlangvmnewsregardingdirtyschedulersandio.pdf">Erlang VM News Regarding Dirty Schedulers and I/O</a></li>
</ul>
]]></content>
      <categories>
        <category>Erlang</category>
      </categories>
      <tags>
        <tag>Erlang</tag>
      </tags>
  </entry>
  <entry>
    <title>Erlang è¯»ä¹¦ç¬”è®°</title>
    <url>/2017/12/24/ReadingNotes/</url>
    <content><![CDATA[<h1>Erlang è¯»ä¹¦ç¬”è®°</h1>
<ul>
<li>erlang:byte_size/0æŸ¥çœ‹binaryçš„å­—èŠ‚æ•°é‡</li>
<li>erts_debug:flat_sizeæŸ¥çœ‹å˜é‡æ‰€å çš„å†…å­˜å­—èŠ‚æ•°</li>
<li>erlang timeoutçš„è¯­ä¹‰æ˜¯ä¿è¯äº‹ä»¶ä¸ä¼šå†ç»™å®šçš„æ—¶é—´ä¹‹å‰è§¦å‘ï¼Œå°±æ˜¯è§¦å‘æ—¶é—´&gt;=ç»™å®šçš„æ—¶é—´</li>
<li>Terms are created on the heap by evaluating expressions.</li>
</ul>
<blockquote>
<p>There are two major types of terms:<br>
<a href="https://github.com/erlang/otp/blob/OTP-18.0/erts/emulator/beam/erl_term.h#L88-L97">immediate terms</a> which require no heap space (small integers, atoms, pids, port ids etc) and cons<br>
<a href="https://github.com/erlang/otp/blob/OTP-18.0/erts/emulator/beam/erl_term.h#L106-L120">boxed terms</a> (tuple, big num, binaries etc) that do require heap space.<br>
Immediate terms do not need any heap space because they are embedded into the containing structure.</p>
</blockquote>
<span id="more"></span>
<ul>
<li>è¿›ç¨‹å­—å…¸å®ç°</li>
</ul>
<blockquote>
<p>ç”±æ•°ç»„å®ç°hashç»“æ„ï¼Œæ¯ä¸ªéƒ½æ˜¯é”®å€¼å¯¹å­˜æ”¾äºè¿›ç¨‹çš„Heapä¸Š<br>
æ ¹æ®keyæ¥ç®—hashå€¼ï¼Œæ²¡æœ‰å†²çªå°±æŠŠ{Keyï¼ŒVal}å­˜å…¥æ•°ç»„&gt; å¦‚æœæœ‰keyå†²çªå°±æ˜¯å­˜ä»ä¸€ä¸ªé”®å€¼å¯¹åˆ—è¡¨ï¼Œå¦‚æœè¦æ›´æ–°ä¸€ä¸ªKeyï¼Œå°†ä¼šå¯¼è‡´æ•´ä¸ªbucketè¢«é‡æ–°åˆ†é…ï¼Œç¡®ä¿æ²¡æœ‰è·å–åˆ° ä»old heapæŒ‡å‘ new heapçš„æŒ‡é’ˆ</p>
</blockquote>
<ul>
<li>è¿›ç¨‹çš„å†…å­˜ç”± stack ã€heapã€ mailboxã€ PCBæ„æˆ</li>
</ul>
<blockquote>
<p>stackï¼šå‡½æ•°è¿”å›åœ°å€ã€å‡½æ•°å‚æ•°ã€å±€éƒ¨å˜é‡<br>
heap: lists ã€tuple<br>
mailbox:å¾…å¤„ç†çš„æ¶ˆæ¯<br>
PCBï¼š è¿›ç¨‹æ§åˆ¶å—</p>
</blockquote>
<ul>
<li>å¯ä»¥ä½¿ç”¨hipe_bifs:show_*æŸ¥çœ‹è¿›ç¨‹æ ˆã€å †ã€PCB å†…å­˜æ•°æ® <em><strong>ï¼ˆä»…ä¾›è°ƒè¯•ï¼‰</strong></em></li>
</ul>
<blockquote>
<p>hipe_bifs:show_estack/1<br>
hipe_bifs:show_heap/1<br>
hipe_bifs:show_pcb/1</p>
</blockquote>
<ul>
<li>PCB å†…éƒ¨ç»“æ„</li>
</ul>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">---------------------------------------------------------------</span><br><span class="line">Offset| Name        | Value              | *Value             |</span><br><span class="line">    0 | id          | 0x000001d0000003a3 |PID             </span><br><span class="line">   72 | htop        | 0x00007f7f33f15298 |pointers to the top of the heap                   </span><br><span class="line">   96 | hend        | 0x00007f7f33f16540 |points to the stop of the whole heap                  </span><br><span class="line">   88 | heap        | 0x00007f7f33f11470 |points to heap start                 </span><br><span class="line">  104 | heap_sz     | 0x0000000000000a1a | gives the size of the heap in words <span class="params">(hend - heap = heap_sz * <span class="number">8</span> on a <span class="number">64</span> bit machine )</span>                    </span><br><span class="line">   80 | stop        | 0x00007f7f33f16480 |pointers to the top of the stack                   </span><br><span class="line">  592 | gen_gcs     | 0x0000000000000012 |Number of <span class="params">(minor)</span> generational GCs.</span><br><span class="line">  <span class="number">594</span> | max_gen_gcs | <span class="number">0</span>x000000000000ffff |Max minor gen GCs before fullsweep.</span><br><span class="line">  <span class="number">552</span> | high_water  | <span class="number">0</span>x00007f7f33f11c50 |                    |</span><br><span class="line">  <span class="number">560</span> | old_hend    | <span class="number">0</span>x00007f7f33e90648 |                    |</span><br><span class="line">  <span class="number">568</span> | old_htop    | <span class="number">0</span>x00007f7f33e8f8e8 |                    |</span><br><span class="line">  <span class="number">576</span> | old_head    | <span class="number">0</span>x00007f7f33e8e770 |                    |</span><br><span class="line">  <span class="number">112</span> | min_heap_size | <span class="number">0</span>x00000000000000e9 |in words, that the heap starts with <span class="keyword">and</span> which it will <span class="keyword">not</span> shrink smaller than, the default value is <span class="number">233</span>.</span><br><span class="line">  <span class="number">328</span> | rcount      | <span class="number">0</span>x0000000000000000 | suspend count </span><br><span class="line">  <span class="number">336</span> | reds        | <span class="number">0</span>x0000000000002270 | keep track <span class="keyword">of</span> the total number <span class="keyword">of</span> reductions a process has done up until it was last suspended  </span><br><span class="line">   <span class="number">16</span> | tracer      | <span class="number">0</span>xfffffffffffffffb |                    |</span><br><span class="line">   <span class="number">24</span> | trace_fla.. | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">344</span> | group_lea.. | <span class="number">0</span>x0000019800000333 |                    |</span><br><span class="line">  <span class="number">352</span> | flags       | <span class="number">0</span>x0000000000002000 |Trap exit, etc (no trace flags anymore)                    </span><br><span class="line">  <span class="number">360</span> | fvalue      | <span class="number">0</span>xfffffffffffffffb |Exit &amp; Throw value (failure reason)</span><br><span class="line">  <span class="number">368</span> | freason     | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">320</span> | fcalls      | <span class="number">0</span>x00000000000005a2 | keeps the number <span class="keyword">of</span> reductions left to execute   </span><br><span class="line">  <span class="number">384</span> | next        | <span class="number">0</span>x0000000000000000 |next ready(runnable) process  in the ready queue <span class="keyword">of</span> scheduler    </span><br><span class="line">   <span class="number">48</span> | reg         | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">   <span class="number">56</span> | nlinks      | <span class="number">0</span>x00007f7f3cbc0750 |                    |</span><br><span class="line">  <span class="number">616</span> | mbuf        | <span class="number">0</span>x0000000000000000 |a memory area outside <span class="keyword">of</span> a process heap where other processes can safely write data                    </span><br><span class="line">  <span class="number">640</span> | mbuf_sz     | <span class="number">0</span>x0000000000000000 |Total size <span class="keyword">of</span> heap fragments <span class="keyword">and</span> message fragments</span><br><span class="line">  <span class="number">464</span> | dictionary  | <span class="number">0</span>x0000000000000000 | Process Dictionary                   </span><br><span class="line">  <span class="number">472</span> | seq..clock  | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">480</span> | seq..astcnt | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">488</span> | seq..token  | <span class="number">0</span>xfffffffffffffffb |                    |</span><br><span class="line">  <span class="number">496</span> | intial[<span class="number">0</span>]   | <span class="number">0</span>x000000000000320b |                    |</span><br><span class="line">  <span class="number">504</span> | intial[<span class="number">1</span>]   | <span class="number">0</span>x0000000000000c8b |                    |</span><br><span class="line">  <span class="number">512</span> | intial[<span class="number">2</span>]   | <span class="number">0</span>x0000000000000002 |                    |</span><br><span class="line">  <span class="number">520</span> | current     | <span class="number">0</span>x00007f7f3be87c20 | <span class="number">0</span>x000000000000ed8b |</span><br><span class="line">  <span class="number">296</span> | cp          | <span class="number">0</span>x00007f7f3d3a5100 | <span class="number">0</span>x0000000000440848 |</span><br><span class="line">  <span class="number">304</span> | i           | <span class="number">0</span>x00007f7f3be87c38 | <span class="number">0</span>x000000000044353a |</span><br><span class="line">  <span class="number">312</span> | catches     | <span class="number">0</span>x0000000000000001 |                    |</span><br><span class="line">  <span class="number">224</span> | arity       | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">232</span> | arg_reg     | <span class="number">0</span>x00007f7f3cbc04f8 | <span class="number">0</span>x000000000000320b |</span><br><span class="line">  <span class="number">240</span> | max_arg_reg | <span class="number">0</span>x0000000000000006 |                    |</span><br><span class="line">  <span class="number">248</span> | def..reg[<span class="number">0</span>] | <span class="number">0</span>x000000000000320b |                    |</span><br><span class="line">  <span class="number">256</span> | def..reg[<span class="number">1</span>] | <span class="number">0</span>x0000000000000c8b |                    |</span><br><span class="line">  <span class="number">264</span> | def..reg[<span class="number">2</span>] | <span class="number">0</span>x00007f7f33ec9589 |                    |</span><br><span class="line">  <span class="number">272</span> | def..reg[<span class="number">3</span>] | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">280</span> | def..reg[<span class="number">4</span>] | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">288</span> | def..reg[<span class="number">5</span>] | <span class="number">0</span>x00000000000007d0 |                    |</span><br><span class="line">  <span class="number">136</span> | nsp         | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">144</span> | nstack      | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">152</span> | nstend      | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">  <span class="number">160</span> | ncallee     | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">   <span class="number">56</span> | ncsp        | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">   <span class="number">64</span> | narity      | <span class="number">0</span>x0000000000000000 |                    |</span><br><span class="line">---------------------------------------------------------------</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>â€œdirtyâ€ IO threads intended to replace the async thread pool used by the file driver<br>
but dirty IO not used by OTP today<br>
å­—é¢å¸¸é‡ä¸ä¼šå†è¢«copyï¼Œä½†æ˜¯etsä¸­äººä¼šè¢«copy <a href="http://www.erlang-factory.com/euc2017/kenneth-lundin">More</a></p>
</blockquote>
<ul>
<li>æ–°å¢çš„è°ƒè¯•å·¥å…·</li>
</ul>
<blockquote>
<p>msacc<br>
æ–°å¢çš„å‚æ•° +IOt +IOp å¯ä»¥ä½¿ç”¨msacc:start/1ã€msacc:print/0æ¥æŸ¥çœ‹sleep time å¦‚æœè¿™ä¸ªå€¼å¾ˆä½å¯ä»¥å¢å¤§+IOt</p>
</blockquote>
]]></content>
      <categories>
        <category>Erlang</category>
      </categories>
      <tags>
        <tag>Erlang</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®åº“ä¹‹åˆ†åŒºã€åˆ†ç‰‡ã€åˆ†è¡¨</title>
    <url>/2021/07/12/database-sharding-partitioning/</url>
    <content><![CDATA[<span id="more"></span>]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
        <category>åˆ†ç‰‡ åˆ†åŒº å‚ç›´æ‰©å±• æ°´å¹³æ‰©å±•</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¸¸æˆæœåŠ¡å™¨å¼€å‘ä¸è¿ç»´</title>
    <url>/2022/12/21/gameserver/</url>
    <content><![CDATA[<p>æœåŠ¡å™¨æ‰€æœ‰éœ€è¦çš„æŠ€æœ¯</p>
<span id="more"></span>
<h2 id="ç®€ä»‹">ç®€ä»‹</h2>
<h2 id="å¼€å‘">å¼€å‘</h2>
<h3 id="1-å¯»è·¯ç³»ç»Ÿ">1. å¯»è·¯ç³»ç»Ÿ</h3>
<h2 id="è¿ç»´">è¿ç»´</h2>
]]></content>
      <categories>
        <category>æ¸¸æˆ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆæœåŠ¡å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®é©±åŠ¨ç±»æŠ€èƒ½</title>
    <url>/2022/04/07/GameSkill/</url>
    <content><![CDATA[<p><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools:zh-cn">Dota 2 Workshop Tools:zh-cn</a>â€ | <a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools:zh-cn/Scripting:zh-cn">Scripting:zh-cn</a></p>
<p>å‡ ä¹æ‰€æœ‰åœ¨DOTA2ä¸­çš„æŠ€èƒ½éƒ½æ˜¯ä½¿ç”¨C++æ¥ç¼–å†™çš„ï¼Œå½“æŸ¥çœ‹æ‰€æœ‰è¿™äº›æŠ€èƒ½çš„æ—¶å€™ï¼Œnpc_abilities.txtåŒ…å«äº†ä¸€äº›æŠ€èƒ½å…ƒæ•°æ®çš„KV(Key-Values)æ–‡ä»¶ï¼Œæš´éœ²å‡ºäº†ä¸€äº›æŠ€èƒ½çš„é”®å€¼ï¼Œè¿™é‡ŒåŒ…å«äº†å‡ ä¹æ‰€æœ‰çš„å…ƒæ•°æ®ï¼Œä½¿ç”¨æ•°æ®é©±åŠ¨ç±»æŠ€èƒ½ç³»ç»Ÿèƒ½å¤Ÿä¸ºDOTA2åˆ›é€ ä¸€äº›è‡ªå®šä¹‰æŠ€èƒ½ï¼Œèƒ½å¤Ÿä¸ºä»–ä»¬èµ‹äºˆç‰¹æ®Šçš„æ•°å€¼å’Œç‰¹å®šçš„è§¦å‘äº‹ä»¶ã€‚</p>
<h2 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­">ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2>
<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æŠ€èƒ½ï¼Œä»–æ˜¯ä¸€ä¸ªè¢«åŠ¨æŠ€èƒ½ï¼Œç»™å•ä½æ·»åŠ äº†ä¸€ä¸ªç²’å­ç‰¹æ•ˆã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">"fx_test_ability"</span><br><span class="line">{</span><br><span class="line">    // General</span><br><span class="line">    //-------------------------------------------------------------------------------------------------------------</span><br><span class="line">    "BaseClass"             "ability_datadriven"</span><br><span class="line">    "AbilityBehavior"       "DOTA_ABILITY_BEHAVIOR_PASSIVE"</span><br><span class="line">    "AbilityTextureName"    "axe_battle_hunger"</span><br><span class="line"></span><br><span class="line">    // Modifiers</span><br><span class="line">    //-------------------------------------------------------------------------------------------------------------</span><br><span class="line">    "Modifiers"</span><br><span class="line">    {</span><br><span class="line">        "fx_test_modifier"</span><br><span class="line">        {</span><br><span class="line">            "Passive" "1"</span><br><span class="line">            "OnCreated"</span><br><span class="line">            {</span><br><span class="line">                "AttachEffect"</span><br><span class="line">                {</span><br><span class="line">                    "Target" "CASTER"</span><br><span class="line">                    "EffectName" "particles/econ/generic/generic_buff_1/generic_buff_1.vpcf"</span><br><span class="line">                    "EffectAttachType" "follow_overhead"</span><br><span class="line">                    "EffectLifeDurationScale" "1"</span><br><span class="line">                    "EffectColorA" "255 255 0"</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å…¶ä¸­ï¼ŒåŸºç±»(â€œBaseClassâ€),æŠ€èƒ½è¡Œä¸º(â€œAbilityBehaviorâ€)å’ŒæŠ€èƒ½å›¾æ ‡åç§°(â€œAbilityTextureNameâ€)åœ¨æ‰€æœ‰æŠ€èƒ½ä¸­éƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p>
<span id="more"></span>
<h3 id="èŒƒä¾‹åˆ†è§£">èŒƒä¾‹åˆ†è§£</h3>
<ul>
<li><code>"BaseClass" (åŸºç±»)</code>
<ul>
<li><code>"AbilityBehavior" (æŠ€èƒ½è¡Œä¸º)</code></li>
<li><code>"ID"</code></li>
<li><code>"AbilityTextureName" (æŠ€èƒ½å›¾æ ‡åç§°)</code></li>
</ul>
</li>
<li><code>"Modifiers"</code>
<ul>
<li><code>"Passive" (è¢«åŠ¨)</code></li>
<li><code>"OnCreated" (å½“åˆ›å»ºæ—¶)</code></li>
</ul>
</li>
</ul>
<h2 id="æŠ€èƒ½è¡Œä¸º">æŠ€èƒ½è¡Œä¸º</h2>
<p>â€œAbilityBehaviorâ€ (æŠ€èƒ½è¡Œä¸º) çš„å…¨éƒ¨ç±»å‹ï¼Œä¼šä½¿æŠ€èƒ½æœ‰ä¸ç”¨çš„é‡Šæ”¾æ–¹å¼ã€‚ä½ èƒ½å¤Ÿä½¿ç”¨<code>|</code>æ¥åˆ†å‰²ä¸åŒçš„å¸¸é‡ï¼Œæ¯”å¦‚è¯´ â€œDOTA_ABILITY_BEHAVIOR_HIDDEN | DOTA_ABILITY_BEHAVIOR_NO_TARGETâ€ - è¿™äº›ç©ºæ ¼æ˜¯å¾ˆé‡è¦çš„ï¼</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">DOTA_ABILITY_BEHAVIOR_HIDDEN               = 1 &lt;&lt; 0, //è¿™ä¸ªæŠ€èƒ½æ˜¯å•ä½æ‰€æ‹¥æœ‰çš„æŠ€èƒ½ï¼Œä½†æ˜¯ä¸ä¼šåœ¨HUDä¸Šæ˜¾ç¤ºã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_PASSIVE              = 1 &lt;&lt; 1, //è¿™ä¸ªæŠ€èƒ½æ˜¯ä¸€ä¸ªè¢«åŠ¨æŠ€èƒ½ï¼Œä¸èƒ½è¢«ä½¿ç”¨ï¼Œä½†æ˜¯ä¼šåœ¨HUDä¸Šæ˜¾ç¤ºã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_NO_TARGET            = 1 &lt;&lt; 2, //ä¸éœ€è¦æŒ‡å®šç›®æ ‡å°±èƒ½é‡Šæ”¾çš„æŠ€èƒ½ï¼Œå½“æŒ‰ä¸‹æŠ€èƒ½æŒ‰é’®çš„æ—¶å€™ï¼Œè¿™ä¸ªæŠ€èƒ½å°±ä¼šè¢«é‡Šæ”¾ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_UNIT_TARGET          = 1 &lt;&lt; 3, //æŠ€èƒ½éœ€è¦æŒ‡å®šä¸€ä¸ªç›®æ ‡æ¥é‡Šæ”¾ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_POINT                = 1 &lt;&lt; 4, //æŠ€èƒ½å°†ä¼šåœ¨é¼ æ ‡æŒ‡å®šçš„ä½ç½®é‡Šæ”¾ï¼ˆå¦‚æœé¼ æ ‡æŒ‡å‘äº†ä¸€ä¸ªå•ä½ï¼Œä¼šåœ¨å•ä½æ‰€åœ¨çš„ä½ç½®é‡Šæ”¾ï¼‰ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_AOE                  = 1 &lt;&lt; 5, //è¿™ä¸ªæŠ€èƒ½å°†ä¼šæ˜¾ç¤ºæŠ€èƒ½é‡Šæ”¾çš„èŒƒå›´ï¼Œæœ‰ç‚¹åƒDOTA_ABILITY_BEHAVIOR_POINTç±»çš„æŠ€èƒ½ï¼Œä½†æ˜¯ä¼šæ˜¾ç¤ºä¸€ä¸ªèŒƒå›´ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE        = 1 &lt;&lt; 6, //è¿™ä¸ªæŠ€èƒ½å°†èƒ½è¢«é‡Šæ”¾ï¼Œæˆ–è€…æ‹¥æœ‰å¯¹åº”çš„é‡Šæ”¾æœºåˆ¶ï¼Œä½†æ˜¯ä¸èƒ½è¢«å­¦ä¹ ã€‚ï¼ˆä¸€èˆ¬æ˜¯ç”¨åœ¨ç±»ä¼¼ç‚¸å¼¹äººçš„å¼•çˆ†ç‚¸å¼¹æŠ€èƒ½ï¼‰ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_CHANNELLED           = 1 &lt;&lt; 7, //æŒç»­æ€§æ–½æ³•æŠ€èƒ½ï¼Œå¦‚æœæ–½æ³•è€…ç§»åŠ¨æˆ–è€…è¢«æ²‰é»˜ï¼Œè¿™ä¸ªæŠ€èƒ½å°†ä¼šè¢«ä¸­æ–­ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_ITEM                 = 1 &lt;&lt; 8, //è¿™ä¸ªæŠ€èƒ½ç»‘å®šäº†ä¸€ä¸ªç‰©å“ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_TOGGLE               = 1 &lt;&lt; 9, //åˆ‡æ¢ç±»æŠ€èƒ½ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_DIRECTIONAL          = 1 &lt;&lt; 10, //è¿™ä¸ªæŠ€èƒ½æ˜¯ä¸€ä¸ªä»è‹±é›„å‡ºå‘çš„æ–¹å‘æ€§æŠ€èƒ½ï¼Œæ¯”å¦‚ç±³æ‹‰å¨œçš„æœˆä¹‹ç¥å‰‘æˆ–è€…å± å¤«çš„è‚‰é’©ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_IMMEDIATE            = 1 &lt;&lt; 11, //è¿™ä¸ªæŠ€èƒ½å°†ä¼šè¢«ç«‹å³é‡Šæ”¾ï¼Œä¸ä¼šè¿›å…¥æ“ä½œåºåˆ—ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_AUTOCAST             = 1 &lt;&lt; 12, //è¿™ä¸ªæŠ€èƒ½å¯ä»¥è¢«è‡ªåŠ¨é‡Šæ”¾ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_NOASSIST             = 1 &lt;&lt; 13, //è¿™ä¸ªæŠ€èƒ½å°†ä¸ä¼šæœ‰è¾…åŠ©ç½‘æ ¼ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_AURA                 = 1 &lt;&lt; 14, //è¿™ä¸ªæŠ€èƒ½æ˜¯ä¸€ä¸ªå…‰ç¯æŠ€èƒ½ï¼ŒNot really used other than to tag the ability as such.</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_ATTACK               = 1 &lt;&lt; 15, //è¿™ä¸ªæŠ€èƒ½æ˜¯ä¸€ä¸ªæ³•çƒæŠ€èƒ½ï¼Œä¸èƒ½å¯¹é­”æ³•å…ç–«ç›®æ ‡ç”Ÿæ•ˆï¼Œ</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_DONT_RESUME_MOVEMENT = 1 &lt;&lt; 16, //è¿™ä¸ªæŠ€èƒ½åœ¨é‡Šæ”¾å®Œæˆä¹‹åä¸ä¼šç»§ç»­ä¹‹å‰çš„ç§»åŠ¨æ“ä½œï¼Œåªèƒ½å’Œæ— ç›®æ ‡æˆ–è€…ç«‹å³é‡Šæ”¾ç±»æŠ€èƒ½é…åˆä½¿ç”¨ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_ROOT_DISABLES        = 1 &lt;&lt; 17, //è¿™ä¸ªæŠ€èƒ½åœ¨å•ä½è¢«å®šèº«çš„æ—¶å€™æ— æ³•ä½¿ç”¨ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_UNRESTRICTED         = 1 &lt;&lt; 18, //è¿™ä¸ªæŠ€èƒ½åœ¨é‡Šæ”¾æŒ‡ä»¤è¢«é™åˆ¶çš„æ—¶å€™ä¹Ÿèƒ½è¢«ä½¿ç”¨ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_IGNORE_PSEUDO_QUEUE  = 1 &lt;&lt; 19, //è¿™ä¸ªæŠ€èƒ½åœ¨è¢«çœ©æ™•ï¼Œæ–½æ³•å’Œè¢«å¼ºåˆ¶æ”»å‡»çš„æ—¶å€™ä¹Ÿèƒ½ä½¿ç”¨ï¼Œåªèƒ½å’Œè‡ªåŠ¨é‡Šæ”¾ç±»DOTA_ABILITY_BEHAVIOR_AUTOCASTé…åˆä½¿ç”¨ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_IGNORE_CHANNEL       = 1 &lt;&lt; 20, //è¿™ä¸ªæŠ€èƒ½å³ä½¿æ–½æ³•è¢«ä¸­æ–­ä¹Ÿèƒ½ç»§ç»­é‡Šæ”¾ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_DONT_CANCEL_MOVEMENT = 1 &lt;&lt; 21, //Doesn't cause certain modifiers to end, ç›®å‰æœªçŸ¥ï¼Œåªåœ¨ä¿¡ä½¿çš„é€Ÿåº¦çˆ†å‘æœ‰è§åˆ°ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_DONT_ALERT_TARGET    = 1 &lt;&lt; 22, //è¿™ä¸ªæŠ€èƒ½åœ¨æŒ‡å®šæ•Œäººé‡Šæ”¾çš„æ—¶å€™å°†ä¸ä¼šæƒŠé†’ä»–ä»¬ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_DONT_RESUME_ATTACK   = 1 &lt;&lt; 23, //è¿™ä¸ªæŠ€èƒ½åœ¨é‡Šæ”¾å®Œæˆä¹‹åï¼Œå°†ä¸ä¼šæ¢å¤å¯¹ä¹‹å‰ç›®æ ‡çš„è‡ªåŠ¨æ”»å‡»ï¼Œåªèƒ½é…åˆæ— ç›®æ ‡ï¼Œéç«‹å³é‡Šæ”¾ç±»å’ŒæŒ‡å®šå•ä½ç›®æ ‡ç±»æŠ€èƒ½ä½¿ç”¨ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_NORMAL_WHEN_STOLEN   = 1 &lt;&lt; 24, //è¿™ä¸ªæŠ€èƒ½åœ¨è¢«å·å–ä¹‹åï¼Œä¾ç„¶ä½¿ç”¨ä¹‹å‰çš„æ–½æ³•å‰æ‘‡ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_IGNORE_BACKSWING     = 1 &lt;&lt; 25, //è¿™ä¸ªæŠ€èƒ½å°†ä¼šæ— è§†æ–½æ³•åæ‘‡ã€‚</span><br><span class="line">DOTA_ABILITY_BEHAVIOR_RUNE_TARGET          = 1 &lt;&lt; 26, //è¿™ä¸ªæŠ€èƒ½èƒ½ä»¥ç¥ç¬¦ä¸ºç›®æ ‡ã€‚</span><br></pre></td></tr></tbody></table></figure>
<h2 id="æŠ€èƒ½è§¦å‘äº‹ä»¶å’Œæ“ä½œ">æŠ€èƒ½è§¦å‘äº‹ä»¶å’Œæ“ä½œ</h2>
<p>æŠ€èƒ½å¯ä»¥æœ‰å„ç§æ¸¸æˆä¸­çš„äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å¯ä»¥è§¦å‘æ“ä½œã€‚</p>
<p>ä¸€ä¸ªå…³äºäº‹ä»¶å’Œæ“ä½œçš„èŒƒä¾‹ã€‚åœ¨è¿™ä¸ªèŒƒä¾‹ä¸­ï¼Œå½“ä½ å¼€å§‹é‡Šæ”¾æŠ€èƒ½ï¼Œå°±ä¼šåœ¨æ–½æ³•è€…ä¸Šæ’­æ”¾éŸ³æ•ˆã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">"OnSpellStart"      // äº‹ä»¶</span><br><span class="line">{</span><br><span class="line">    "FireSound"     // æ“ä½œ</span><br><span class="line">    {</span><br><span class="line">        "EffectName"    "SoundEventName"</span><br><span class="line">        "Target"        "CASTER"</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="äº‹ä»¶">äº‹ä»¶</h3>
<p>å¼•æ“ä¸ºæŠ€èƒ½æä¾›äº†ä¸€ç³»åˆ—è§¦å‘äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å°†èƒ½å¤Ÿåœ¨æŠ€èƒ½ä¸­è§¦å‘ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">è§¦å‘äº‹ä»¶åç§°</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">OnChannelFinish</td>
<td style="text-align:center">å½“æŒç»­æ€§æ–½æ³•å®Œæˆ</td>
</tr>
<tr>
<td style="text-align:center">OnChannelInterrupted</td>
<td style="text-align:center">å½“æŒç»­æ€§æ–½æ³•è¢«ä¸­æ–­</td>
</tr>
<tr>
<td style="text-align:center">OnChannelSucceeded</td>
<td style="text-align:center">å½“æŒç»­æ€§æ–½æ³•æˆåŠŸ</td>
</tr>
<tr>
<td style="text-align:center">OnOwnerDied</td>
<td style="text-align:center">å½“æ‹¥æœ‰è€…æ­»äº¡</td>
</tr>
<tr>
<td style="text-align:center">OnOwnerSpawned</td>
<td style="text-align:center">å½“æ‹¥æœ‰è€…å‡ºç”Ÿ</td>
</tr>
<tr>
<td style="text-align:center">OnProjectileFinish</td>
<td style="text-align:center">å½“å¼¹é“ç²’å­ç‰¹æ•ˆç»“æŸ</td>
</tr>
<tr>
<td style="text-align:center">OnProjectileHitUnit</td>
<td style="text-align:center">å½“å¼¹é“ç²’å­ç‰¹æ•ˆå‘½ä¸­å•ä½</td>
</tr>
<tr>
<td style="text-align:center">OnSpellStart</td>
<td style="text-align:center">å½“æŠ€èƒ½æ–½æ³•å¼€å§‹</td>
</tr>
<tr>
<td style="text-align:center">OnToggleOff</td>
<td style="text-align:center">å½“åˆ‡æ¢ä¸ºå…³é—­çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">OnToggleOn</td>
<td style="text-align:center">å½“åˆ‡æ¢ä¸ºå¼€å¯çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">OnUpgrade</td>
<td style="text-align:center">å½“å‡çº§</td>
</tr>
</tbody>
</table>
<h3 id="æ“ä½œ">æ“ä½œ</h3>
<p>ä»¥ä¸‹æ˜¯ä½ åœ¨æŠ€èƒ½ä¸­èƒ½å¤Ÿä½¿ç”¨æ“ä½œä¸­çš„ä¸€äº›Keyï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ“ä½œåç§°</th>
<th style="text-align:center">æ“ä½œå¯ç”¨å‚æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">AddAbility</td>
<td style="text-align:center">Target, AbilityName</td>
</tr>
<tr>
<td style="text-align:center">æ·»åŠ æŠ€èƒ½</td>
<td style="text-align:center">ç›®æ ‡ï¼ŒæŠ€èƒ½åç§°</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">ActOnTargets</td>
<td style="text-align:center">Target, Action</td>
</tr>
<tr>
<td style="text-align:center">ä½¿ç›®æ ‡æ¨¡å‹åšå‡ºæŸä¸ªåŠ¨ä½œ</td>
<td style="text-align:center">ç›®æ ‡ï¼ŒåŠ¨ä½œåç§°</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">ApplyModifier</td>
<td style="text-align:center">Target, ModifierName</td>
</tr>
<tr>
<td style="text-align:center">åº”ç”¨Modifier</td>
<td style="text-align:center">ç›®æ ‡ï¼ŒModifieråç§°</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">AttachEffect</td>
<td style="text-align:center">EffectName, EffectAttachType, Target, ControlPoints, EffectColorA, EffectColorB, EffectAlphaScale</td>
</tr>
<tr>
<td style="text-align:center">é™„ç€ç‚¹ç‰¹æ•ˆ</td>
<td style="text-align:center">ç‰¹æ•ˆåç§°ï¼Œç‰¹æ•ˆé™„ç€ç‚¹ç±»å‹ï¼Œç›®æ ‡ï¼Œæ§åˆ¶ç‚¹ï¼Œç‰¹æ•ˆé¢œè‰²Aï¼Œç‰¹æ•ˆé¢œè‰²Bï¼Œç‰¹æ•ˆä¸é€æ˜åº¦æ¯”ä¾‹</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Blink</td>
<td style="text-align:center">Target</td>
</tr>
<tr>
<td style="text-align:center">é—ªçƒ</td>
<td style="text-align:center">ç›®æ ‡</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">CleaveAttack</td>
<td style="text-align:center">CleavePercent, CleaveRadius</td>
</tr>
<tr>
<td style="text-align:center">èŒƒå›´æ”»å‡»</td>
<td style="text-align:center">åˆ†è£‚ä¼¤å®³ï¼Œåˆ†è£‚èŒƒå›´</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">CreateThinker</td>
<td style="text-align:center">Target, ModifierName</td>
</tr>
<tr>
<td style="text-align:center">åˆ›å»ºThinker(å®šæ—¶å™¨)</td>
<td style="text-align:center">ç›®æ ‡ï¼ŒModifieråç§°</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Damage</td>
<td style="text-align:center">Target, Type, MinDamage/MaxDamage, Damage, CurrentHealthPercentBasedDamage, MaxHealthPercentBasedDamage</td>
</tr>
<tr>
<td style="text-align:center">ä¼¤å®³</td>
<td style="text-align:center">ç›®æ ‡ï¼Œä¼¤å®³ç±»å‹ï¼Œæœ€å°/æœ€å¤§ä¼¤å®³å€¼ï¼Œä¼¤å®³å€¼ï¼ŒåŸºäºå½“å‰ç”Ÿå‘½ç™¾åˆ†æ¯”ä¼¤å®³ï¼ŒåŸºäºæœ€å¤§ç”Ÿå‘½ç™¾åˆ†æ¯”ä¼¤å®³</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">DelayedAction</td>
<td style="text-align:center">Delay, Action</td>
</tr>
<tr>
<td style="text-align:center">å»¶è¿Ÿæ“ä½œ</td>
<td style="text-align:center">å»¶è¿Ÿæ—¶é—´ï¼Œæ“ä½œ</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">DestroyTrees</td>
<td style="text-align:center">Target, Radius</td>
</tr>
<tr>
<td style="text-align:center">æ‘§æ¯æ ‘æœ¨</td>
<td style="text-align:center">ç›®æ ‡ï¼ŒèŒƒå›´</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">FireEffect</td>
<td style="text-align:center">EffectName, EffectAttachType, Target, ControlPoints, TargetPoint, EffectRadius, EffectDurationScale, EffectLifeDurationScale, EffectColorA, EffectColorB</td>
</tr>
<tr>
<td style="text-align:center">æ’­æ”¾ç‰¹æ•ˆ</td>
<td style="text-align:center">ç‰¹æ•ˆåç§°ï¼Œç‰¹æ•ˆé™„ç€ç‚¹ç±»å‹ï¼Œç›®æ ‡ï¼Œæ§åˆ¶ç‚¹ï¼Œç›®æ ‡ç‚¹ï¼Œç‰¹æ•ˆèŒƒå›´ï¼Œç‰¹æ•ˆæ’­æ”¾æ—¶é—´æ¯”ä¾‹ï¼Œç‰¹æ•ˆå­˜æ´»æ—¶é—´æ¯”ä¾‹ï¼Œç‰¹æ•ˆé¢œè‰²Aï¼Œç‰¹æ•ˆé¢œè‰²B</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">FireSound</td>
<td style="text-align:center">EffectName, Target</td>
</tr>
<tr>
<td style="text-align:center">æ’­æ”¾å£°éŸ³</td>
<td style="text-align:center">éŸ³æ•ˆåç§°ï¼Œç›®æ ‡</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Heal</td>
<td style="text-align:center">HealAmount, Target</td>
</tr>
<tr>
<td style="text-align:center">æ²»æ„ˆ</td>
<td style="text-align:center">æ²»ç–—é‡ï¼Œç›®æ ‡</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Knockback</td>
<td style="text-align:center">Target, Center, Duration, Distance, Height, IsFixedDistance, ShouldStun</td>
</tr>
<tr>
<td style="text-align:center">å‡»é€€</td>
<td style="text-align:center">ç›®æ ‡ï¼Œä¸­å¿ƒï¼ŒæŒç»­æ—¶é—´ï¼Œè·ç¦»ï¼Œé«˜åº¦ï¼Œå›ºå®šè·ç¦»ï¼Œæ˜¯å¦çœ©æ™•</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">LevelUpAbility</td>
<td style="text-align:center">Target, AbilityName</td>
</tr>
<tr>
<td style="text-align:center">å‡çº§æŠ€èƒ½</td>
<td style="text-align:center">ç›®æ ‡ï¼ŒæŠ€èƒ½åç§°</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Lifesteal</td>
<td style="text-align:center">Target, LifestealPercent</td>
</tr>
<tr>
<td style="text-align:center">å¸è¡€</td>
<td style="text-align:center">ç›®æ ‡ï¼Œå¸è¡€ç™¾åˆ†æ¯”</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">LinearProjectile</td>
<td style="text-align:center">Target, EffectName, MoveSpeed, StartRadius, EndRadius, FixedDistance, StartPosition, TargetTeams, TargetTypes, TargetFlags, HasFrontalCone, ProvidesVision, VisionRadius</td>
</tr>
<tr>
<td style="text-align:center">çº¿æ€§æŠ•å°„ç‰©</td>
<td style="text-align:center">ç›®æ ‡ï¼Œç‰¹æ•ˆåç§°ï¼Œç§»åŠ¨é€Ÿåº¦ï¼Œå¼€å§‹èŒƒå›´ï¼Œç»“æŸèŒƒå›´ï¼Œå›ºå®šè·ç¦»ï¼Œå¼€å§‹ä½ç½®ï¼Œç›®æ ‡é˜Ÿä¼ï¼Œç›®æ ‡ç±»å‹ï¼Œç›®æ ‡çŠ¶æ€ï¼ŒHasFrontalConeï¼Œæä¾›è§†é‡ï¼Œè§†é‡èŒƒå›´</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Random</td>
<td style="text-align:center">Chance, PseudoRandom, OnSuccess, OnFailure</td>
</tr>
<tr>
<td style="text-align:center">å‡ ç‡</td>
<td style="text-align:center">æ¦‚ç‡ï¼Œä¼ªéšæœºï¼ŒæˆåŠŸæ—¶ï¼Œå¤±è´¥æ—¶</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">RemoveAbility</td>
<td style="text-align:center">Target, AbilityName</td>
</tr>
<tr>
<td style="text-align:center">ç§»é™¤æŠ€èƒ½</td>
<td style="text-align:center">ç›®æ ‡ï¼ŒæŠ€èƒ½åç§°</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">RemoveModifier</td>
<td style="text-align:center">Target, ModifierName</td>
</tr>
<tr>
<td style="text-align:center">ç§»é™¤Modifier</td>
<td style="text-align:center">ç›®æ ‡ï¼ŒModifieråç§°</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">RunScript</td>
<td style="text-align:center">Target, ScriptFile, Function</td>
</tr>
<tr>
<td style="text-align:center">è¿è¡Œè„šæœ¬</td>
<td style="text-align:center">ç›®æ ‡ï¼Œè„šæœ¬æ–‡ä»¶ï¼Œè¿è¡Œå‡½æ•°</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">SpawnUnit</td>
<td style="text-align:center">UnitName, UnitCount, UnitLimit, SpawnRadius, Duration, Target, GrantsGold, GrantsXP</td>
</tr>
<tr>
<td style="text-align:center">ç”Ÿäº§å•ä½</td>
<td style="text-align:center">å•ä½åç§°ï¼Œå•ä½æ•°é‡ï¼Œå•ä½ä¸Šé™ï¼Œç”Ÿäº§èŒƒå›´ï¼ŒæŒç»­æ—¶é—´ï¼Œç›®æ ‡ï¼Œæ­»äº¡é‡‘é’±é‡ï¼Œæ­»äº¡ç»éªŒé‡</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Stun</td>
<td style="text-align:center">Target, Duration</td>
</tr>
<tr>
<td style="text-align:center">å‡»æ™•</td>
<td style="text-align:center">ç›®æ ‡ï¼ŒæŒç»­æ—¶é—´</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">TrackingProjectile</td>
<td style="text-align:center">Target, EffectName, Dodgeable, ProvidesVision, VisionRadius, MoveSpeed, SourceAttachment</td>
</tr>
<tr>
<td style="text-align:center">è·Ÿè¸ªæŠ•å°„ç‰©</td>
<td style="text-align:center">ç›®æ ‡ï¼Œç‰¹æ•ˆåç§°ï¼Œæ˜¯å¦å¯é—ªé¿ï¼Œæä¾›è§†é‡ï¼Œè§†é‡èŒƒå›´ï¼Œç§»åŠ¨é€Ÿåº¦ï¼Œèµ·æºé™„ç€ç‚¹</td>
</tr>
</tbody>
</table>
<p><strong><img src="https://developer.valvesoftware.com/w/images/c/cc/Note.png" alt="img"> æ³¨æ„ï¼š</strong><code>AddAbility</code> ï¼ˆå¢åŠ æŠ€èƒ½ï¼‰å°†ä¼šç»™å•ä½æ·»åŠ ä¸€ä¸ª0çº§çš„æŠ€èƒ½ã€‚ <code>RemoveAbility</code> ï¼ˆç§»é™¤æŠ€èƒ½ï¼‰å°†ä¼šç§»é™¤å¯¹åº”æŠ€èƒ½ï¼ˆå“ªæ€•å®ƒå·²ç»å‡çº§äº†ï¼‰ï¼Œæ›´å¤æ‚çš„æŠ€èƒ½ç®¡ç†ï¼Œåº”å½“é€šè¿‡ç¨‹åºæ¥åˆ¶ä½œã€‚</p>
<h2 id="æ“ä½œç›®æ ‡">æ“ä½œç›®æ ‡</h2>
<p>åœ¨æ“ä½œä¹‹å‰ï¼Œé¦–å…ˆåº”è¯¥é€‰ä¸­ç›®æ ‡(Target)ã€‚ä»¥ä¸‹æœ‰å‡ ç§é€‰æ‹©æ–¹å¼ã€‚</p>
<p>**<img src="https://developer.valvesoftware.com/w/images/c/cc/Note.png" alt="img"> æ³¨æ„ï¼š**åœ¨å‡ ä¹æ‰€æœ‰æ“ä½œä¸­ï¼Œéƒ½éœ€è¦é€‰ä¸­ç›®æ ‡ã€‚è¿™éå¸¸é‡è¦ï¼Œç›´æ¥å½±å“åˆ°ä½ çš„æŠ€èƒ½æ•ˆæœã€‚</p>
<h3 id="å•ä½“ç›®æ ‡">å•ä½“ç›®æ ‡</h3>
<p>å°èŒƒä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">"Target"  "CASTER"</span><br></pre></td></tr></tbody></table></figure>
<p>å•ä½“ç›®æ ‡æœ‰ä»¥ä¸‹è¿™äº›å€¼ï¼š</p>
<blockquote>
<p>|   åç§°   |  æè¿°  |<br>
| :------: | :----: |<br>
|  CASTER  | æ–½æ³•è€… |<br>
|  TARGET  |  ç›®æ ‡  |<br>
|  POINT  |   ç‚¹   |<br>
| ATTACKER | æ”»å‡»è€… |<br>
|   UNIT   |  å•ä½  |</p>
</blockquote>
<p>åœ¨é¡µé¢æœ€ä¸Šä¾‹å­ä¸­ï¼Œå°±æ˜¯ç”¨<code>"Target(ç›®æ ‡)" "CASTER(æ–½æ³•è€…)"</code>ï¼Œåœ¨æ–½æ³•è€…èº«ä¸Šåˆ¶é€ äº›ç‰¹æ•ˆã€‚</p>
<p><strong><img src="https://developer.valvesoftware.com/w/images/c/cc/Note.png" alt="Note.png"> Note:</strong> åœ¨ä¸åŒçš„æ“ä½œä¸­ï¼Œè¿™äº›å­—æ®µæä¾›çš„æ˜¯ä¸åŒçš„ç›®æ ‡ï¼Œä½ éœ€è¦è‡ªå·±å®é™…ä½¿ç”¨ä¸€ä¸‹æ‰èƒ½æ˜ç™½ã€‚</p>
<h3 id="å¤šä¸ªç›®æ ‡">å¤šä¸ªç›®æ ‡</h3>
<p>å°èŒƒä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">"Target"</span><br><span class="line">{</span><br><span class="line">    "Center"    "POINT"</span><br><span class="line">    "Teams"     "DOTA_UNIT_TARGET_TEAM_ENEMY"</span><br><span class="line">    "Radius"    "300"</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æƒ³è¦åœ¨æŸä¸ªåŒºåŸŸé‡Œé€‰ä¸­å¤šä¸ªç›®æ ‡ï¼Œå°±éœ€è¦åœ¨ Targetä»£ç å— ä¸­å¡«å…¥ä¸‹é¢çš„å‚æ•°ï¼š</p>
<ul>
<li><code>Center</code> - ä»¥ç›®æ ‡ä¸ºæœç´¢èŒƒå›´çš„ä¸­å¿ƒ</li>
</ul>
<blockquote>
<p>|  ä¸­å¿ƒç›®æ ‡  |  æè¿°  |<br>
| :--------: | :----: |<br>
|   CASTER   | æ–½æ³•è€… |<br>
|   TARGET   |  ç›®æ ‡  |<br>
|   POINT   |   ç‚¹   |<br>
|  ATTACKER  | æ”»å‡»è€… |<br>
|    UNIT    |  å•ä½  |<br>
| PROJECTILE | æŠ›å°„ç‰© |</p>
</blockquote>
<ul>
<li><code>Radius </code>- æœç´¢ç›®æ ‡çš„èŒƒå›´</li>
<li><code>Teams</code> - æ ¹æ®é˜Ÿä¼ç­›é€‰ç›®æ ‡ï¼ˆä¸€æ ·å¯ä»¥ç”¨ | æ¥æŒ‡å®šå¤šç§ç±»å‹ï¼‰</li>
</ul>
<blockquote>
<p>|            ç›®æ ‡é˜Ÿä¼            |   æè¿°   |<br>
| :----------------------------: | :------: |<br>
|   DOTA_UNIT_TARGET_TEAM_BOTH   | åŒæ–¹é˜Ÿä¼ |<br>
|  DOTA_UNIT_TARGET_TEAM_CUSTOM  | æ™®é€šé˜Ÿä¼ |<br>
|  DOTA_UNIT_TARGET_TEAM_ENEMY  | æ•Œæ–¹é˜Ÿä¼ |<br>
| DOTA_UNIT_TARGET_TEAM_FRIENDLY | å‹æ–¹é˜Ÿä¼ |<br>
|   DOTA_UNIT_TARGET_TEAM_NONE   |    æ—     |</p>
</blockquote>
<ul>
<li><code>Types - æŒ‡å®šçš„ç±»å‹ï¼ŒExcludeTypes - æ’é™¤å¯¹åº”çš„ç±»å‹</code> ï¼ˆä¸€æ ·å¯ä»¥ç”¨ | æ¥æŒ‡å®šå¤šç§ç±»å‹ï¼‰</li>
</ul>
<blockquote>
<p>|            ç±»å‹            | æè¿° |<br>
| :-------------------------: | :â€“: |<br>
|    DOTA_UNIT_TARGET_ALL    | æ‰€æœ‰ |<br>
|   DOTA_UNIT_TARGET_BASIC   | åŸºæœ¬ |<br>
|  DOTA_UNIT_TARGET_BUILDING  | å»ºç­‘ |<br>
|  DOTA_UNIT_TARGET_COURIER  | ä¿¡ä½¿ |<br>
|   DOTA_UNIT_TARGET_CREEP   | é‡æ€ª |<br>
|   DOTA_UNIT_TARGET_CUSTOM   | æ™®é€š |<br>
|    DOTA_UNIT_TARGET_HERO    | è‹±é›„ |<br>
| DOTA_UNIT_TARGET_MECHANICAL | æœºæ¢° |<br>
|    DOTA_UNIT_TARGET_NONE    |  æ—   |<br>
|   DOTA_UNIT_TARGET_OTHER   | å…¶ä»– |<br>
|    DOTA_UNIT_TARGET_TREE    | æ ‘æœ¨ |</p>
</blockquote>
<ul>
<li><code>Flags - æŒ‡å®šç›®æ ‡çš„çŠ¶æ€ï¼ŒExcludeFlags - æ’é™¤å¯¹åº”çŠ¶æ€çš„ç›®æ ‡</code> ï¼ˆä¸€æ ·å¯ä»¥ç”¨ | æ¥æŒ‡å®šå¤šç§ç±»å‹ï¼‰</li>
</ul>
<blockquote>
<p>|                     åç§°                     |          æè¿°          |<br>
| :-------------------------------------------: | :--------------------: |<br>
|   DOTA_UNIT_TARGET_FLAG_CHECK_DISABLE_HELP   | æ£€æµ‹ç©å®¶"ç¦ç”¨å¸®åŠ©"é€‰é¡¹ |<br>
|          DOTA_UNIT_TARGET_FLAG_DEAD          |         å·²æ­»äº¡         |<br>
|       DOTA_UNIT_TARGET_FLAG_FOW_VISIBLE       |       <em>æš‚æ— è¯´æ˜</em>       |<br>
|      DOTA_UNIT_TARGET_FLAG_INVULNERABLE      |          æ— æ•Œ          |<br>
|  DOTA_UNIT_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES  |     é­”æ³•å…ç–«çš„æ•Œäºº     |<br>
|        DOTA_UNIT_TARGET_FLAG_MANA_ONLY        |       <em>æš‚æ— è¯´æ˜</em>       |<br>
|       DOTA_UNIT_TARGET_FLAG_MELEE_ONLY       |       <em>æš‚æ— è¯´æ˜</em>       |<br>
|        DOTA_UNIT_TARGET_FLAG_NO_INVIS        |       ä¸æ˜¯éšå½¢çš„       |<br>
|          DOTA_UNIT_TARGET_FLAG_NONE          |           æ—            |<br>
|      DOTA_UNIT_TARGET_FLAG_NOT_ANCIENTS      |        ä¸æ˜¯è¿œå¤        |<br>
|    DOTA_UNIT_TARGET_FLAG_NOT_ATTACK_IMMUNE    |      ä¸æ˜¯æ”»å‡»å…ç–«      |<br>
|     DOTA_UNIT_TARGET_FLAG_NOT_CREEP_HERO     |        ä¸æ˜¯é‡æ€ª        |<br>
|      DOTA_UNIT_TARGET_FLAG_NOT_DOMINATED      |       ä¸å¯æ§åˆ¶çš„       |<br>
|      DOTA_UNIT_TARGET_FLAG_NOT_ILLUSIONS      |        ä¸æ˜¯å¹»è±¡        |<br>
| DOTA_UNIT_TARGET_FLAG_NOT_MAGIC_IMMUNE_ALLIES |   ä¸æ˜¯é­”æ³•å…ç–«çš„ç›Ÿå‹   |<br>
|     DOTA_UNIT_TARGET_FLAG_NOT_NIGHTMARED     |       éè¢«å‚¬çœ çš„       |<br>
|      DOTA_UNIT_TARGET_FLAG_NOT_SUMMONED      |        éå¬å”¤çš„        |<br>
|      DOTA_UNIT_TARGET_FLAG_OUT_OF_WORLD      |     è¢«æ”¾é€å‡ºä¸–ç•Œçš„     |<br>
|    DOTA_UNIT_TARGET_FLAG_PLAYER_CONTROLLED    |       ç©å®¶æ§åˆ¶çš„       |<br>
|       DOTA_UNIT_TARGET_FLAG_RANGED_ONLY       |       èŒƒå›´å”¯ä¸€çš„       |</p>
</blockquote>
<ul>
<li><code>MaxTargets</code> - æœ€å¤šç›®æ ‡æ•°é‡</li>
<li><code>Random</code> - åœ¨æŒ‡å®šäº†æœ€å¤šç›®æ ‡æ•°é‡ä¹‹åï¼Œæ˜¯å¦é¢å¤–éšæœºå¤šé€‰æ‹©ä¸€ä¸ªå•ä½ã€‚</li>
<li><code>ScriptSelectPoints</code> - <em>æš‚æ— è¯´æ˜</em></li>
</ul>
<p>**<img src="https://developer.valvesoftware.com/w/images/c/cc/Note.png" alt="img"> æ³¨æ„ï¼š**å°†<code>Random</code> å’Œ <code>MaxTargets</code> å…±åŒä½¿ç”¨ï¼Œå°†<code>Random</code> è®¾ç½®ä¸º0å°†ä¼šä½¿æ“ä½œåªå½±å“ç›®æ ‡åŒºåŸŸå†…<code>MaxTargets</code>æˆ–è€…æ›´å°‘çš„å•ä½ã€‚</p>
<h2 id="Modifiers">Modifiers</h2>
<p>æ˜¯åªæœ‰data-drivenç±»æŠ€èƒ½æ‰èƒ½ä½¿ç”¨çš„ï¼Œè¿™ä¸ªåŒºåŸŸå®šä¹‰äº†ä¸€ç³»åˆ—çš„Modifiersï¼ˆä¸€èˆ¬å¯ä»¥è®¤ä¸ºæ˜¯Buffæˆ–è€…DeBuffï¼‰ï¼Œæ¯ä¸ªModifieré€šè¿‡åœ¨å…¶ä¸­å®šä¹‰çš„KV(KeyValues)æ¥å®šä¹‰ã€‚ å‚æ•°æœ‰ä»¥ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">åç§°</th>
<th style="text-align:center">å¯ç”¨å‚æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Attributes</td>
<td style="text-align:center">MODIFIER_ATTRIBUTE_IGNORE_INVULNERABLE, MODIFIER_ATTRIBUTE_MULTIPLE, MODIFIER_ATTRIBUTE_NONE, MODIFIER_ATTRIBUTE_PERMANENT</td>
</tr>
<tr>
<td style="text-align:center">å±æ€§</td>
<td style="text-align:center">å¿½è§†æ— æ•Œï¼Œå¯å åŠ ï¼Œæ— ï¼Œæ­£å¸¸</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Duration</td>
<td style="text-align:center">FloatValue</td>
</tr>
<tr>
<td style="text-align:center">æŒç»­æ—¶é—´</td>
<td style="text-align:center">æµ®ç‚¹å€¼</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">EffectAttachType</td>
<td style="text-align:center">follow_origin, follow_overhead, follow_chest, follow_head, start_at_customorigin, world_origin</td>
</tr>
<tr>
<td style="text-align:center">ç‰¹æ•ˆé™„ç€ç‚¹ç±»å‹</td>
<td style="text-align:center">åŸç‚¹ï¼Œå¤´é¡¶ï¼Œèƒ¸è†›ï¼Œå¤´éƒ¨ï¼Œè‡ªå®šä¹‰åŸç‚¹ï¼Œä¸–ç•ŒåŸç‚¹</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">EffectName</td>
<td style="text-align:center">StringValue</td>
</tr>
<tr>
<td style="text-align:center">ç‰¹æ•ˆåç§°</td>
<td style="text-align:center">å­—ç¬¦ä¸²(è·¯å¾„+ç‰¹æ•ˆå)</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">IsBuff</td>
<td style="text-align:center">BooleanValue</td>
</tr>
<tr>
<td style="text-align:center">æ˜¯å¦å¢ç›Šé­”æ³•</td>
<td style="text-align:center">å¸ƒå°”å€¼ï¼ˆ1ä¸ºå¢ç›Šé­”æ³•ï¼‰</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">IsDebuff</td>
<td style="text-align:center">BooleanValue</td>
</tr>
<tr>
<td style="text-align:center">æ˜¯å¦å‡ç›Šé­”æ³•</td>
<td style="text-align:center">å¸ƒå°”å€¼ï¼ˆ1ä¸ºå‡ç›Šé­”æ³•ï¼‰</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">IsHidden</td>
<td style="text-align:center">BooleanValue</td>
</tr>
<tr>
<td style="text-align:center">æ˜¯å¦éšè—</td>
<td style="text-align:center">å¸ƒå°”å€¼ï¼ˆ1ä¸ºéšè—ï¼‰</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">IsPurgable</td>
<td style="text-align:center">BooleanValue</td>
</tr>
<tr>
<td style="text-align:center">èƒ½å¦è¢«é©±æ•£</td>
<td style="text-align:center">å¸ƒå°”å€¼ï¼ˆ1ä¸ºå¯è¢«é©±æ•£ï¼‰</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">OverrideAnimation</td>
<td style="text-align:center">ACT_DOTA_ATTACK, ACT_DOTA_CAST_ABILITY_1 (2, 3, 4, 5, 6), ACT_DOTA_DISABLED, ACT_DOTA_SPAWN, ACT_DOTA_TELEPORT, ACT_DOTA_VICTORY</td>
</tr>
<tr>
<td style="text-align:center">è¦†ç›–æ¨¡å‹åŠ¨ä½œ</td>
<td style="text-align:center">æ”»å‡»åŠ¨ä½œï¼ŒæŠ€èƒ½é‡Šæ”¾åŠ¨ä½œ(1~6)ï¼Œå—ä¼¤åŠ¨ä½œï¼Œå‡ºç”ŸåŠ¨ä½œï¼Œå›ç¨‹åŠ¨ä½œï¼Œèƒœåˆ©åŠ¨ä½œ</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Passive</td>
<td style="text-align:center">BooleanValue</td>
</tr>
<tr>
<td style="text-align:center">è¢«åŠ¨</td>
<td style="text-align:center">å¸ƒå°”å€¼ï¼ˆ1ä¸ºè¢«åŠ¨æŠ€èƒ½ï¼Œä¼šè‡ªåŠ¨æ·»åŠ è¯¥Modifiersï¼‰</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">TextureName</td>
<td style="text-align:center">StringValue</td>
</tr>
<tr>
<td style="text-align:center">å›¾æ ‡åç§°</td>
<td style="text-align:center">å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">ThinkInterval</td>
<td style="text-align:center">FloatValue</td>
</tr>
<tr>
<td style="text-align:center">Thinké—´éš”</td>
<td style="text-align:center">æµ®ç‚¹å€¼</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h2 id="Modifier-å±æ€§">Modifier å±æ€§</h2>
<p>Modifierå±æ€§èƒ½å¤Ÿæ”¹å˜å¯¹åº”Modifierå½±å“çš„å•ä½çš„æ¸¸æˆç›¸å…³æ•°å€¼ï¼Œä»¥ä¸‹ç¤ºä¾‹å®šä¹‰çš„æ˜¯ä¸€ä¸ªé™ä½ç›®æ ‡æ”»å‡»å’Œç§»åŠ¨é€Ÿåº¦çš„modifierï¼ˆå†™åœ¨æŠ€èƒ½çš„ModifiersåŒºåŸŸå†…ï¼‰ï¼Œå¯¹äºæ•°å€¼ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨åŒºåŸŸç›´æ¥å†™å…¥æ•°å€¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ %name æ¥å¼•ç”¨ AbilitySpecialåŒºåŸŸå†…å®šä¹‰çš„æ•°å€¼ï¼Œä½¿ç”¨%nameçš„å¥½å¤„æ˜¯ä½ èƒ½å¤Ÿé’ˆå¯¹ä¸åŒçš„æŠ€èƒ½ç­‰çº§å®šä¹‰ä¸åŒçš„æ•°å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨æŠ€èƒ½çš„è¯´æ˜ä¸­ç›´æ¥å¼•ç”¨è¿™ä¸ªæ•°å€¼ï¼Œåœ¨æœ¬ç¤ºä¾‹ä¸­ï¼ŒModifierçš„æŒç»­æ—¶é—´ï¼ˆâ€œDurationâ€ï¼‰å¼•ç”¨äº†AbilitySpecialä¸­çš„æ•°å€¼ï¼Œå‡é€Ÿçš„æ•°å€¼æ˜¯ç›´æ¥å†™çš„æ•°å­—ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">"creature_slithereen_crush_slow"</span><br><span class="line">{</span><br><span class="line">    "Duration"      "%slow_duration"</span><br><span class="line">    "Properties"</span><br><span class="line">    {</span><br><span class="line">        "MODIFIER_PROPERTY_MOVESPEED_BONUS_PERCENTAGE"      "-20"</span><br><span class="line">        "MODIFIER_PROPERTY_ATTACKSPEED_BONUS_CONSTANT"      "-20"</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Modifier-å±æ€§åˆ—è¡¨">Modifier å±æ€§åˆ—è¡¨</h3>
<table>
<thead>
<tr>
<th style="text-align:center">åç§°</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_ABSOLUTE_NO_DAMAGE_MAGICAL</td>
<td style="text-align:center">æ‰€æœ‰é­”æ³•æ”»å‡»æ— æ•ˆ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_ABSOLUTE_NO_DAMAGE_PHYSICAL</td>
<td style="text-align:center">æ‰€æœ‰ç‰©ç†æ”»å‡»æ— æ•ˆ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_ABSOLUTE_NO_DAMAGE_PURE</td>
<td style="text-align:center">æ‰€æœ‰ç¥åœ£ä¼¤å®³æ— æ•ˆ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_ABSORB_SPELL</td>
<td style="text-align:center">å·å–æ³•æœ¯ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_ATTACK_RANGE_BONUS</td>
<td style="text-align:center">ä¿®æ”¹æ”»å‡»èŒƒå›´</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_ATTACK_RANGE_BONUS_UNIQUE</td>
<td style="text-align:center">æ”»å‡»è·ç¦»å¢ç›Šï¼ˆä¸å åŠ ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_ATTACKSPEED_BONUS_CONSTANT</td>
<td style="text-align:center">ä¿®æ”¹æ”»å‡»é€Ÿåº¦</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_ATTACKSPEED_BONUS_CONSTANT_POWER_TREADS</td>
<td style="text-align:center"><em>æš‚æ— è¯´æ˜</em></td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_ATTACKSPEED_BONUS_CONSTANT_SECONDARY</td>
<td style="text-align:center"><em>æš‚æ— è¯´æ˜</em></td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_AVOID_CONSTANT</td>
<td style="text-align:center">è™šç©ºå‡é¢çš„é—ªé¿ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_AVOID_SPELL</td>
<td style="text-align:center">è™šç©ºå‡é¢çš„æ³•æœ¯é—ªé¿ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_BASEATTACK_BONUSDAMAGE</td>
<td style="text-align:center">ä¿®æ”¹åŸºç¡€æ”»å‡»åŠ›</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_BASE_ATTACK_TIME_CONSTANT</td>
<td style="text-align:center">è®¾å®šåŸºç¡€æ”»å‡»é—´éš”</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_BASEDAMAGEOUTGOING_PERCENTAGE</td>
<td style="text-align:center">ä¿®æ”¹åŸºç¡€æ”»å‡»ä¼¤å®³</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_BASE_MANA_REGEN</td>
<td style="text-align:center">ä¿®æ”¹åŸºç¡€é­”æ³•å›å¤æ•°å€¼ï¼Œå¯¹ç™¾åˆ†æ¯”å›é­”æœ‰å½±å“</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_BONUS_DAY_VISION</td>
<td style="text-align:center">ä¿®æ”¹ç™½å¤©çš„è§†é‡è·ç¦»</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_BONUS_NIGHT_VISION</td>
<td style="text-align:center">ä¿®æ”¹å¤œé—´çš„è§†é‡è·ç¦»</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_BONUS_VISION_PERCENTAGE</td>
<td style="text-align:center">æŒ‰ç™¾åˆ†æ¯”ä¿®æ”¹è§†é‡è·ç¦»</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_CAST_RANGE_BONUS</td>
<td style="text-align:center">æ–½æ³•è·ç¦»å¢ç›Š</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_CHANGE_ABILITY_VALUE</td>
<td style="text-align:center">æ”¹å˜æŠ€èƒ½æ•°å€¼</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_COOLDOWN_PERCENTAGE_STACKING</td>
<td style="text-align:center">å†·å´æ—¶é—´ç™¾åˆ†æ¯”å †å </td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_COOLDOWN_REDUCTION_CONSTANT</td>
<td style="text-align:center">å‡å°‘å†·å´æ—¶é—´</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_DAMAGEOUTGOING_PERCENTAGE</td>
<td style="text-align:center">æŒ‰ç™¾åˆ†æ¯”ä¿®æ”¹æ”»å‡»åŠ›ï¼Œè´Ÿæ•°é™ä½æ”»å‡»ï¼Œæ­£æ•°æé«˜æ”»å‡»</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_DAMAGEOUTGOING_PERCENTAGE_ILLUSION</td>
<td style="text-align:center">é™ä½å¹»è±¡æ”»å‡»åŠ›æ¯”ä¾‹</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_DEATHGOLDCOST</td>
<td style="text-align:center">ä¿®æ”¹æ­»äº¡æŸå¤±çš„é‡‘é’±</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_DISABLE_AUTOATTACK</td>
<td style="text-align:center">ç¦æ­¢è‡ªåŠ¨æ”»å‡»</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_DISABLE_HEALING</td>
<td style="text-align:center">ç¦æ­¢ç”Ÿå‘½å›å¤(1ä¸ºç¦æ­¢)</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_DISABLE_TURNING</td>
<td style="text-align:center">ç¦æ­¢è½¬èº«</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_EVASION_CONSTANT</td>
<td style="text-align:center">é—ªé¿</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_EXTRA_HEALTH_BONUS</td>
<td style="text-align:center"><em>æ— æ•ˆ</em>é¢å¤–ç”Ÿå‘½å€¼åŠ æˆ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_EXTRA_MANA_BONUS</td>
<td style="text-align:center"><em>æ— æ•ˆ</em>é¢å¤–é­”æ³•å€¼åŠ æˆ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_EXTRA_STRENGTH_BONUS</td>
<td style="text-align:center"><em>æ— æ•ˆ</em>é¢å¤–åŠ›é‡åŠ æˆ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_FORCE_DRAW_MINIMAP</td>
<td style="text-align:center"><em>æš‚æ— è¯´æ˜</em></td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_HEALTH_BONUS</td>
<td style="text-align:center">ä¿®æ”¹ç›®å‰è¡€é‡</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_HEALTH_REGEN_CONSTANT</td>
<td style="text-align:center">å›ºå®šçš„ç”Ÿå‘½å›å¤æ•°å€¼</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_HEALTH_REGEN_PERCENTAGE</td>
<td style="text-align:center">æ ¹æ®è£…å¤‡å¸¦æ¥çš„æœ€å¤§è¡€é‡æ‰€äº§ç”Ÿçš„è¡€é‡å›å¤æ•°å€¼</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_IGNORE_CAST_ANGLE</td>
<td style="text-align:center">å¿½ç•¥æ–½æ³•è§’åº¦</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_INCOMING_DAMAGE_PERCENTAGE</td>
<td style="text-align:center">æŒ‰ç™¾åˆ†æ¯”ä¿®æ”¹å—åˆ°çš„æ‰€æœ‰ä¼¤å®³ï¼Œè´Ÿæ•°é™ä½ä¼¤å®³ï¼Œæ­£æ•°åŠ æ·±ä¼¤å®³</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_INCOMING_PHYSICAL_DAMAGE_CONSTANT</td>
<td style="text-align:center">æ‰€å—ç‰©ç†ä¼¤å®³æ•°å€¼ï¼ˆæ•°å€¼ç‰©ç†ä¼¤å®³å‡å…/å¢åŠ ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_INCOMING_PHYSICAL_DAMAGE_PERCENTAGE</td>
<td style="text-align:center">æŒ‰ç™¾åˆ†æ¯”ä¿®æ”¹å—åˆ°çš„ç‰©ç†ä¼¤å®³ï¼Œè´Ÿæ•°é™ä½ä¼¤å®³ï¼Œæ­£æ•°åŠ æ·±ä¼¤å®³</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_INCOMING_SPELL_DAMAGE_CONSTANT</td>
<td style="text-align:center">æŒ‰ç™¾åˆ†æ¯”ä¿®æ”¹å—åˆ°çš„æŠ€èƒ½ä¼¤å®³ï¼Œè´Ÿæ•°é™ä½ä¼¤å®³ï¼Œæ­£æ•°åŠ æ·±ä¼¤å®³</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_INVISIBILITY_LEVEL</td>
<td style="text-align:center">éšèº«ç­‰çº§ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_IS_ILLUSION</td>
<td style="text-align:center">æ˜¯å¦ä¸ºæŸä¸ªå•ä½çš„å¹»è±¡</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_IS_SCEPTER</td>
<td style="text-align:center">æ˜¯å¦æºå¸¦è“æ–ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_LIFETIME_FRACTION</td>
<td style="text-align:center"><em>æš‚æ— è¯´æ˜</em></td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MAGICAL_RESISTANCE_BONUS</td>
<td style="text-align:center">é­”æ³•æŠ—æ€§ï¼Œå¯¹ç¥åœ£ä¼¤å®³æ— æ•ˆï¼Œå¯ä»¥ç´¯åŠ </td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MAGICAL_RESISTANCE_DECREPIFY_UNIQUE</td>
<td style="text-align:center">éª¨æ³•çš„è¡°è€ï¼Œå½±å“é­”æ³•æŠ—æ€§ï¼Œä¸å¯ç´¯åŠ </td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MAGICAL_RESISTANCE_ITEM_UNIQUE</td>
<td style="text-align:center">é­”æ³•æŠ—æ€§ï¼Œå¯¹ç¥åœ£ä¼¤å®³æ— æ•ˆï¼Œä¸å¯ä»¥ç´¯åŠ </td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MAGICDAMAGEOUTGOING_PERCENTAGE</td>
<td style="text-align:center">é­”æ³•è¾“å‡ºç™¾åˆ†æ¯”ï¼ˆç™¾åˆ†æ¯”æ³•ä¼¤å¢ç›Š/å‡ç›Šï¼‰</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MANA_BONUS</td>
<td style="text-align:center">ä¿®æ”¹ç›®å‰é­”æ³•é‡</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MANA_REGEN_CONSTANT</td>
<td style="text-align:center">ä¿®æ”¹åŸºç¡€é­”æ³•å›å¤æ•°å€¼ï¼Œå¯¹ç™¾åˆ†æ¯”å›é­”æ²¡æœ‰å½±å“</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MANA_REGEN_CONSTANT_UNIQUE</td>
<td style="text-align:center">ä¿®æ”¹åŸºç¡€é­”æ³•å›å¤æ•°å€¼ï¼Œå¯¹ç™¾åˆ†æ¯”å›é­”æ²¡æœ‰å½±å“ï¼Œä¸” ä¸å¯ç´¯ç§¯</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MANA_REGEN_PERCENTAGE</td>
<td style="text-align:center">ä¿®æ”¹åŸºç¡€é­”æ³•å›å¤æ•°å€¼</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MANA_REGEN_TOTAL_PERCENTAGE</td>
<td style="text-align:center">ä¿®æ”¹æ‰€æœ‰é­”æ³•å›å¤æ•°å€¼</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MAX_ATTACK_RANGE</td>
<td style="text-align:center">æœ€å¤§æ”»å‡»è·ç¦»å¢ç›Š</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MIN_HEALTH</td>
<td style="text-align:center">è¡€é‡åœ¨è®¾å®šå€¼ä»¥ä¸‹æ˜¯ä¸èƒ½æ€æ­»ï¼ˆæ–§ç‹çš„æ–©æ€ä¾ç„¶æœ‰æ•ˆï¼‰</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MISS_PERCENTAGE</td>
<td style="text-align:center">å¢åŠ missçš„å‡ ç‡</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MODEL_CHANGE</td>
<td style="text-align:center">è®¾å®šæ¨¡å‹</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MODEL_SCALE</td>
<td style="text-align:center">è®¾å®šæ¨¡å‹å¤§å°</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MOVESPEED_ABSOLUTE</td>
<td style="text-align:center">è®¾ç½®ç§»åŠ¨é€Ÿåº¦</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MOVESPEED_BASE_OVERRIDE</td>
<td style="text-align:center">è®¾å®šåŸºç¡€ç§»åŠ¨é€Ÿåº¦</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MOVESPEED_BONUS_CONSTANT</td>
<td style="text-align:center">å¢åŠ ç§»åŠ¨é€Ÿåº¦æ•°å€¼</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MOVESPEED_BONUS_PERCENTAGE</td>
<td style="text-align:center">ç™¾åˆ†æ¯”å¢åŠ ç§»åŠ¨é€Ÿåº¦ï¼Œè‡ªèº«ä¸å åŠ </td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MOVESPEED_BONUS_PERCENTAGE_UNIQUE</td>
<td style="text-align:center">ç‹¬ç«‹ç™¾åˆ†æ¯”å¢åŠ ç§»åŠ¨é€Ÿåº¦ï¼Œä¸å åŠ </td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MOVESPEED_BONUS_UNIQUE</td>
<td style="text-align:center">å¢åŠ ç§»åŠ¨é€Ÿåº¦æ•°å€¼ï¼Œä¸å åŠ ï¼Œç‰©å“ç‰ˆæœ¬</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MOVESPEED_LIMIT</td>
<td style="text-align:center">é™åˆ¶ç§»åŠ¨é€Ÿåº¦</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_MOVESPEED_MAX</td>
<td style="text-align:center">è®¾ç½®æœ€å¤§ç§»åŠ¨é€Ÿåº¦</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_NEGATIVE_EVASION_CONSTANT</td>
<td style="text-align:center">é™ä½é—ªé¿æ¦‚ç‡</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_OVERRIDE_ANIMATION</td>
<td style="text-align:center">å¼ºåˆ¶æ’­æ”¾æ¨¡å‹åŠ¨ä½œ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_OVERRIDE_ANIMATION_RATE</td>
<td style="text-align:center">è®¾ç½®æ’­æ”¾æ¨¡å‹åŠ¨ä½œå¿«æ…¢</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_OVERRIDE_ANIMATION_WEIGHT</td>
<td style="text-align:center">å¼ºåˆ¶æ’­æ”¾æ¨¡å‹åŠ¨ä½œ_é‡ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_OVERRIDE_ATTACK_MAGICAL</td>
<td style="text-align:center">é­”æ³•æ”»å‡»</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PERSISTENT_INVISIBILITY</td>
<td style="text-align:center">æ°¸ä¹…æ€§éšèº«</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PHYSICAL_ARMOR_BONUS</td>
<td style="text-align:center">å¢åŠ æŠ¤ç”²</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PHYSICAL_ARMOR_BONUS_ILLUSIONS</td>
<td style="text-align:center">å¢åŠ å¹»è±¡çš„æŠ¤ç”²</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PHYSICAL_ARMOR_BONUS_UNIQUE</td>
<td style="text-align:center">å¢åŠ æŠ¤ç”²ï¼Œä¸å¯å åŠ </td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PHYSICAL_ARMOR_BONUS_UNIQUE_ACTIVE</td>
<td style="text-align:center">æ”¹å˜åœ†ç›¾å‡ä¼¤çš„æ•ˆæœï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PHYSICAL_CONSTANT_BLOCK</td>
<td style="text-align:center">æ•°å€¼å‡å…ä¼¤å®³ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_POST_ATTACK</td>
<td style="text-align:center">å¢åŠ æ”»å‡»åŠ›ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PREATTACK_BONUS_DAMAGE</td>
<td style="text-align:center">ä¿®æ”¹é™„åŠ æ”»å‡»åŠ›</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PREATTACK_BONUS_DAMAGE_POST_CRIT</td>
<td style="text-align:center">ä»¥å¢åŠ ä¼¤å®³çš„æ–¹å¼ä¿®æ”¹ä¼¤å®³å€¼ï¼Œä¸è®¡å…¥æš´å‡»è®¡ç®—</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PREATTACK_CRITICALSTRIKE</td>
<td style="text-align:center">è‡´å‘½ä¸€å‡»</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PROCATTACK_BONUS_DAMAGE_COMPOSITE</td>
<td style="text-align:center">ä¿®æ”¹åœ¨æ™®é€šæ”»å‡»åè®¡ç®—çš„ç¥åœ£ä¼¤å®³</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PROCATTACK_BONUS_DAMAGE_MAGICAL</td>
<td style="text-align:center">ä¿®æ”¹åœ¨æ™®é€šæ”»å‡»åè®¡ç®—çš„é­”æ³•ä¼¤å®³</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PROCATTACK_BONUS_DAMAGE_PHYSICAL</td>
<td style="text-align:center">ä¿®æ”¹åœ¨æ™®é€šæ”»å‡»åè®¡ç®—çš„ç‰©ç†ä¼¤å®³</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PROCATTACK_BONUS_DAMAGE_PURE</td>
<td style="text-align:center">ä¿®æ”¹åœ¨æ™®é€šæ”»å‡»åè®¡ç®—çš„ç¥åœ£ä¼¤å®³</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PROCATTACK_FEEDBACK</td>
<td style="text-align:center">æ³•åŠ›ç‡ƒçƒ§ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_PROVIDES_FOW_POSITION</td>
<td style="text-align:center"><em>æš‚æ— è¯´æ˜</em></td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_REINCARNATION</td>
<td style="text-align:center">ä¸æœ½ä¹‹å®ˆæŠ¤æˆ–è€…æ˜¯éª·é«…ç‹çš„å¤§æ‹›ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_RESPAWNTIME</td>
<td style="text-align:center">ä¿®æ”¹é‡ç”Ÿæ—¶é—´</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_RESPAWNTIME_PERCENTAGE</td>
<td style="text-align:center">ç™¾åˆ†æ¯”ä¿®æ”¹é‡ç”Ÿæ—¶é—´</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_RESPAWNTIME_STACKING</td>
<td style="text-align:center">ç´¯ç§¯é‡ç”Ÿæ—¶é—´</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_STATS_AGILITY_BONUS</td>
<td style="text-align:center">ä¿®æ”¹æ•æ·</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_STATS_INTELLECT_BONUS</td>
<td style="text-align:center">ä¿®æ”¹æ™ºåŠ›</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_STATS_STRENGTH_BONUS</td>
<td style="text-align:center">ä¿®æ”¹åŠ›é‡</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_SUPER_ILLUSION_WITH_ULTIMATE</td>
<td style="text-align:center">VS Aæ–å¤§æ‹›çš„é‚£ä¸ªå¹»è±¡</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_TOOLTIP</td>
<td style="text-align:center">å¯è¢«ç”¨äºä»»ä½•æç¤ºï¼Œ æ¯”å¦‚è‡‚ç« çš„è¡€é‡ç§»é™¤</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_TOTAL_CONSTANT_BLOCK</td>
<td style="text-align:center">å‡å…æ‰€æœ‰æ¥æºçš„ä¼¤å®³</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_TOTAL_CONSTANT_BLOCK_UNAVOIDABLE_PRE_ARMOR</td>
<td style="text-align:center">å¯¹äºè‡ªåŠ¨æ”»å‡»çš„ä¼¤å®³å‡å…</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_TOTALDAMAGEOUTGOING_PERCENTAGE</td>
<td style="text-align:center">å¤±æ•ˆï¼Œä¸å·¥ä½œ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_TRANSLATE_ACTIVITY_MODIFIERS</td>
<td style="text-align:center">åŠ¨ä½œä¿®æ”¹ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_TRANSLATE_ATTACK_SOUND</td>
<td style="text-align:center">æ”»å‡»éŸ³æ•ˆä¿®æ”¹ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_PROPERTY_TURN_RATE_PERCENTAGE</td>
<td style="text-align:center">ç™¾åˆ†æ¯”ä¿®æ”¹è½¬å‘é€Ÿåº¦</td>
</tr>
</tbody>
</table>
<h2 id="Modifier-çŠ¶æ€">Modifier çŠ¶æ€</h2>
<p>ModifierçŠ¶æ€å’ŒModifierå±æ€§ååˆ†ç±»ä¼¼ï¼Œåªä¸è¿‡ä»–ä»¬æ˜¯åªæœ‰ä¸‰ä¸ªæ•°å€¼ï¼šâ€œMODIFIER_STATE_VALUE_NO_ACTIONâ€(ä¸ä½œä¸º), â€œMODIFIER_STATE_VALUE_ENABLEDâ€(å¯ç”¨) æˆ–è€… â€œMODIFIER_STATE_VALUE_DISABLEDâ€(ç¦ç”¨)ã€‚ä»¥ä¸‹çš„modifierç¤ºä¾‹ç»™å•ä½æ·»åŠ äº†ä¸€ä¸ªç®€å•çš„çœ©æ™•ç²’å­ç‰¹æ•ˆï¼Œè¦†ç›–äº†å•ä½çš„æ¨¡å‹æ“ä½œï¼Œè®©å•ä½è¿›å…¥äº†çœ©æ™•çŠ¶æ€ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">"creature_bash_ministun"</span><br><span class="line">{</span><br><span class="line">    "Duration"              "%duration"</span><br><span class="line">    "EffectName"            "generic_stunned"</span><br><span class="line">    "EffectAttachType"      "follow_overhead"</span><br><span class="line">    "Duration"              "%stun_duration"</span><br><span class="line">    "OverrideAnimation"     "ACT_DOTA_DISABLED"</span><br><span class="line">    "States"</span><br><span class="line">    {</span><br><span class="line">        "MODIFIER_STATE_STUNNED" "MODIFIER_STATE_VALUE_ENABLED"</span><br><span class="line">    }       </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ModifierçŠ¶æ€åˆ—è¡¨">ModifierçŠ¶æ€åˆ—è¡¨</h3>
<table>
<thead>
<tr>
<th style="text-align:center">åç§°</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">MODIFIER_STATE_ATTACK_IMMUNE</td>
<td style="text-align:center">æ”»å‡»å…ç–«çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_BLIND</td>
<td style="text-align:center">è‡´ç›²çŠ¶æ€ï¼Ÿæ— æ³•ç‰©ç†æ”»å‡»ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_BLOCK_DISABLED</td>
<td style="text-align:center">ç¦ç”¨ä¼¤å®³å‡å…ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_CANNOT_MISS</td>
<td style="text-align:center">ä¸èƒ½é—ªé¿ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_COMMAND_RESTRICTED</td>
<td style="text-align:center">ç¦é­”çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_DISARMED</td>
<td style="text-align:center">ç¼´æ¢°çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_DOMINATED</td>
<td style="text-align:center">æ”¯é…çŠ¶æ€ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_EVADE_DISABLED</td>
<td style="text-align:center">ç¦ç”¨èº²é¿ï¼Ÿ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_FLYING</td>
<td style="text-align:center">é£è¡ŒçŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_FROZEN</td>
<td style="text-align:center">å†·å†»çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_HEXED</td>
<td style="text-align:center">å¦–æœ¯çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_INVISIBLE</td>
<td style="text-align:center">éšèº«çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_INVULNERABLE</td>
<td style="text-align:center">æ— æ•ŒçŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_LOW_ATTACK_PRIORITY</td>
<td style="text-align:center">ä½çš„æ”»å‡»ä¼˜å…ˆçº§</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_MAGIC_IMMUNE</td>
<td style="text-align:center">é­”æ³•å…ç–«çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_MUTED</td>
<td style="text-align:center">ç¦ç”¨ç‰©å“çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_NIGHTMARED</td>
<td style="text-align:center">å‚¬çœ çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_NO_HEALTH_BAR</td>
<td style="text-align:center">æ²¡æœ‰ç”Ÿå‘½æ¡</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_NO_TEAM_MOVE_TO</td>
<td style="text-align:center">æ²¡æœ‰ç§»åŠ¨åˆ°é˜Ÿä¼çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_NO_TEAM_SELECT</td>
<td style="text-align:center">æ²¡æœ‰é€‰æ‹©é˜Ÿä¼çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_NOT_ON_MINIMAP</td>
<td style="text-align:center">ä¸åœ¨å°åœ°å›¾çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_NOT_ON_MINIMAP_FOR_ENEMIES</td>
<td style="text-align:center">æ•Œäººä¸åœ¨å°åœ°å›¾çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_NO_UNIT_COLLISION</td>
<td style="text-align:center">æ²¡æœ‰å•ä½ç¢°æ’çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_OUT_OF_GAME</td>
<td style="text-align:center">ç¦»å¼€æ¸¸æˆçŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_PASSIVES_DISABLED</td>
<td style="text-align:center">ç¦ç”¨è¢«åŠ¨æŠ€èƒ½çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_PROVIDES_VISION</td>
<td style="text-align:center">æä¾›è§†é‡çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_ROOTED</td>
<td style="text-align:center">è¢«ç¼ ç»•çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_SILENCED</td>
<td style="text-align:center">æ²‰é»˜çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_SOFT_DISARMED</td>
<td style="text-align:center">è½¯è§£é™¤æ­¦è£…çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_SPECIALLY_DENIABLE</td>
<td style="text-align:center"><em>æš‚æ— è¯´æ˜</em></td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_STUNNED</td>
<td style="text-align:center">çœ©æ™•çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_STATE_UNSELECTABLE</td>
<td style="text-align:center">æ— æ³•é€‰å–çŠ¶æ€</td>
</tr>
</tbody>
</table>
<h2 id="Modifier-äº‹ä»¶">Modifier äº‹ä»¶</h2>
<p>Modifiersä¹Ÿå¯ä»¥å®šä¹‰ä¸€äº›è§¦å‘äº‹ä»¶ï¼Œä»¥ä¸‹çš„è¿™äº›äº‹ä»¶èƒ½å¤Ÿåœ¨modifierä¸­å®šä¹‰ - æ“ä½œåœ¨æœ¬é¡µé¢å…¶ä»–ä½ç½®å·²ç»æåŠäº†</p>
<table>
<thead>
<tr>
<th style="text-align:center">è§¦å‘äº‹ä»¶åç§°</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">OnAttacked</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½è¢«æ”»å‡»æ—¶</td>
</tr>
<tr>
<td style="text-align:center">OnAttackLanded</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½æ”»å‡»åˆ°æŸä¸ªç›®æ ‡æ—¶</td>
</tr>
<tr>
<td style="text-align:center">OnAttackStart</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½å¼€å§‹æ”»å‡»æŸä¸ªç›®æ ‡</td>
</tr>
<tr>
<td style="text-align:center">OnCreated</td>
<td style="text-align:center">å½“modifierè¢«åˆ›å»ºæ—¶</td>
</tr>
<tr>
<td style="text-align:center">OnDealDamage</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½æ–½åŠ ä¼¤å®³çš„æ—¶å€™</td>
</tr>
<tr>
<td style="text-align:center">OnDeath</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½æ­»äº¡çš„æ—¶å€™</td>
</tr>
<tr>
<td style="text-align:center">OnDestroy</td>
<td style="text-align:center">å½“è¿™ä¸ªmodifierè¢«ç§»é™¤çš„æ—¶å€™</td>
</tr>
<tr>
<td style="text-align:center">OnOrbFire</td>
<td style="text-align:center">å½“æ³•çƒmodifierçš„æ³•çƒè¢«é‡Šæ”¾çš„æ—¶å€™</td>
</tr>
<tr>
<td style="text-align:center">OnOrbImpact</td>
<td style="text-align:center">å½“æ³•çƒmodifierçš„æ³•çƒå‘½ä¸­ç›®æ ‡ä¹‹å</td>
</tr>
<tr>
<td style="text-align:center">OnTakeDamage</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½å—åˆ°ä¼¤å®³çš„æ—¶å€™</td>
</tr>
<tr>
<td style="text-align:center">Orb</td>
<td style="text-align:center">å®šä¹‰ä¸€ä¸ªæ³•çƒmodifeirçš„ç‰¹æ•ˆç­‰</td>
</tr>
<tr>
<td style="text-align:center">OnIntervalThink</td>
<td style="text-align:center">å¾ªç¯æ‰§è¡Œå®šæ—¶å™¨æ“ä½œã€‚åœ¨CreateThinker(åˆ›å»ºå®šæ—¶å™¨)ä¸‹ä½¿ç”¨ï¼Œé…åˆDuration(æŒç»­æ—¶é—´)ï¼ŒThinkInterval(é—´éš”)ã€‚</td>
</tr>
<tr>
<td style="text-align:center">æ–°äº‹ä»¶(14/08/26æ›´æ–°)</td>
<td style="text-align:center">æè¿°</td>
</tr>
<tr>
<td style="text-align:center">OnAttack</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">OnAttackFailed</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½æ”»å‡»å¤±è´¥æ—¶</td>
</tr>
<tr>
<td style="text-align:center">OnAttackAllied</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½æ”»å‡»ç›Ÿå‹æ—¶</td>
</tr>
<tr>
<td style="text-align:center">OnProjectileDodge</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½é—ªé¿å¼¹é“ç²’å­ç‰¹æ•ˆæ—¶</td>
</tr>
<tr>
<td style="text-align:center">OnEquip</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½è£…å¤‡ç‰©å“</td>
</tr>
<tr>
<td style="text-align:center">OnOrder</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½æ‰§è¡ŒæŒ‡ä»¤</td>
</tr>
<tr>
<td style="text-align:center">OnUnitMoved</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½ç§»åŠ¨çš„æ—¶å€™</td>
</tr>
<tr>
<td style="text-align:center">OnAbilityStart</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½å¼€å§‹ä½¿ç”¨æŠ€èƒ½</td>
</tr>
<tr>
<td style="text-align:center">OnAbilityEndChannel</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½ç»“æŸæŒç»­æ–½æ³•</td>
</tr>
<tr>
<td style="text-align:center">OnStateChanged</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½çŠ¶æ€æ”¹å˜æ—¶</td>
</tr>
<tr>
<td style="text-align:center">OnRespawn</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½é‡ç”Ÿ</td>
</tr>
<tr>
<td style="text-align:center">OnSpentMana</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½èŠ±è´¹é­”æ³•æ—¶</td>
</tr>
<tr>
<td style="text-align:center">OnTeleporting</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½æ­£åœ¨ä¼ é€æ—¶</td>
</tr>
<tr>
<td style="text-align:center">OnTeleported</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½ä¼ é€ç»“æŸæ—¶</td>
</tr>
<tr>
<td style="text-align:center">OnHealthGained</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½è·å¾—ç”Ÿå‘½å€¼</td>
</tr>
<tr>
<td style="text-align:center">OnManaGained</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½è·å¾—é­”æ³•å€¼</td>
</tr>
<tr>
<td style="text-align:center">OnHeroKilled</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½è¢«è‹±é›„æ€äº†</td>
</tr>
<tr>
<td style="text-align:center">OnHealReceived</td>
<td style="text-align:center">å½“æ‹¥æœ‰modifierçš„å•ä½å—åˆ°æ²»ç–—</td>
</tr>
</tbody>
</table>
<h3 id="Modifieräº‹ä»¶åˆ—è¡¨">Modifieräº‹ä»¶åˆ—è¡¨</h3>
<p>è¿™äº›äº‹ä»¶å¹¶ä¸å¯ä»¥åº”ç”¨åœ¨æ‰€æœ‰çš„æ•°æ®é©±åŠ¨ç±»æŠ€èƒ½ä¸­ï¼Œä»…ä½œä¸ºå‚è€ƒã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">åç§°</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_ABILITY_END_CHANNEL</td>
<td style="text-align:center">å½“æŒç»­æ€§æ–½æ³•å®Œæˆ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_ABILITY_EXECUTED</td>
<td style="text-align:center">å½“æ–½æ³•æ‰§è¡Œå®Œ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_ABILITY_START</td>
<td style="text-align:center">å½“æ–½æ³•å¼€å§‹æ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_ATTACK</td>
<td style="text-align:center">å½“æ”»å‡»æ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_ATTACK_ALLIED</td>
<td style="text-align:center">å½“æ”»å‡»ç›Ÿå†›æ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_ATTACKED</td>
<td style="text-align:center">å½“æ”»å‡»ç»“æŸæ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_ATTACK_FAIL</td>
<td style="text-align:center">å½“æ”»å‡»å¤±è´¥</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_ATTACK_LANDED</td>
<td style="text-align:center">å½“æ”»å‡»å‡»ä¸­æ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_ATTACK_START</td>
<td style="text-align:center">å½“æ”»å‡»å¼€å§‹æ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_BREAK_INVISIBILITY</td>
<td style="text-align:center">å½“æ‰“ç ´éšèº«çŠ¶æ€</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_DEATH</td>
<td style="text-align:center">å½“æ­»äº¡æ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_HEAL_RECEIVED</td>
<td style="text-align:center">å½“æ”¶åˆ°æ²»ç–—</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_HEALTH_GAINED</td>
<td style="text-align:center">å½“è·å¾—ç”Ÿå‘½å€¼</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_HERO_KILLED</td>
<td style="text-align:center">å½“è‹±é›„æ­»äº¡</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_MANA_GAINED</td>
<td style="text-align:center">å½“è·å¾—é­”æ³•å€¼</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_ORB_EFFECT</td>
<td style="text-align:center">å½“åœ¨æ³•çƒæ•ˆæœ</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_ORDER</td>
<td style="text-align:center">å½“å‘½ä»¤ç»“æŸæ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_PROCESS_UPGRADE</td>
<td style="text-align:center">å½“åœ¨å‡çº§è¿‡ç¨‹ä¸­</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_PROJECTILE_DODGE</td>
<td style="text-align:center">å½“é—ªé¿å¼¹é“æ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_REFRESH</td>
<td style="text-align:center">å½“åˆ·æ–°æ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_RESPAWN</td>
<td style="text-align:center">å½“é‡ç”Ÿæ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_SPENT_MANA</td>
<td style="text-align:center">å½“èŠ±è´¹é­”æ³•å€¼æ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_STATE_CHANGED</td>
<td style="text-align:center">å½“çŠ¶æ€æ”¹å˜æ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_TAKEDAMAGE</td>
<td style="text-align:center">å½“å¸¦æ¥ä¼¤å®³æ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_TAKEDAMAGE_REAPERSCYTHE</td>
<td style="text-align:center">å½“åœ¨æ­»ç¥é•°åˆ€ä¸‹å¸¦æ¥ä¼¤å®³æ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_TELEPORTED</td>
<td style="text-align:center">å½“åœ¨ä¼ é€ç»“æŸæ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_TELEPORTING</td>
<td style="text-align:center">å½“æ­£åœ¨ä¼ é€æ—¶</td>
</tr>
<tr>
<td style="text-align:center">MODIFIER_EVENT_ON_UNIT_MOVED</td>
<td style="text-align:center">å½“å•ä½ç§»åŠ¨æ—¶</td>
</tr>
</tbody>
</table>
<h1>æ•°æ®é©±åŠ¨ç±»æŠ€èƒ½èŒƒä¾‹</h1>
<p>&lt; <a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools:zh-cn">Dota 2 Workshop Tools:zh-cn</a>â€ | <a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools:zh-cn/Scripting:zh-cn">Scripting:zh-cn</a><br>
<strong><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Scripting/Abilities_Data_Driven_Examples"><img src="https://developer.valvesoftware.com/w/images/3/3b/En.png" alt="English"></a></strong></p>
<h2 id="Contents">Contents</h2>
<p>[hide]</p>
<ul>
<li><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools:zh-cn/Scripting:zh-cn/Abilities_Data_Driven_Example:zh-cn#.E5.8D.95.E4.BD.8D.E6.AD.BB.E4.BA.A1.E5.90.8E.E9.80.A0.E6.88.90.E6.8C.81.E7.BB.AD.E6.80.A7.E8.8C.83.E5.9B.B4.E4.BC.A4.E5.AE.B3.E7.9A.84.E4.BE.8B.E5.AD.90">1å•ä½æ­»äº¡åé€ æˆæŒç»­æ€§èŒƒå›´ä¼¤å®³çš„ä¾‹å­</a></li>
<li><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools:zh-cn/Scripting:zh-cn/Abilities_Data_Driven_Example:zh-cn#.E4.B8.80.E4.B8.AA.E6.B3.95.E7.90.83.E7.9A.84.E5.AE.9E.E4.BE.8B">2ä¸€ä¸ªæ³•çƒçš„å®ä¾‹</a></li>
<li><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools:zh-cn/Scripting:zh-cn/Abilities_Data_Driven_Example:zh-cn#.E7.B3.BB.E7.BB.9F.E5.85.89.E7.8E.AF.E5.AE.9E.E4.BE.8B">3ç³»ç»Ÿå…‰ç¯å®ä¾‹</a></li>
<li><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools:zh-cn/Scripting:zh-cn/Abilities_Data_Driven_Example:zh-cn#.E4.B8.80.E4.B8.AA.E8.87.AA.E5.AE.9A.E4.B9.89.E7.9A.84.E5.85.89.E7.8E.AF.E5.AE.9E.E4.BE.8B">4ä¸€ä¸ªè‡ªå®šä¹‰çš„å…‰ç¯å®ä¾‹</a></li>
</ul>
<h2 id="å•ä½æ­»äº¡åé€ æˆæŒç»­æ€§èŒƒå›´ä¼¤å®³çš„ä¾‹å­">å•ä½æ­»äº¡åé€ æˆæŒç»­æ€§èŒƒå›´ä¼¤å®³çš„ä¾‹å­</h2>
<p>æœ¬ç¤ºä¾‹åœ¨æŠ€èƒ½è¢«æ·»åŠ ä¹‹åï¼Œå°†ä¼šç­‰åˆ°æ‹¥æœ‰è€…æ­»äº¡ä¹‹åè§¦å‘ï¼Œå½“æ‹¥æœ‰è€…æ­»äº¡çš„æ—¶å€™ï¼Œä¸€ä¸ªå¸¦æœ‰é…¸é›¾ç‰¹æ•ˆå’Œä¸€ä¸ªé™ä½ç›®æ ‡åŒºåŸŸçš„å•ä½æŠ¤ç”²å¹¶æ–½åŠ ä¼¤å®³çš„è®¡æ—¶å™¨å°†ä¼šè¢«åˆ›å»ºã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">//=================================================================================================================</span><br><span class="line">// Creature: Acid Spray</span><br><span class="line">//=================================================================================================================</span><br><span class="line">"creature_acid_spray"</span><br><span class="line">{</span><br><span class="line"> // General</span><br><span class="line"> //-------------------------------------------------------------------------------------------------------------</span><br><span class="line"> "BaseClass" 					"ability_datadriven"</span><br><span class="line"> "AbilityBehavior"				"DOTA_ABILITY_BEHAVIOR_AOE"</span><br><span class="line"> "AbilityUnitDamageType"			"DAMAGE_TYPE_COMPOSITE"</span><br><span class="line"> "AbilityTextureName"			"alchemist_acid_spray"</span><br><span class="line"> // Casting</span><br><span class="line"> //-------------------------------------------------------------------------------------------------------------</span><br><span class="line"> "AbilityCastPoint"				"0.2"</span><br><span class="line"> "AbilityCastRange"				"900"</span><br><span class="line"> "OnOwnerDied"</span><br><span class="line"> {</span><br><span class="line">   "CreateThinker"</span><br><span class="line">   {</span><br><span class="line">    "ModifierName" "creature_acid_spray_thinker"</span><br><span class="line">    "Target" "CASTER"</span><br><span class="line">   }</span><br><span class="line"> }</span><br><span class="line"> "Modifiers"</span><br><span class="line"> {</span><br><span class="line">  "creature_acid_spray_thinker"</span><br><span class="line">  {</span><br><span class="line">   "Aura" "create_acid_spray_armor_reduction_aura"</span><br><span class="line">   "Aura_Radius" "%radius"</span><br><span class="line">   "Aura_Teams" "DOTA_UNIT_TARGET_TEAM_ENEMY"</span><br><span class="line">   "Aura_Types" "DOTA_UNIT_TARGET_HERO | DOTA_UNIT_TARGET_CREEP | DOTA_UNIT_TARGET_MECHANICAL"</span><br><span class="line">   "Aura_Flags" "DOTA_UNIT_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES"</span><br><span class="line">   "Duration" "%duration"</span><br><span class="line">   "OnCreated"</span><br><span class="line">   {</span><br><span class="line">    "AttachEffect"</span><br><span class="line">    {</span><br><span class="line">      "EffectName" "alchemist_acid_spray"</span><br><span class="line">      "EffectAttachType" "follow_origin"</span><br><span class="line">      "Target" "TARGET"</span><br><span class="line">      "ControlPoints"</span><br><span class="line">      {</span><br><span class="line">       "00" "0 0 0"</span><br><span class="line">       "01" "%radius 1 1"</span><br><span class="line">      }</span><br><span class="line">     }</span><br><span class="line">    }</span><br><span class="line">   }</span><br><span class="line">   "create_acid_spray_armor_reduction_aura"</span><br><span class="line">   {</span><br><span class="line">    "IsDebuff" "1"</span><br><span class="line">    "IsPurgable" "0"</span><br><span class="line">    "EffectName" "alchemist_acid_spray_debuff"			</span><br><span class="line">    "ThinkInterval" "%tick_rate"</span><br><span class="line">    "OnIntervalThink"</span><br><span class="line">    {</span><br><span class="line">      "Damage"</span><br><span class="line">      {</span><br><span class="line">       "Type" "DAMAGE_TYPE_COMPOSITE"</span><br><span class="line">       "Damage" "%damage"</span><br><span class="line">       "Target" "TARGET"</span><br><span class="line">      }</span><br><span class="line">     }</span><br><span class="line">     "Properties"</span><br><span class="line">     {</span><br><span class="line">       "MODIFIER_PROPERTY_PHYSICAL_ARMOR_BONUS" "%armor_reduction"</span><br><span class="line">     }</span><br><span class="line">    }</span><br><span class="line">   }</span><br><span class="line"> // Special</span><br><span class="line"> //-------------------------------------------------------------------------------------------------------------</span><br><span class="line"> "AbilitySpecial"</span><br><span class="line"> {</span><br><span class="line">  "01"</span><br><span class="line">  {</span><br><span class="line">   "var_type"				"FIELD_INTEGER"</span><br><span class="line">   "radius"				"250"</span><br><span class="line">  }</span><br><span class="line">  "02"</span><br><span class="line">  {</span><br><span class="line">   "var_type"				"FIELD_FLOAT"</span><br><span class="line">   "duration"				"16.0"</span><br><span class="line">  }</span><br><span class="line">  "03"</span><br><span class="line">  {</span><br><span class="line">   "var_type"				"FIELD_INTEGER"</span><br><span class="line">   "damage"				"118 128 138 158"</span><br><span class="line">  }</span><br><span class="line">  "04"</span><br><span class="line">  {</span><br><span class="line">   "var_type"				"FIELD_INTEGER"</span><br><span class="line">   "armor_reduction"		        "-3 -4 -5 -6"</span><br><span class="line">  }</span><br><span class="line">  "05"</span><br><span class="line">  {</span><br><span class="line">   "var_type"				"FIELD_FLOAT"</span><br><span class="line">   "tick_rate"				"1.0"</span><br><span class="line">  }</span><br><span class="line"> }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="ä¸€ä¸ªæ³•çƒçš„å®ä¾‹">ä¸€ä¸ªæ³•çƒçš„å®ä¾‹</h2>
<p>ä¸€ä¸ªå¯ä»¥é€ æˆèŒƒå›´æ€§ä¼¤å®³å’Œæ™•çœ©çš„æ³•çƒå®ä¾‹ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">"testOrb_Example"</span><br><span class="line"> {</span><br><span class="line">    "ID"    "10003"</span><br><span class="line">    "BaseClass"    "ability_datadriven"</span><br><span class="line">    "AbilityBehavior"    "DOTA_ABILITY_BEHAVIOR_UNIT_TARGET | DOTA_ABILITY_BEHAVIOR_AUTOCAST| DOTA_ABILITY_BEHAVIOR_ATTACK"</span><br><span class="line">    "AbilityUnitTargetTeam"    "DOTA_UNIT_TARGET_TEAM_ENEMY"</span><br><span class="line">    "AbilityUnitTargetType"    "DOTA_UNIT_TARGET_ALL"</span><br><span class="line">    "MaxLevel"    "1"</span><br><span class="line">    "AbilityCastPoint"    "0.0"</span><br><span class="line">    "AbilityCastRange"    "900"</span><br><span class="line">    "AbilityCooldown"    "0"</span><br><span class="line">    "AbilityManaCost"    "10"</span><br><span class="line">    "AbilitySpecial"</span><br><span class="line">    {</span><br><span class="line">        "01"</span><br><span class="line">        {</span><br><span class="line">            "var_type"    "FIELD_INTEGER"</span><br><span class="line">            "RangeDamage"    "75"</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    "Modifiers"</span><br><span class="line">    {</span><br><span class="line">        "TestOrb_Modifier"</span><br><span class="line">        {</span><br><span class="line">            "Passive"    "1"</span><br><span class="line">            "IsHidden"    "1"</span><br><span class="line">            "Orb"</span><br><span class="line">            {</span><br><span class="line">                "Priority"    "DOTA_ORB_PRIORITY_ABILITY"//æ³•çƒçš„ç±»å‹</span><br><span class="line">                //ä¸‹é¢æ˜¯ä¸€ä¸ªæŠ•å°„ç‰©ç‰¹æ•ˆçš„å®šä¹‰ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œä¸å°‘ç²’å­æ•ˆæœæ˜¯æ— æ³•å½¢æˆæ­£å¸¸çš„æŠ•å°„ç‰©æ•ˆæœï¼Œè€Œæ˜¯ä¼šç›´æ¥é™„ç€åˆ°ç›®æ ‡ä¸Šé¢æ’­æ”¾ã€‚</span><br><span class="line">                "ProjectileName"    "particles/units/heroes/hero_sven/sven_spell_storm_bolt.vpcf"</span><br><span class="line">                "CastAttack"    "1"</span><br><span class="line">            }</span><br><span class="line">            "OnOrbFire"</span><br><span class="line">            {</span><br><span class="line">                //è¿™ä¸‹é¢çš„è®¾å®šä¼šä½¿å¾—å½“ä½ å³é”®æ¿€æ´»è‡ªåŠ¨é‡Šæ”¾æ—¶è¿›è¡Œæ™®é€šæ”»å‡»ä¹Ÿèƒ½æ­£å¸¸æ¶ˆè€—é­”æ³•ï¼Œå¦åˆ™æ¿€æ´»è‡ªåŠ¨é‡Šæ”¾çŠ¶æ€ä¸‹ä¸ä¼šæ¶ˆè€—é­”æ³•ã€‚</span><br><span class="line">                "SpendMana"</span><br><span class="line">                {</span><br><span class="line">                    "Mana"    "%AbilityManaCost"</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            "OnOrbImpact"</span><br><span class="line">            {</span><br><span class="line">                "FireEffect"</span><br><span class="line">                {</span><br><span class="line">                    "EffectName"    "particles/units/heroes/hero_sven/sven_spell_warcry.vpcf"</span><br><span class="line">                    "EffectAttachType"    "attach_hitloc"</span><br><span class="line">                    "Target"    "TARGET"</span><br><span class="line">                }</span><br><span class="line">                "Damage"//å¯¹èŒƒå›´å†…å•ä½é€ æˆä¼¤å®³</span><br><span class="line">                {</span><br><span class="line">                    "Type"    "DAMAGE_TYPE_PURE"</span><br><span class="line">                    "Damage"    "%RangeDamage"//å’ŒAbilitySpecialé‡Œå®šä¹‰çš„RangeDamageä¸Šå¯¹åº”æ•°å€¼æŒ‚é’©ã€‚</span><br><span class="line">                    "Target"</span><br><span class="line">                    {</span><br><span class="line">                        "Center"    "TARGET"</span><br><span class="line">                        "Teams"    "DOTA_UNIT_TARGET_TEAM_ENEMY"</span><br><span class="line">                        "Type"    "DOTA_UNIT_TARGET_ALL"</span><br><span class="line">                        "Radius"    "275"</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                "Stun"//å‡»æ™•èŒƒå›´å†…å•ä½</span><br><span class="line">                {</span><br><span class="line">                    "Duration"    "2"</span><br><span class="line">                    "Target"</span><br><span class="line">                    {</span><br><span class="line">                        "Center"    "TARGET"</span><br><span class="line">                        "Teams"    "DOTA_UNIT_TARGET_TEAM_ENEMY"</span><br><span class="line">                        "Type"    "DOTA_UNIT_TARGET_ALL"</span><br><span class="line">                        "Radius"    "275"</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>
<h2 id="ç³»ç»Ÿå…‰ç¯å®ä¾‹">ç³»ç»Ÿå…‰ç¯å®ä¾‹</h2>
<p>ä¸€ä¸ªæ™®é€šçš„ç³»ç»Ÿå…‰ç¯å®ç°ï¼Œæ•ˆæœæ˜¯èŒƒå›´å†…æ•Œå†›å‡å°‘50%æ”»å‡»åŠ›ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">"TestSysAura"</span><br><span class="line"> {</span><br><span class="line">  "BaseClass" "ability_datadriven"</span><br><span class="line">  "AbilityBehavior" "DOTA_ABILITY_BEHAVIOR_AURA | DOTA_ABILITY_BEHAVIOR_PASSIVE"</span><br><span class="line">  "AbilityUnitTargetTeam" "DOTA_UNIT_TARGET_TEAM_ENEMY"</span><br><span class="line">  "AbilityUnitTargetType" "DOTA_UNIT_TARGET_ALL"</span><br><span class="line">  "AbilityTextureName" "alchemist_acid_spray"</span><br><span class="line">  "MaxLevel" "1"</span><br><span class="line"></span><br><span class="line">  "AbilityCastPoint"    "0.0"</span><br><span class="line">  "AbilityCastRange"    "500"</span><br><span class="line">  "AbilityCooldown"    "0"</span><br><span class="line">  "AbilityManaCost"    "0"</span><br><span class="line"></span><br><span class="line">  "AbilitySpecial"</span><br><span class="line">  {</span><br><span class="line">   "01"</span><br><span class="line">   {</span><br><span class="line">    "var_type" "FIELD_INTEGER"</span><br><span class="line">    "Range" "500"</span><br><span class="line">   }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  "Modifiers"</span><br><span class="line">  {</span><br><span class="line">   "TestSysAura_Modifier"</span><br><span class="line">   {</span><br><span class="line">    "Passive" "1"</span><br><span class="line">    "IsHidden" "1"</span><br><span class="line">    "Aura" "TestSysAura_FixAttackPercent"</span><br><span class="line">    "Aura_Radius" "%Range"</span><br><span class="line">    "Aura_Teams" "DOTA_UNIT_TARGET_TEAM_ENEMY"</span><br><span class="line">    "Aura_Types" "DOTA_UNIT_TARGET_ALL"</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   "TestSysAura_FixAttackPercent"</span><br><span class="line">   {</span><br><span class="line">    "IsDebuff" "1"</span><br><span class="line">    "IsPurgable" "0"</span><br><span class="line">    "Properties"</span><br><span class="line">    {</span><br><span class="line">     "MODIFIER_PROPERTY_DAMAGEOUTGOING_PERCENTAGE" "-50"</span><br><span class="line">    }</span><br><span class="line">   }</span><br><span class="line">  }</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>
<h2 id="ä¸€ä¸ªè‡ªå®šä¹‰çš„å…‰ç¯å®ä¾‹">ä¸€ä¸ªè‡ªå®šä¹‰çš„å…‰ç¯å®ä¾‹</h2>
<p>è¿™ä¸ªå…‰ç¯çš„æ•ˆæœå’Œä¸Šé¢é‚£ä¸ªå…‰ç¯çš„æ•ˆæœä¸€æ ·ã€‚ ä½†æ˜¯é€šè¿‡è¿™ä¸ªæˆ‘ä»¬å¯ä»¥åœ¨luaä¸­å¾—åˆ°å…‰ç¯çš„æ‹¥æœ‰è€…å’Œä½œç”¨å•ä½ã€‚äºæ˜¯å¯ä»¥åœ¨luaé‡Œé¢å¯¹è¿™äº›å®ä½“è¿›è¡Œå„ç§é¢å¤–çš„æ“ä½œã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">//åœ¨luaä¸­æˆ‘ä»¬å¯ä»¥è·å–åˆ°ä¸€ä¸‹entity</span><br><span class="line">//    å…‰ç¯æ‹¥æœ‰è€…    -&gt; EntIndexToHScript(keys.caster_entindex)</span><br><span class="line">// è¢«å…‰ç¯ä½œç”¨çš„å•ä½ -&gt; keys.target</span><br><span class="line"> "TestCustomAura"</span><br><span class="line"> {</span><br><span class="line">  "BaseClass" "ability_datadriven"</span><br><span class="line">  "AbilityBehavior" "DOTA_ABILITY_BEHAVIOR_AURA | DOTA_ABILITY_BEHAVIOR_PASSIVE"</span><br><span class="line">  "AbilityUnitTargetTeam" "DOTA_UNIT_TARGET_TEAM_ENEMY"</span><br><span class="line">  "AbilityUnitTargetType" "DOTA_UNIT_TARGET_ALL"</span><br><span class="line">  "AbilityTextureName" "alchemist_acid_spray"</span><br><span class="line">  "MaxLevel" "1"</span><br><span class="line"></span><br><span class="line">  "AbilityCastPoint"    "0.0"</span><br><span class="line">  "AbilityCastRange"    "500"</span><br><span class="line">  "AbilityCooldown"    "0"</span><br><span class="line">  "AbilityManaCost"    "0"</span><br><span class="line"></span><br><span class="line">  "AbilitySpecial"</span><br><span class="line">  {</span><br><span class="line">   "01"</span><br><span class="line">   {</span><br><span class="line">    "var_type" "FIELD_INTEGER"</span><br><span class="line">    "Range" "500"</span><br><span class="line">   }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  "Modifiers"</span><br><span class="line">  {</span><br><span class="line">   "TestCustomAura_Modifier"</span><br><span class="line">   {</span><br><span class="line">    "Passive" "1"</span><br><span class="line">    "IsHidden" "1"</span><br><span class="line"></span><br><span class="line">    "ThinkInterval"  "0.5"</span><br><span class="line">    "OnIntervalThink"</span><br><span class="line">    {</span><br><span class="line">     "ApplyModifier"</span><br><span class="line">     {</span><br><span class="line">      "ModifierName" "TestCustomAura_FixAttackPercentIcon"</span><br><span class="line">      "Target"</span><br><span class="line">      {</span><br><span class="line">       "Teams"  "DOTA_UNIT_TARGET_TEAM_ENEMY"</span><br><span class="line">       "Types"  "DOTA_UNIT_TARGET_ALL"</span><br><span class="line">       "Center" "CASTER"</span><br><span class="line">       "Radius" "%Range"</span><br><span class="line">      }</span><br><span class="line">     }</span><br><span class="line">     "ApplyModifier"</span><br><span class="line">     {</span><br><span class="line">      "ModifierName" "TestCustomAura_FixAttackPercentTimer"</span><br><span class="line">      "Target"</span><br><span class="line">      {</span><br><span class="line">       "Teams"  "DOTA_UNIT_TARGET_TEAM_ENEMY"</span><br><span class="line">       "Types"  "DOTA_UNIT_TARGET_ALL"</span><br><span class="line">       "Center" "CASTER"</span><br><span class="line">       "Radius" "%Range"</span><br><span class="line">      }</span><br><span class="line">     }</span><br><span class="line">    }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   "TestCustomAura_FixAttackPercentIcon"</span><br><span class="line">   {</span><br><span class="line">    "IsDebuff" "1"</span><br><span class="line">    "IsPurgable" "0"</span><br><span class="line">    "TextureName" "alchemist_acid_spray"</span><br><span class="line">    "Properties"</span><br><span class="line">    {</span><br><span class="line">     "MODIFIER_PROPERTY_DAMAGEOUTGOING_PERCENTAGE" "-50"</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   "TestCustomAura_FixAttackPercentTimer"</span><br><span class="line">   {</span><br><span class="line">    "IsDebuff" "1"</span><br><span class="line">    "IsPurgable" "0"</span><br><span class="line">    "IsHidden" "1"</span><br><span class="line">    "Duration" "0.6"</span><br><span class="line">    "OnDestroy"</span><br><span class="line">    {</span><br><span class="line">     "RemoveModifier"</span><br><span class="line">     {</span><br><span class="line">      "ModifierName" "TestCustomAura_FixAttackPercentIcon"</span><br><span class="line">      "Target" "TARGET"</span><br><span class="line">     }</span><br><span class="line">    }</span><br><span class="line">   }</span><br><span class="line">  }</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>
<p><a href="https://developer.valvesoftware.com/wiki/Special:Categories">Categories</a>:</p>
<ul>
<li><a href="https://developer.valvesoftware.com/wiki/Category:Dota_2_%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A%E5%B7%A5%E5%85%B7%E9%9B%86">Dota 2 åˆ›æ„å·¥åŠå·¥å…·é›†</a></li>
<li><a href="https://developer.valvesoftware.com/wiki/Category:AMHC_%E6%B1%89%E5%8C%96">AMHC æ±‰åŒ–</a></li>
</ul>
<!--stackedit_data:
eyJoaXN0b3J5IjpbODYxNDE2MjE0LDM1OTU1MDQ5OSwtMjA4OD
c0NjYxMiwtMTA3ODE5OTc2NiwxOTIxMzQ0NzgzLC0xMTAyNTMw
MDAwLDE3NTM3MjYwMzgsLTE0MzU2NDIzNSwtMTE5MDE1MzQwNS
wtMzQ1NDQyNDgzLC0xMTE4MDU1NjMsLTUzMjQwNzMzNiwtMTE5
MzYyMzgzMF19
-->
]]></content>
      <categories>
        <category>æ¸¸æˆ</category>
      </categories>
      <tags>
        <tag>æŠ€èƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title>Erlang è™šæ‹Ÿæœºå†…çš„å†…å­˜ç®¡ç†</title>
    <url>/2017/12/24/zhengsyao_Erlang%20%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%86%85%E7%9A%84%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%EF%BC%88Lukas%20Larsson%E6%BC%94%E8%AE%B2%E5%90%AC%E5%86%99%E7%A8%BF%EF%BC%89/</url>
    <content><![CDATA[<h1><a href="https://www.cnblogs.com/zhengsyao/p/erts_allocators_speech_by_lukas_larsson.html">Erlang è™šæ‹Ÿæœºå†…çš„å†…å­˜ç®¡ç†ï¼ˆLukas Larssonæ¼”è®²å¬å†™ç¨¿ï¼‰</a></h1>
<p>Erlangæ ¸å¿ƒå¼€å‘è€…Lukas Larssonåœ¨2014å¹´3æœˆä»½Erlang Factoryä¸Šçš„ä¸€ä¸ªæ¼”è®²è¯¦ç»†ä»‹ç»äº†Erlangå†…å­˜ä½“ç³»çš„åŸç†ä»¥åŠè°ƒä¼˜æ¡ˆä¾‹ï¼š</p>
<p><a href="http://www.erlang-factory.com/conference/show/conference-6/home/#lukas-larsson">http://www.erlang-factory.com/conference/show/conference-6/home/#lukas-larsson</a></p>
<p>åœ¨è¿™é‡Œå¯ä»¥ä¸‹è½½slideså’Œè§‚çœ‹è§†é¢‘ï¼ˆä¸ºäº†æ–¹ä¾¿ä¸æ–¹ä¾¿ç§‘å­¦ä¸Šç½‘çš„åŒå­¦ï¼Œæˆ‘æŠŠè§†é¢‘æ¬è¿åˆ°äº† <a href="http://v.youku.com/v_show/id_XNzA1MjA0OTEy.html">http://v.youku.com/v_show/id_XNzA1MjA0OTEy.html</a> ï¼‰</p>
<p>è¿™ä¸ªæ¼”è®²çš„å†…å®¹å¾ˆä¸°å¯Œï¼ŒåŸç†ä»‹ç»å¾ˆç»†è‡´ï¼Œä½†æ˜¯slidesæ¯”è¾ƒç®€ç•¥ï¼Œæ‰€ä»¥æˆ‘æŠŠè¿™ä¸ªæ¼”è®²çš„æ•´ä¸ªå†…å®¹å¬å†™å‡ºæ¥äº†ï¼Œæ”¶è·é¢‡å¤šï¼Œå®Œæ•´çš„transcriptå¦‚ä¸‹ï¼š</p>
<hr>
<span id="more"></span>
<p>Thank you.</p>
<p>Page 2<br>
When I wrote this talk, I thought that I was going to give a bunch of examples about how you analyse memory and see what the different allocators and things how the Erlang virtual machine works and spend a lot of focus on doing actual examples.<br>
It turned out that the theory of this stuff is quite complicated, so itâ€™s more of theory talk and having some stories at the end rather than being a story focused.<br>
So I am going to talk about the problem and why there are memory allocators in Erlang virtual machine and what they are used for and different handling, going through all the different concepts with the memory allocators, so that you get the terminology right, so that you know the different options you want to set so on and so forth, get to know all the different things we are talking about when talking about blocks, when talking about carriers and so on.<br>
Iâ€™m going to have look at the statistics that you can gather. There are a lot of statistics and main reason why we have the allocators implementated the way they are is because we can gather the statistics about your system, try to figure out, ok this is an optimal way of using your memory.<br>
We are going to have look at two different cases where we have been looking at the statistics that we can get from Erlang allocators, making modifications, and hopefully make system work better.<br>
And at the end weâ€™ll look at some of the new features, because there are a lot of development happening in the allocators, weâ€™ve spent a lot time optimizing these things and trying to shrink the fragmentation to become smaller and smaller.</p>
<p>Page 3<br>
The reason why we have memory allocators in Erlang virtual machine is because the normal malloc and so on are relatively slow for very small allocations, so when you are allocating small ets objects some where, it quite heavy operation to have to do syscall go all the way down, so we kind of cache memory up in the virtual machine.<br>
Also, in order to battle fragmentation, we use different strategies for how to allocate data, allocating something like a module or something like that, ok, you want to spend a lot of time finding the correct place to allocate that memory, but allocating something like a message being sent to another process, you donâ€™t want to spend as many cpu cycles to try to find the perfect place in memory, because it will be deallocated when you receive the message. So we have different strategies depending what type of memory that we are allocating.</p>
<p>Also there is no way to get statistics in a cross-platform manner. Now we want to have out of the allocators if you want to just use malloc or something like that.</p>
<p>If you want to try on your system running without erlang allocators, just use malloc from the beginning, you pass that flag to Erlang virtual machine, and it will disable everything. And you just run normal malloc.<br>
Sometimes, this is faster, I was looking at a benchmark thatâ€™s called ESTONE, I was going to see, ok, how much faster are these allocators, I switched them off, and benchmark went faster than using the allocators.<br>
So itâ€™s not always, but thatâ€™s what you get for some statistics benchmarks.<br>
In real production environments, they help a lot. There is another benchmark I have been running to do a 4G telephone benchmark thing, and there there is a 40% speedup to see in these allocators than using malloc and so on.<br>
So in real world applications, itâ€™s usually better for small benchmarks, they overact sometimes, bits overâ€¦<br>
The allocators also help a lot when you are doing NUMA, so lots of cores lots of thingsâ€¦</p>
<p>Page 4<br>
So Iâ€™m going on talk a bit about concepts.<br>
These are the forming things that we are talking about.<br>
carriers and blocks, single- vs. multi-block carriers, how do multiblock work and whatâ€™s thread specific allocators.</p>
<p>Page 5<br>
So talking about blocks.<br>
This is a terminology so that we can talk about these things.<br>
A block is one continuous piece of memory that Erlang virtual machine needs, this is something like for instance when you do a ets insert, that piece of data becomes a block, heap and stack of a Erlang process is a block, and message being sent from one process to another is copying inside a block, so itâ€™s continuous piece of C memory.<br>
We have carriers.<br>
Carriers is something container, contains one or more blocks. So we have something looking like that.<br>
So we have a header, saying ok that this is a carrier of this type with these settings and so on. And we put the block into it.<br>
And as we continue with more operations on ETS table, we put more and more data, hopefully in a good place into the block. And we delete something, and we get fragmentation. We might end up with something looking like this.<br>
Now these blocks are like this. They are normally â€¦ we align them, normally aligned at 18 bit limits, so they are about 256 KB minimum, aligned at that limit, so it allows us to do lots of optimizations.</p>
<p>The size of how much memory can be allocated can be controlled with many different settings.</p>
<p>Page 6<br>
Before I do that, we talk about single and multiblock carriers.</p>
<p>So when looking at the statistics on the allocators, we have two different concepts there, so we have single block carrier which is something that contains one block, itâ€™s carrier that contains one block of memory.</p>
<p>Now normally you want to put large, for some definition of large block into one single block carrier.<br>
And if you have small blocks, you want to put them into the same carrier, this is because the operating system is quite good at handling large continuous chunks of memory, and single block carrier usually uses just allocator like malloc normally.</p>
<p>Large depends on your context, sometimes, large can be something like 256 bytes, sometimes it can be 5 MB, so it depends a bit on your context.</p>
<p>The default is half MB, which seems to work for most situations. So if you have a block of some sort thatâ€™s smaller than 512 KB, then itâ€™s placed on multiblock carrier, if itâ€™s bigger, then itâ€™s placed on single block carrier.</p>
<p>And you control that by single block carrier threshold.</p>
<p>Normally you want to have most of your data in multiblock carriers.<br>
So in a normal system that you are running you have most â€¦ I donâ€™t know â€¦ 80~85~90% of your data to be part of multiblock carrier.</p>
<p>So if you realize in a system that you are running that you have a lot of singleblock carriers, not a lot of multiblock carriers, you might want to raise the limit to see, ok , so I know from my code that Iâ€™m reading 1 MB messages from TCP socket all the time, this becomes 1 MB binaries, and thatâ€™s bigger than 512 KB, those are always put into singleblock carriers, so I might want to just adjust the threshold to 1.5 MB, and then , they put all those blocks into multiblock carriers, and hopefully your system will be a lot faster.</p>
<p>When manipulating the threshold you probably also want to change the size of carriers that are being allocated. So if you are increasing the size of individual blocks, you will wanting increase the actual carriers that are being created. So if you increase the threshold to 1 MB, theâ€¦ I believe the default size of multiblock carriers is 2 MB, the smallest one, and it grows up into 8 MB, depending on how many carriers you have.</p>
<p>Since you doubled the initial amount, you might want to double the next one as well, so you started at 4 MB might grow up to 16 MB, or something of that effect.</p>
<p>Page 7<br>
There are quite a few different types of allocators. These are different areas that you can configure individually how they work.</p>
<p>So we have the heap allocator, the binary allocator, the driver allocator and the ets allocator. So these are the things that you can reason about as an Erlang programmer.</p>
<p>These allocators are normally the ones that you tune. Iâ€™ve not seen problems with any allocators yet. Normally somebody allocating binaries that are going out of hand or they have many many small ets stuff that are put into table, they get fragmentation usually because of that. Thatâ€™s the two normal ones that you have problems with.</p>
<p>There are also temporary, short lived, standard lived, long lived and fix size allocations, and these are emulator internal things.</p>
<p>Page 8<br>
The difference between these emulator internal things:<br>
temporary is a very short time, for something that just lives in a C function, some examples for what can be there.<br>
standard is links, monitors, these kinds of C structures.<br>
short is something that lives across â€¦ I donâ€™t know â€¦ a scheduler for erlang functions, lives for only 4 or 5 milliseconds, something like that.<br>
long is for things like code, atoms, things that we know could possibly live forever.<br>
fixed are things we know are certain sizes, we can make optimizations because of this, so process control blocks, port control blocks and lots of other things.<br>
If you want to find the exact things that there are, there is a file called erl_alloc.types in the erlang/otp repository under erts, all the mappings are set there and mappings are different if you are running a half-word emulator, if you are running a 64 bit, 32 bit, if you are running windows, unix or â€¦<br>
So many things are depending on operating system that you build the erlang virtual machine for, you have different setting for these things.</p>
<p>Page 9<br>
So talking a bit aboutâ€¦<br>
So, single blocks carriers are quite easy, you donâ€™t have to manage them, you have one block one carrier, and thatâ€™s it, and one carrier is one chunk of memory requested from operating system. so itâ€™s very easy to handle.</p>
<p>multiblocks, on the other hand, are quite difficult. you have a lots of small areas because you need to keep track of where I can put this piece of memory. I need to place something thatâ€™s 8 bytes big, and I need to look for the best place to put it, and spend a good amount of time for it.<br>
So we have a few ~7 different strategies that you can use in order to allocate where to put the blocks inside multiblock carrier.<br>
So we have the block oriented ones, these are strategies that span carriers, so if you have two carriers, and with them build the trees with all the free blocks of all the carriers that are in that allocator at the point.<br>
We have the best fit, itâ€™s just, itâ€™s the best fit looks for the one with the least wastes, so if you have a block thatâ€™s 8 bytes, and you find the slot thatâ€™s 9, and next smaller slot is 7, then you put it in the 9 slot, and so on.<br>
Address order best fit works in the same way, only that if there is a tie, it uses the one with the lowest address, rather than just taking the one that was put in the queue last.<br>
Address order first fit tries to take the one with the lowest address that you can fit them.<br>
Good fit takes the good fit to do it. You can tune with the settings that you define as a good fit. so if you say that itâ€™s ok to waste 10% of the blocks, if I have something thatâ€™s 10 bytes big, then a good fit is something that doesnâ€™t waste more than 15 bytes. So something like that, you can tune what you want to have a good fit to be.<br>
A fit, is mostly used for these temporary allocations that are really fast, so just finding something.</p>
<p>We have the carrier oriented ones. these are broken down so that first you have the strategies to say how the carriers are organized, than you have strategies saying how the blocks within a carrier organized.<br>
I think I will get into more details about theâ€¦</p>
<p>Page 10<br>
I have a picture here. saying a small example about how best fit works. So we have two carriers, the shaded areas are memories that are taken, the blue and red ones are free slots, so free memory areas.<br>
we build a tree looking something like this, after different carriers saying ok we do a binary search trees, so that is, I thinks itâ€™s a red-black balanced binary search tree, that you look for blocks in.<br>
In the end it looks something like this, the smallest red one all the way to the right, and then you have built up this tree of them, and the neat thing is that this requires of course no memory to build this tree because we save the pointers of this tree in the free slots. So it doesnâ€™t actually take any memory to build this tree. and then we just search this tree to see, ok, which one can be find, and we take a slot, then you take out of the tree, we balance, and then hopefully you find good slot to be in.</p>
<p>So Iâ€™ve been talking a lot about the blocks in there, so you have different blocks. but the carriers, where do they come from?</p>
<p>Page 12<br>
So we have two different ways of allocating carriers in the runtime system.<br>
We have something called mseg alloc and the sys alloc.<br>
so the mseg allocator basically tries to shut out the operating system as much as possible, and just allocates big segments. And this is normally used for multiblock carrier allocation.<br>
On linux it uses /dev/zero and opens that as a file, and mmap with different arguments in order to get large chunks of memory.<br>
One of the key things about the mseg alloc is that it has a cache. so it has a cache of certain size of carrier that was just returned to it. I think the default is 10 or something like that, and only normal system, most I see, we have a cache hit rate of about 80%~85%, normally when we are using a lot of carriers in a system.</p>
<p>sys alloc just call to malloc, free or posix_memalign depending on your operating system. It allocates pieces of memory in multiples of a variable you can set there, letâ€™s call them Muxxxx. So I think the default is 2 MB. so it allocates 2 MB no matter if you want to have something thatâ€™s letâ€™s say 1 MB. it over allocates 2 MB in order to make it easier for operating system to get less fragmentation of things.<br>
We had a lot of problems with projects that have had fragmentation of virtual memory space, so this is why we help malloc in order to have these nice chunks that it can manage and gets it perfect.<br>
sys alloc is also used to allocate what we call the main carrier. main carrier is an initial carrier, so the first one thatâ€™s always there during startup.<br>
The idea with the main carrier is that you have sufficient memory in order to do the normal bootup of erlang emulator without doing any extra allocations in order to speed up starting something.</p>
<p>Page 13<br>
So another picture. Now we are getting into different schedulers.<br>
so we have short live allocator, eheap, binary and all of the different things, they request carriers from mseg alloc.<br>
All of these, we have one chain of these per scheduler in the system. so all of these are locals, you have one ets alloc for scheduler 1, one ets alloc for scheduler 2, etcâ€¦ So they are all local, and can take advantage of the NUMA architecture of your system, so allocation is always close to you.<br>
And, these small mailboxes, they are say that, of course we have to pass memory around between the schedulers, so if we want to do free or something that we passed over we have to send a message to that scheduler in order to do free, because we donâ€™t have any locks at all on the actual allocators, because we want these to be lock free, so we are doing them via a message passing between the schedulers that do the allocations.<br>
In R16B02, we added a carrier pool thatâ€™s shared between different schedulers, you get access to this if you use the carrier oriented algorithms that I was talking about before. and so if you use something like the address order best fit carrier or first fit block something like that, you get to access this pool. This pool get populated of carriers that are below a certain percentage of utilizations, so if you have a carrier on scheduler n, that has utilization of say 20%, so it has quite high fragmentation, then that scheduler can give that carrier to the pool, and somebody that needs a carrier, say scheduler 1 needs a new carrier to allocate data in, it can take that from the pool rather than having that from somewhere else.<br>
You lose some of the NUMA things of course, but you get better memory utilization, which is nice.</p>
<p>For all of the async threads, and all of the driver threads, there is a global allocator that has a big lock in front of it, and all of the data get put into there, so if for instance you are reading a file with binaries, those binaries get put into this global allocator.</p>
<p>And all of these mseg , as if they run out of layers here, we have something called erts_mmap at the bottom as well, that was added in R16B03, thatâ€™s something fun as well. If you want to know the details, just ask me afterwards.</p>
<p>Page 14<br>
So, thatâ€™s general theoretical background for these things. So getting statistics trying to figure out whatâ€™s wrong, letâ€™s dig down to some of these things.<br>
We have different types of allocators, they are called things like these when we are talking about statistics part of them.<br>
So if you do erlang:system_info(allocator), you get information about which allocators are active on your system. Itâ€™s not always the same, and itâ€™s definitely not always the same over releases. But doing this, you can get the information about what feed are just enabled on your system. You get all of different settings that you set on you system, you can figure out what your threshold is, or whatâ€™s your multiblock carrier strategies and other things like that. And the features like if you have the posix_memalign in your system, if you can lock physical memory in place rather than trying to get linux way of doing memory management. In there, lots of other things.</p>
<p>Page 15<br>
Now you can dig into more detail, even more.<br>
So if you say erlang:system_info, and put one of the type we have seen in the previous slide: eheap_alloc, ets_alloc, something like that, you get list of tuples with lots lots of data.<br>
You can see that, the first structure we have is instances.<br>
Instance 0 is the global allocator thatâ€™s used for async threads.<br>
Instance 1 is for scheduler 1, instance 2 is for scheduler 2, etc. etc. etcâ€¦<br>
For each instance, we have the version of allocator use, the options set, statistics about the multiblock carriers, statistics about the singleblock carriers, and statistics about the calls made about the carrier.<br>
Iâ€™ll break these down for youâ€¦</p>
<p>Page 16<br>
So this is what you get out of the data.</p>
<p>Page 17<br>
I put it in a table for you, so you donâ€™t have to read the data stuff.<br>
So, what we get is that we get the current value, we get the maximum value of that parts since the last call to get the statistics, and we get the maximum value of the system life time.<br>
We can see the number of blocks, there we have 1 million, 1 million and 1.8 million blocks.<br>
And there, we get the total size of all of the blocks, I think I actually have a â€¦ So we have a 820 MB, 820 MB there, we have maximum, when we have a peak of 3.3 GB of memory.<br>
We can see the carriers, we fit these 1 million blocks into 455 carriers.<br>
We can see the carriers sizes down there as well.</p>
<p>Page 19<br>
Singleblock carrier would of course have the same amount of blocks as carriers.<br>
We can see that the block size is 6, 6, 20, but since we over allocate a bit, the carrier size is 7.5, 7.5 and 25. Quite simple.</p>
<p>Page 20<br>
The number of calls that you can see. We can see that we have done quite a few calls.</p>
<p>Page 21<br>
Quite many, so 28 thousand mega calls has been done to the binary alloc.<br>
So quite a few binaries have been allocated there.<br>
We freed roughly the same amount which is a good thing, otherwise we would have memory leak.<br>
And we have been able to reallocate some as well.<br>
And we can see that mseg alloc has done 24 thousand of allocations, while sys alloc has done zero. so this is a good thing.<br>
So thatâ€™s for the singleblock and multiblock things.</p>
<p>Page 22<br>
So you can also get the statistics about the carrier allocators.<br>
We can get the amount of segments, cache information, seeing the alloc, dealloc and destroy.<br>
So here we can see the cache working.<br>
We have mseg alloc of 464 there, while actually we only created 40 carriers.<br>
So we have a quite high cache hit rate there. We have done 464 calls, only 40 of them ended up in OS call.</p>
<p>I am justing think of how much time I haveâ€¦ which seems to be plentyâ€¦ thatâ€™s goodâ€¦</p>
<p>Page 23<br>
So some case study to see how you analyze these things, and get these data once you understand what they mean.<br>
So I run across two cases. I run across many cases, but these ones are quite useful for the open source community, because you guys seem to run into them a lot more than our commercial customers.</p>
<p>Page 24<br>
So the first one I want to talk about is large binaries.<br>
So there was this person that realized that I am running strace, and I know that these allocators are supposed to be really efficient, it should be using mmap to allocate my stuff, but for some reason, itâ€™s not using mmap, itâ€™s using malloc instead. Itâ€™s using a lot malloc.</p>
<p>Page 25<br>
So I requested the statistics of binary allocators.<br>
In there, you can see that there were about 300 mega calls being done to binary alloc.<br>
And we have 0.4 mega calls done to mseg alloc.<br>
So we have a discrepancy because we want to have most of our stuff into the mseg allocator not to the system allocator, because mseg allocator means that we use multiblock carriers, while system allocator means that we are using singleblock carrier mostly.<br>
And we could see that we have sys alloc call of 1.4 mega calls, so quite a discrepancy there.<br>
So this is when bells are whispering for me, saying something is wrong with these settings.<br>
So at this point you can reason about the allocators, something is wrong with how the thresholds set for which things are being put. I noticed this is binary alloc or so, so this person is allocating large binaries than the actual singleblock threshold for most of the binaries, and therefore they push into singleblock carriers, and which is not as efficient.<br>
Going back, we can see that multiblock carrier size is about 2.4 GB, and the singleblock carrier size is 11 GB of memory.<br>
So itâ€™s a big discrepancy, normally we want to have the reverse if not even more in favor of multiblock carriers in there.</p>
<p>So, what can we do about this?<br>
So we want to adjust the singleblock carrier threshold somehow, but how should we adjust it?</p>
<p>So looking at the statistics, we can also get the average block size thatâ€™s in the single block carriers.<br>
You take the number of blocks divided by the total size of the carriers, we can see that the block size is about 1.68 MB, in this case it was reading from TCP socket.<br>
Now we have the block size, ok, this is the average block size. So we probably want to go a bit over that size when tuning the allocators.<br>
And in the end we ended up setting it to 2MB, which is reasonable limit above there, and is a nice clean number.<br>
So, that put the binaries that are greater than 2 MB into singleblock carriers, while puts that are smaller than 2 MB into multiblock carriers.<br>
And since multiblock carriers are being done by mmap, and you get the caching of mseg and all that, the performance increase is quite good I believe.<br>
And also of course, increase the largest multiblock carrier size and the smallest multiblock carrier size, as these two last ones say, for only the binary allocator, this is where the strength of the erlang runtime allcoators come in, because you can say that, I only was setting the binary allocators, because if you set the settings for all of the allocators, then you will have the problem, most probably with ETS or something like that, over allocates the memory than you really want in your system.<br>
So you can specify saying I have problem only with binary allocations, therefore I put only binary tuning into my emulator.</p>
<p>Page 27<br>
So second case that I was running into â€¦ was actually helping Fred Hebert with a problematic allocator, which he wrote a big blog post about it, so this is data if you read the blog post.<br>
The symptom that he was having was that erlang:memory(total) was showing about 7 GB of used memory, but top in his operating system was showing that 15 GB memory was being used by the BEAM.<br>
And then all of the sudden, he got some kind of small traffic spike, and he got crashed on ets alloc failing to allocate. And he was confused, because Hey I have â€¦ it says I have 7 GB only, and then it was 15 GB, I donâ€™t have memory to allocate these things.<br>
Now the thing to know about erlang:memory(total) is that is the total areas of the blocks in your system.<br>
Itâ€™s not the total areas of the carriers in your system.<br>
So there is the discrepancy, itâ€™s only the used areas that is the Erlang total, itâ€™s not the actual allocated from the operating system.<br>
So if you see this discrepancy between what erlang:memory gives and what the top in your operating system gives, most probably you have some kind of fragmentation problem with your allocators.</p>
<p>Page 28<br>
So again, looking at the statistics in there, we can see that he has a lot of blocks, and he has a blocks size that was at the moment 1.6 GB, I believe this was just one instance, so itâ€™s only one scheduler.<br>
But we can see the max block size is 6.8 GB, but we can see at the carrier size, was largely the same for the current and maximum, so this is what our problem is, you have a fragmentation in the allocation of these binaries.<br>
So for some reason, the allocators were allocating binaries in lots of different carriers, but one day when releasing them, it was not releasing all of the binaries within a carrier, it was one binary there, one binary there, and it was impossible to release these carriers. And then, he got a spike in ETS inserts, and he cannot put ets data into a carrier puts for binary allocation. And therefore trying to create ETS carriers, and you run out of memory.<br>
So again we have to know what the average block size is, we can see that block size is about 800 bytes per block when we were at current, they had peak of 1.7 KB per block, and the carriers were about 7.8 and 7.7 MB per carrier. This is something you would expect.<br>
But if you take the block size divided by the carrier size, we have a utilization about 22% when running at current, which is not good at all. But when we are at max, we had 93%, which is quite ok.<br>
So what we want to do here is to find a better strategy for allocate these binaries so that we donâ€™t get into scenario when we are freeing binaries, the carriers can not be returned to operating system.</p>
<p>Page 29<br>
So what we ended up changing there was to use â€¦ the default allocator for binary is a normal best fit allocator, by using the address order best fit, we are trying to squeeze allocations further down into the memory space and therefore compacting them. Spending a couple of CPU cycles doing this, â€¦(æ²¡å¬æ¸…), notice any difference.<br>
We also shrunk the size of the largest multiblock carriers, by doing this we were hoping that statistics would be in our favor, so that we could free more of the carriers. And that turned out to be the case as well.<br>
I donâ€™t know exactly what his xxx(æ²¡å¬æ¸…ï¼Œåº”è¯¥æŒ‡çš„æ˜¯å†…å­˜ä½¿ç”¨ç‡) now is, but itâ€™s not at 20%, thatâ€™s more like 50% or 40%, which saved the system in a lot of cases. So thereâ€™s nothing to deal with these crashes any more.</p>
<p>Page 30<br>
Some of the new features are coming up lately.<br>
So I was talking about the pool that was coming in R16B01, so this can only be migrated from things with the same type. Itâ€™s migration in between schedulers, but itâ€™s still binary to binary migration, so you cannot migrate something from a binary allocation to an ets allocation yet. This is something that we probably get to work on eventually.<br>
So this will not save the fragmentation problem having this pool, but it helps when you are having a scenario where you are allocating in a lot of schedulers in high load, and then your load shrinks for once, and it helps a lot, and you get a lot of deallocations. The reason for this introduction is that we have a customer that was in memory goaf as the load of system decreased, which is not really what you want to see, because you had a peak and then we allocate a lot of memory, lots of memory, and then the load shrunk, and he was just allocating in one scheduler, but he was not able to use the carriers in the other schedulers, and therefore the memory of that scheduler increased, and it wasnâ€™t able to deallocate the other schedulers. So by migrating these carriers to scheduler 1, we solve that problem. This by the way is turned on by default in 17.0, so check your system and see if you want to have it or not, we have only see the positive effective of this, but it might be possible that there are some down sides for it.<br>
In R16B03, we have something called super carrier, which is where the erts_mmap functionality was add in. So this is a way for us to prealloc a huge chunk of memory for Erlang virtual machine at startup, so that we donâ€™t have to request for memory from operating system.<br>
The reason why we put this in, is because we have a virtualized environment where one of our customers is running, we took about 20 seconds to do a malloc. So it was taking a long time, and there was a test was timing out for some reason. So we put this in place, so that they could preallocate 8 GB of memory, and donâ€™t have to request it from memory system at such long intervals.<br>
It can also be used to limit the amount of memory that Erlang virtual machine uses, but ulimit is a better tool for that than using this.</p>
<p>(Question: Why is that? Why is ulimit betterâ€¦?)<br>
Answer: You get the same results. And I think operating system in general is better at managing these things, because you kind of â€¦ the reason why we use do singleblock carriers as operating system allocations is because it can cheat by taking memory from caches and so on and so on, if we are allocating things with mmap we donâ€™t get the caches that malloc uses and so on, so we donâ€™t get access to all of the memory thatâ€™s in the system. So but if you use ulimit, you donâ€™t get the downside, but you get the same benefits.</p>
<p>Q&amp;A</p>
<ol>
<li>
<p>Question: there is one super carrier for the entire system. So how does that work with the NUMA architecture?<br>
Answer: I donâ€™t think weâ€™ve done any benchmark on that actually to see how that works. The implementation about how it takes carriers and so on, I might be a bit fuzzy about it, so I am not 100% sure, but it some kind of taking on the same side on the allocating things. Donâ€™t know, unfortunately itâ€™s the answer.</p>
</li>
<li>
<p>Question: how does the migration of carrier work with the NUMA system?<br>
Answer: Yes, you can have problem with that, definitely. You will have remote memory access as you might want them to be. But if you do not want this behaviour, itâ€™s very easy to shut off. you dont have to deal with that. In systems that do not have lot of NUMA interactions with different things, itâ€™s just benificial to do it. Normally you dont want to have this scenario any way where memory is being allocated not release from these other parts in there.</p>
</li>
</ol>
<p>(You have that problem with process migration in scheduler)<br>
Yeah, as long as you do message passing, or interacting environments, â€¦, we donâ€™t group things in NUMA nodes for processes in order for them to not have the overhead, and if you send a message from one process to something in another NUMA node, the memory of that message will remain in the original NUMA node, so we have a lot of these things, any way. â€¦</p>
<ol start="3">
<li>
<p>Question: what does the S+1 mean? (æŒ‡çš„æ˜¯slidesç¬¬15é¡µä¸­çš„æœ€åä¸€è¡Œ)<br>
Answer: I guess the S+1 I was talking about is just â€¦ one plusâ€¦ thatâ€™s the two one.<br>
The thread zero â€¦ and then 1 is the first scheduler, 2 is the second scheduler, 3 is the third scheduler, and so on and so onâ€¦ I might have made a mistake in this slide SO Iâ€™ll fix it.<br>
No, there is nothing at the end over there, it just ends at the last scheduler.</p>
</li>
<li>
<p>Question: If NIF uses the driver allocator?<br>
Answer: NO, it uses heap allocator, you allocate directly on the heap for things when you are building stuff there. of course if you make binaries thatâ€™s bigger than 64 bytes, you will end up in the binary allocator. but NIFs have the advantage of building stuff directly on the heap, which is why they are a bit faster when calling small stuff than drivers.</p>
</li>
</ol>
<p>Unless of course you go over the heap size, then it will create heap fragment, which is part of the heap allocators but in the different memory area.<br>
All of the fragments get collapsed when you do garbage collection.</p>
<p>5 Question: where can I find the information about this stuff without reading the source code.<br>
Answer: Yes you can. you can read my mind, and there are two other minds you can read as well(ç¬‘). In part of doing the work done with Fred to get the fragmentation problem, I was working â€¦ recon(å¬ä¸æ¸…ï¼Œå°±æ˜¯ä¸€èµ·å¼€å‘äº†recon). And see modular in recon_alloc, does some basic analysis for you, trys to figure out whatâ€™s in the system. it has maybe 7 or 8 functions, their data analyse different aspects of things, problems that we have encountered. We are trying to add more things to it, but what I find is that most of the problems that you encounter are unique. Itâ€™s not like that itâ€™s a general problem for everybody because then it would be a general setting, but if itâ€™s almost always a specific problem that somebodyâ€™s having because theyâ€™ve written their code in certain way and therefore this happens. BUt for this fragmentation part, finding out there are many singleblock carriers rather than multiblock carriers, their functions in this library can do that.<br>
With lot of documentation explaining all of these stuff, the documentation is almost better than the tool. I would say. So just reading documentation explains most of the things I did in my slides.</p>
<p>å¬å†™æ°´å¹³æœ‰é™ï¼Œä»…ä¾›å‚è€ƒã€‚</p>
]]></content>
      <categories>
        <category>Erlang</category>
      </categories>
      <tags>
        <tag>Erlang</tag>
      </tags>
  </entry>
  <entry>
    <title>é¡¹ç›®å¾€äº‹ä¹‹å›¢é˜Ÿ</title>
    <url>/2021/06/01/project-member/</url>
    <content><![CDATA[<h2 id="ç»„æˆ">ç»„æˆ</h2>
<ul>
<li>é¡¹ç›®æ€»æ˜¯ç”±å½¢å½¢è‰²è‰²çš„äººæ„æˆï¼Œä¸åŒçš„ä¸“ä¸šç ”å‘ã€è¿è¥ã€è¿ç»´ç­‰ã€‚é‡ç‚¹è¯´è¯´ç ”å‘ï¼Œç ”å‘åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼š
<ol>
<li>ç¨‹åºï¼ˆä¸€èˆ¬åˆ†ä¸ºå‰ç«¯/åç«¯ã€å®¢æˆ·ç«¯/æœåŠ¡å™¨ï¼‰ã€‚</li>
<li>ç­–åˆ’ (ä¸€èˆ¬åˆ†ä¸ºä¸»ç­–åˆ’ã€å‰§æƒ…ã€æ•°å€¼ã€æ–‡æ¡ˆï¼Œæ‰§è¡Œç­‰)ã€‚</li>
<li>ç¾æœ¯ (ä¸€èˆ¬åˆ†ä¸º3d,2d,åŸç”»ï¼Œåœºæ™¯ï¼Œæ¨¡å‹ï¼ŒåŠ¨ç”»ç­‰)ã€‚</li>
</ol>
</li>
</ul>
<h2 id="ç±»å‹">ç±»å‹</h2>
<p>ä»¥ä¸‹åªåŒºåˆ†ç¨‹åºã€ç­–åˆ’ã€ç¾æœ¯ä¸‰å¤§çš„åˆ†ç±»ã€‚åœ¨æ‰€è§çš„å›¢é˜Ÿä¸­å¤§è‡´åˆ†ä¸ºå››ç±»ï¼š</p>
<ol>
<li>è¦é¥­ç±»å‹<br>
åœ¨è¿™ç±»å‹çš„å›¢é˜Ÿä¸­ï¼Œç­–åˆ’æ˜¯çŸ­æ¿ã€‚å…¶ä»–æˆå‘˜éƒ½åœ¨åšå‡ºç›ˆåˆ©äº§å“çš„æ‰€è¦æ±‚çš„çš„åŸºå‡†æ°´å¹³çº¿ä»¥ä¸Šã€‚<br>
ç­–åˆ’ä½äºæˆ–è€…ç¨é«˜äºåŸºå‡†çº¿ï¼Œè¿™ä¸ªå°±çœ‹å¤©åƒé¥­ï¼Œè®©ç”¨æˆ·è€çˆ·ä»¬èµç‚¹é¥­åƒï¼Œé ç¨³å®šçš„æœåŠ¡ï¼Œè¿è¥ã€ç¾æœ¯å“è´¨ç­‰æå–ä¸€ç‚¹åˆ©æ¶¦ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä¸ªè‹¦é€¼é¡¹ç›®ç»„ã€‚</li>
<li>ä½“å¼±å¤šç—…å‹<br>
è¿™ç±»å‹å›¢é˜Ÿä¸­ï¼Œç¨‹åºæ˜¯çŸ­æ¿ã€‚ä¸¾ä¸ªä¸å¤ªæ°å½“çš„ä¾‹å­ï¼Œç¨‹åºçš„ç¨³å®šæ€§æ•ˆç‡ç­‰å¦‚åŒä¸€ä¸ªäººèº«ä½“çš„å¥åº·ï¼Œç­–åˆ’çš„è®¾è®¡ç†å¿µå°±æ˜¯å…¶æ¢¦æƒ³ã€‚æ¢¦æƒ³å¾ˆå¤§å¾ˆå¥½ï¼Œèº«ä½“å¾ˆå¼±å¾ˆè™šã€‚<br>
å‘çƒ­ã€è€—ç”µã€crashï¼ŒæœåŠ¡å™¨å›æ¡£ã€å®•æœºã€å¡é¡¿ç­‰ï¼Œè¿™ç§å›¢é˜ŸåŸºæœ¬å°±æ˜¯è¿‡äº†ä»Šå¤©æ²¡æœ‰æ˜å¤©ï¼Œç­‰æ­»å‹ï¼Œå½“ç„¶ä¹Ÿæœ‰é‡åˆ°ç¥åŒ»ï¼Œä¹Ÿèƒ½ç—…å»ä½“å¥ï¼Œå†åˆ›è¾‰ç…Œã€‚ä½†æ˜¯åŸºæœ¬ä¸Šæ˜¯åœ¨æœ‰æ—¶é—´æœ‰é’±çš„èƒŒæ™¯ä¸‹ï¼Œå¶å‘çš„ç‰¹æ®Šæƒ…å†µã€‚</li>
<li>å¸Œæœ›å‹<br>
è¿™ç§å›¢é˜Ÿä¸­å¤§å®¶èƒ½åŠ›éƒ½åœ¨åšå‡ºç›ˆåˆ©äº§å“çš„æ‰€è¦æ±‚çš„çš„åŸºå‡†æ°´å¹³çº¿ä»¥ä¸Šï¼Œä¸ªåˆ«ç‰¹åˆ«æ¨å‡ºï¼Œè¿™ç§å›¢é˜ŸåŸºæœ¬ä¸Šå±äºé•¿æœŸåˆä½œï¼Œæœ‰ç§¯ç´¯ï¼Œæœ‰é»˜å¥‘ã€æœ‰éŸ§åŠ²ã€‚ç¦»æˆåŠŸåªå·®ä¸€ä¸ªå¥‘æœºï¼Œè¿™æ˜¯å¤§å®¶æƒ³å»çš„ç†æƒ³å›¢é˜Ÿã€‚</li>
<li>æ— åæ°<br>
è¿™ç§å›¢é˜Ÿå¤šè§äºä¸´æ—¶æ‹¼å‡‘ï¼Œæˆç«‹å›¢é˜Ÿçš„ç›®çš„å„ä¸ç›¸åŒï¼Œäººå‘˜å‚å·®ä¸é½ï¼ŒåŸºæœ¬ä¸Šæˆ˜äº”æ¸£ï¼Œè§å…‰æ­»ã€‚</li>
</ol>
<span id="more"></span>  
<h2 id="ç»å†">ç»å†</h2>
<p>ç¬¬å››ç§å›¢é˜Ÿæˆ‘åœ¨èŒä¸šç”Ÿæ¶¯ç»å†ä¸€æ¬¡ï¼Œæ—¶é•¿ä¸‰ä¸ªæœˆï¼Œåœ¨æˆ‘ç¦»å¼€ä¹‹åäº†è§£åˆ°å‘ç”Ÿäº†å„ç§å¥‡è‘©äº‹æƒ…ï¼Œæ²¡å‡ ä¸ªæœˆè§£æ•£äº†ã€‚<br>
ç¬¬ä¸‰ç§å›¢é˜Ÿæˆ‘ä¹Ÿç»å†è¿‡ä¸€æ¬¡ï¼Œåšå‡ºäº†æ‰‹æ¸¸é¡¹ç›®çš„ç¬¬ä¸€ä¸ªçˆ†æ¬¾RPGã€‚<br>
å…¶ä»–åŸºæœ¬ä¸Šéƒ½æ˜¯ç¬¬ä¸€ç§æˆ–è€…ç¬¬äºŒç§å›¢é˜Ÿï¼Œè¿™ä¸¤ç§ä¸­è¦é¥­å‹çš„å›¢é˜Ÿæ›´å¤šäº›ã€‚æˆ‘å‘ç°ä¸€ä¸ªå…±åŒæƒ…å†µï¼Œä½œä¸ºé¡¹ç›®æ€»è´Ÿè´£äººPDï¼Œæ€»æ˜¯å¸Œæœ›é¡¹ç›®å…¶ä»–ç ”å‘å›¢é˜Ÿå¸®åŠ©é¡¹ç›®çš„çŸ­æ¿æ–¹ï¼ŒæŠŠçŸ­æ¿æ–¹çš„å·¥ä½œå°½é‡å¾€å…¶ä»–å›¢é˜Ÿé‚£è¾¹è½¬ç§»ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼æ¥å¼¥è¡¥é¡¹ç›®çŸ­æ¿ï¼Œä½†ã€‚æœ€ç»ˆç»“æœå·®å¼ºäººæ„ï¼Œå¯¼è‡´å¤§å®¶éƒ½æˆäº†çŸ­æ¿ã€‚åœ¨è¿™è¿‡ç¨‹ä¸­ï¼Œæˆ‘å¼€å§‹çš„åšæ³•æ˜¯å¼ºçƒˆè¦æ±‚çŸ­æ¿æ–¹è‡ªå·±æˆ–è€…é€šè¿‡å¤–éƒ¨æ‰‹æ®µï¼ˆæ‹›è˜ã€åŸ¹è®­ç­‰ï¼‰æ¥æé«˜ï¼Œä½†å¾€å¾€å—é¢†å¤´äººçš„æ€ç»´ã€è§£å†³é—®é¢˜èƒ½åŠ›ï¼Œæ›´é‡è¦çš„æ‰€èƒ½è°ƒé…çš„èµ„æºé™åˆ¶ï¼Œæ— æ³•å±•å¼€ï¼Œå¾€å¾€å˜æˆåˆ«äººçœ¼ä¸­çš„â€œå–·å­â€ï¼Œæ…¢æ…¢çš„ä¹Ÿå°±èººå¹³äº†ã€‚<br>
ä¸€ç›´åœ¨æ€è€ƒçš„è¿™æ ·çš„é—®é¢˜ï¼Œåœ¨æœ‰é™çš„èµ„æºä¸‹ï¼Œæ€ä¹ˆæ‰èƒ½æŠŠäº‹æƒ…åšæˆï¼Œå‘æŒ¥æœ€å¤§èƒ½é‡ï¼Ÿ</p>
<h2 id="è°¬è®º">è°¬è®º</h2>
<ol>
<li>æ”¾å¼ƒæ²¡å¸Œæœ›çš„å›¢é˜Ÿã€‚ä¸€äº›å›¢é˜Ÿä¸€è¾¹ä¸ç»™èµ„æº(æ—¶é—´ã€äººåŠ›ç­‰)ï¼Œä¸€è¾¹è¿˜é«˜ä¸¾é«˜æ‰“ï¼Œæ»¡å˜´çš„æ„¿æ™¯ï¼Œå¯¹å„ç§ä¸åˆç†è§†è€Œä¸è§ï¼Œå‡¡æ­¤ç§ç§ï¼ŒåŠæ—¶æ­¢æŸã€‚</li>
<li>éƒ¨åˆ†å›¢é˜Ÿæœ‰ç€æ˜æ˜¾çš„çŸ­æ¿ï¼Œä½†æ˜¯å—åˆ¶äºæ‰‹ä¸­èµ„æºï¼Œæ— æ³•åšå‡ºæ”¹å˜ï¼Œè¦ä»”ç»†æ–Ÿé…Œï¼Œä»¥æˆ‘çš„ç›®çš„ä¸ºä¼˜å…ˆåšæ€è€ƒï¼Œä¸ºè‡ªå·±å±•å¼€æ‰€æœ‰è¡Œä¸ºæä¾›æŒ‡å¼•ã€‚</li>
<li>å¯¹å¤šåŠªåŠ›è¿˜å·²æœ‰å¸Œæœ›çš„å›¢é˜Ÿé€‚ç”¨ï¼ŒåŠªåŠ›äº‰å–èµ„æºï¼Œè¯•è¯•èš‚èšå•ƒå¤§è±¡çš„ç­–ç•¥ï¼Œå…ˆåšå‡ºå±€éƒ¨æ”¹å˜ï¼Œå¹¶è®©æ¡æœ‰èµ„æºçš„äººçœ‹åˆ°ï¼Œå¹¶é€æ¸æŠŠæ‰€æœ‰ç›¸å…³äººå‘˜å…¨éƒ¨æ‹‰å…¥è§£å†³é—®é¢˜çš„åœˆå­é‡Œæ¥ï¼Œè®©æˆ‘é‡åˆ°çš„é—®é¢˜è½¬åŒ–æˆå¤§å®¶éƒ½è¦é¢å¯¹çš„é—®é¢˜ã€‚</li>
<li>è°çš„é—®é¢˜ï¼Œå°±æ˜¯è°çš„é—®é¢˜ã€‚å¯¹æ‰€æœ‰ä¸ç¬¦åˆäº§å“æ‰€æœ‰è¦æ±‚çš„èƒ½åŠ›åŸºå‡†çº¿ä»¥ä¸‹çš„äººï¼Œæ•¦ä¿ƒå…¶ä¸»åŠ¨å­¦ä¹ ï¼Œé€šè¿‡é›†ä¸­åŸ¹è®­ç­‰æ–¹å¼ä¿ƒè¿›å…¶æé«˜ï¼Œå¹¶å¯¹åœ¨è§„å®šæ—¶é—´ä»ä¸è¾¾æ ‡çš„äººå®æ–½è½¬å²—ã€åŠé€€ç­‰æªæ–½ã€‚</li>
<li>æ‹›ç¬¦åˆå›¢é˜Ÿç´ è´¨è¦æ±‚çš„äººï¼Œå®ç¼ºæ¯‹æ»¥ï¼Œå¦‚æœä¸èƒ½åˆå¿«åˆå¥½ï¼Œä¼˜å…ˆé€‰æ‹©å¥½ã€‚å½“ç„¶é€‚å¯è€Œæ­¢ã€‚</li>
</ol>
<p><strong>åœ¨å›¢é˜Ÿç»„å»ºçš„åˆæœŸå°±è¦æ‹¿åˆ°ä¸¤æ ·æœ€é‡è¦çš„ä¸œè¥¿ï¼ˆäººäº‹æƒå’Œé’±ï¼‰ï¼Œæœ€åŸºæœ¬çš„è¦æ‹¿åˆ°äººäº‹æƒï¼Œé€‰è°ç”¨è°å¾—è‡ªå·±è¯´äº†ç®—ã€‚åªæ‹›å¤åˆå›¢é˜Ÿç´ è´¨çš„äººï¼Œå®ç¼ºæ¯‹æ»¥ã€‚</strong></p>
]]></content>
      <categories>
        <category>é¡¹ç›®</category>
        <category>å›¢é˜Ÿ</category>
      </categories>
      <tags>
        <tag>é¡¹ç›®</tag>
      </tags>
  </entry>
</search>
