<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="åŸæ–‡ å¦å¤–ä¸€ä¸ªå¯å‚è€ƒçš„ä»“åº“ Protocol Buffers æ˜¯è°·æ­Œæ¨å‡ºçš„ç¼–ç æ ‡å‡†ï¼Œå®ƒåœ¨ä¼ è¾“æ•ˆç‡å’Œç¼–è§£ç æ€§èƒ½ä¸Šéƒ½è¦ä¼˜äº JSONã€‚ä½†å…¶ä»£ä»·åˆ™æ˜¯éœ€è¦ä¾èµ–ä¸­é—´æè¿°è¯­è¨€ï¼ˆIDLï¼‰æ¥å®šä¹‰æ•°æ®ï¼ˆå’ŒæœåŠ¡ï¼‰çš„ç»“æ„ï¼ˆé€šè¿‡  *.proto  æ–‡ä»¶ï¼‰ï¼Œå¹¶ä¸”éœ€è¦ä¸€æ•´å¥—çš„å·¥å…·é“¾ï¼ˆprotoc åŠå…¶æ’ä»¶ï¼‰æ¥ç”Ÿæˆå¯¹åº”çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»£ç ã€‚é™¤äº†è°·æ­Œå®˜æ–¹æä¾›çš„å·¥å…·å’Œæ’ä»¶ï¼ˆæ¯”å¦‚ç”Ÿæˆ go ä»£ç çš„ protoc-gen-goï¼‰å¤–">
<meta property="og:type" content="article">
<meta property="og:title" content="å¦‚ä½•å¼€å‘ protoc æ’ä»¶[è½¬è½½]">
<meta property="og:url" content="http://example.com/2023/03/03/protobuf-plugins/index.html">
<meta property="og:site_name" content="mars315">
<meta property="og:description" content="åŸæ–‡ å¦å¤–ä¸€ä¸ªå¯å‚è€ƒçš„ä»“åº“ Protocol Buffers æ˜¯è°·æ­Œæ¨å‡ºçš„ç¼–ç æ ‡å‡†ï¼Œå®ƒåœ¨ä¼ è¾“æ•ˆç‡å’Œç¼–è§£ç æ€§èƒ½ä¸Šéƒ½è¦ä¼˜äº JSONã€‚ä½†å…¶ä»£ä»·åˆ™æ˜¯éœ€è¦ä¾èµ–ä¸­é—´æè¿°è¯­è¨€ï¼ˆIDLï¼‰æ¥å®šä¹‰æ•°æ®ï¼ˆå’ŒæœåŠ¡ï¼‰çš„ç»“æ„ï¼ˆé€šè¿‡  *.proto  æ–‡ä»¶ï¼‰ï¼Œå¹¶ä¸”éœ€è¦ä¸€æ•´å¥—çš„å·¥å…·é“¾ï¼ˆprotoc åŠå…¶æ’ä»¶ï¼‰æ¥ç”Ÿæˆå¯¹åº”çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»£ç ã€‚é™¤äº†è°·æ­Œå®˜æ–¹æä¾›çš„å·¥å…·å’Œæ’ä»¶ï¼ˆæ¯”å¦‚ç”Ÿæˆ go ä»£ç çš„ protoc-gen-goï¼‰å¤–">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-03-03T15:29:53.000Z">
<meta property="article:modified_time" content="2023-03-08T02:39:14.508Z">
<meta property="article:author" content="mars315">
<meta property="article:tag" content="protobuf">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2023/03/03/protobuf-plugins/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>å¦‚ä½•å¼€å‘ protoc æ’ä»¶[è½¬è½½] | mars315</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="mars315" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">mars315</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-rss">

    <a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/mars315" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/03/protobuf-plugins/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mars315">
      <meta itemprop="description" content="æ—¶å…‰åŒ†åŒ†ï¼Œä¸‡ç‰©å˜å¹»ã€‚</br> è¿™ä¸–é—´ï¼Œæˆ‘æ›¾åœç•™è¿‡ã€‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mars315">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          å¦‚ä½•å¼€å‘ protoc æ’ä»¶[è½¬è½½]
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-03 23:29:53" itemprop="dateCreated datePublished" datetime="2023-03-03T23:29:53+08:00">2023-03-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-03-08 10:39:14" itemprop="dateModified" datetime="2023-03-08T10:39:14+08:00">2023-03-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>9.2k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>8 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><a target="_blank" rel="noopener" href="https://taoshu.in/go/create-protoc-plugin.html">åŸæ–‡</a><br>
<a target="_blank" rel="noopener" href="https://github.com/mars315/protoc-gen-hip">å¦å¤–ä¸€ä¸ªå¯å‚è€ƒçš„ä»“åº“</a></p>
<p>Protocol Buffers æ˜¯è°·æ­Œæ¨å‡ºçš„ç¼–ç æ ‡å‡†ï¼Œå®ƒåœ¨ä¼ è¾“æ•ˆç‡å’Œç¼–è§£ç æ€§èƒ½ä¸Šéƒ½è¦ä¼˜äº JSONã€‚ä½†å…¶ä»£ä»·åˆ™æ˜¯éœ€è¦ä¾èµ–ä¸­é—´æè¿°è¯­è¨€ï¼ˆIDLï¼‰æ¥å®šä¹‰æ•°æ®ï¼ˆå’ŒæœåŠ¡ï¼‰çš„ç»“æ„ï¼ˆé€šè¿‡  <code>*.proto</code>  æ–‡ä»¶ï¼‰ï¼Œå¹¶ä¸”éœ€è¦ä¸€æ•´å¥—çš„å·¥å…·é“¾ï¼ˆprotoc åŠå…¶æ’ä»¶ï¼‰æ¥ç”Ÿæˆå¯¹åº”çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»£ç ã€‚é™¤äº†è°·æ­Œå®˜æ–¹æä¾›çš„å·¥å…·å’Œæ’ä»¶ï¼ˆæ¯”å¦‚ç”Ÿæˆ go ä»£ç çš„ protoc-gen-goï¼‰å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¼€å‘æˆ–å®šåˆ¶è‡ªå·±çš„æ’ä»¶ï¼Œæ ¹æ®ä¸šåŠ¡éœ€è¦æŒ‰ç…§ proto æ–‡ä»¶çš„å®šä¹‰ç”Ÿæˆä»£ç æˆ–è€…æ–‡æ¡£ã€‚ç”± IDL ç”Ÿæˆä»£ç æˆ–è€…æ–‡æ¡£æ˜¯å…ƒç¼–ç¨‹çš„ä¸€ç§å½¢å¼ï¼Œå¯ä»¥æå¤§çš„è§£æ”¾ç¨‹åºå‘˜çš„ç”Ÿäº§åŠ›ï¼Œå»ºè®®æ¯ä¸€ä½å¼€å‘è€…éƒ½èƒ½æŒæ¡è¿™ä¸€æŠ€èƒ½ã€‚ä»Šå¤©å°±ç”Ÿæˆ markdown æ–‡æ¡£ä¸ºä¾‹è®²è§£å¦‚ä½•å¼€å‘ protoc æ’ä»¶ã€‚</p>
<h2 id="protobuf-idl"><a class="markdownIt-Anchor" href="#protobuf-idl"></a> Protobuf IDL</h2>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬ç®€å•è¿‡ä¸€ä¸‹ Protocol Buffers çš„ IDLï¼ˆå…³äºåº•å±‚ç¼–ç å¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« <a target="_blank" rel="noopener" href="https://taoshu.in/pb-encoding.html">Protocol Buffers ç¼–ç </a>ï¼‰ã€‚IDL æ–‡ä»¶çš„æ‰©å±•åä¸º protoï¼Œåé¢æˆ‘ä»¬ç»Ÿç§°ä¸º proto æ–‡ä»¶ï¼Œå…¸å‹çš„ proto æ–‡æ¡£ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// ç›®å‰æœ‰ v2 å’Œ v3 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º v2 ç‰ˆæœ¬ã€‚</span><br><span class="line">// å¦‚æœæƒ³ç”¨ v3 ç‰ˆæœ¬ï¼Œéœ€è¦ä½¿ç”¨ syntax æŒ‡å®šã€‚</span><br><span class="line">// æ¨èä½¿ç”¨ v3 ç‰ˆæœ¬ã€‚ç°åœ¨æµè¡Œçš„ gRPC æ¡†æ¶ä¹Ÿæ˜¯ä½¿ç”¨ v3 ç‰ˆæœ¬ã€‚</span><br><span class="line">syntax = "proto3";</span><br><span class="line"></span><br><span class="line">// æ¯ä¸ª proto æ–‡ä»¶éœ€è¦å®šä¹‰è‡ªå·±çš„åŒ…åï¼Œç±»ä¼¼ c++ çš„åç§°ç©ºé—´ã€‚</span><br><span class="line">package hello;</span><br><span class="line"></span><br><span class="line">// æ•°æ®ç»“æ„é€šè¿‡ message å®šä¹‰</span><br><span class="line">message Echo {</span><br><span class="line">  // æ¯ä¸ª message å¯ä»¥æœ‰å¤šä¸ª fieldã€‚</span><br><span class="line">  // æ¯ä¸ª field éœ€è¦æŒ‡å®šç±»å‹ã€å­—æ®µåå’Œç¼–å·ã€‚</span><br><span class="line">  // Protocol Buffers åœ¨å†…éƒ¨ä½¿ç”¨ç¼–å·åŒºåˆ†å­—æ®µï¼Œä¸€æ—¦æŒ‡å®šå°±ä¸èƒ½æ›´æ”¹ã€‚</span><br><span class="line">  string msg = 1;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// æœåŠ¡ä½¿ç”¨ servcie å®šä¹‰</span><br><span class="line">service Demo {</span><br><span class="line">  // æ¯ä¸ª service å¯ä»¥å®šä¹‰å¤šä¸ª rpc</span><br><span class="line">  // æ¯ä¸ª rpc éœ€è¦æŒ‡å®šæ¥å£åã€ä¼ å…¥æ¶ˆæ¯å’Œè¿”å›æ¶ˆæ¯ä¸‰éƒ¨åˆ†ã€‚</span><br><span class="line">  rpc Echo(Echo) returns (Echo);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>åœ¨ proto æ–‡ä»¶ä¸­ï¼Œ message çš„æ¯ä¸€ä¸ªå­—æ®µä¹Ÿå¯ä»¥æ˜¯å¦å¤–ä¸€ä¸ª messageï¼ˆç”šè‡³è¿˜å¯ä»¥æ˜¯ message æœ¬èº«ï¼Œä¹Ÿå°±æ˜¯é€’å½’å®šä¹‰ï¼‰ã€‚ä¸€ä¸ª proto æ–‡ä»¶è¿˜å¯ä»¥å¯¼å…¥å…¶ä»–çš„ proto æ–‡ä»¶ï¼Œè¿›è€Œå¼•ç”¨æœ¬æ–‡ä»¶å¤–çš„ message å®šä¹‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">syntax = "proto3";</span><br><span class="line"></span><br><span class="line">package demo;</span><br><span class="line"></span><br><span class="line">// é€šè¿‡ import å¯¼å…¥å…¶ä»– proto æ–‡ä»¶</span><br><span class="line">import "google/protobuf/timestamp.proto";</span><br><span class="line"></span><br><span class="line">message Foo {</span><br><span class="line">  // å¼•ç”¨å¤–éƒ¨æ¶ˆæ¯å®šä¹‰æ—¶éœ€è¦æŒ‡å®šåŒ…å</span><br><span class="line">  google.protobuf.Timestamp ts = 2;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">message Bar {</span><br><span class="line">  int32 a = 1;</span><br><span class="line">  // b çš„ç±»å‹å¯ä»¥æ˜¯ Bar è‡ªèº«</span><br><span class="line">  Bar b = 2;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å› ä¸ºå¯ä»¥åœ¨ proto å®šä¹‰æœåŠ¡å’Œæ¥å£æ–¹æ³•ï¼Œ<a target="_blank" rel="noopener" href="https://taoshu.in/grpc.html">gRPC</a>  å’Œ  <a target="_blank" rel="noopener" href="https://taoshu.in/go/go-sniper-v2.html">Sniper</a>  éƒ½ä½¿ç”¨ proto åšä¸º IDLï¼ˆåŒæ—¶ä¹Ÿä½¿ç”¨ Protocol Buffers ç¼–ç ä¼ è¾“æ•°æ®ï¼‰ã€‚ç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ proto æ–‡ä»¶åšä¸ºæ¥å£æ–‡æ¡£ã€‚ä½†å› ä¸º proto æ”¯æŒåµŒå¥—å®šä¹‰å’Œå¤–éƒ¨å¯¼å…¥åŠŸèƒ½ï¼Œè®©ä½¿ç”¨æ–¹ç›´æ¥é˜…è¯» proto æ–‡æ¡£éœ€è¦æ¥å›åˆ‡æ¢ï¼Œéå¸¸ä¸æ–¹ä¾¿ã€‚æ‰€ä»¥æˆ‘ä»¬å†…éƒ¨å¼€äº†ä¸€ä¸ª  <a target="_blank" rel="noopener" href="https://github.com/go-kiss/protoc-gen-markdown">protoc-gen-markdown</a>  æ’ä»¶ï¼Œå…¶åŠŸèƒ½å°±æ˜¯éå†æ‰€æœ‰æœåŠ¡çš„æ¯ä¸€ä¸ªæ¥å£ï¼Œé€’å½’æŸ¥æ‰¾å…¥å‚å’Œå‡ºå‚æ¶ˆæ¯çš„æ¯ä¸€ä¸ªå­—æ®µåŠå…¶ç±»å‹ï¼Œç”Ÿæˆ markdown æ ¼å¼çš„æ¥å£æ–‡æ¡£ã€‚å¤§å®¶å¯ä»¥ç›´æ¥çœ‹è¿™ä¸ªç”Ÿæˆçš„<a target="_blank" rel="noopener" href="https://github.com/go-kiss/protoc-gen-markdown/blob/master/hello.md">ç¤ºä¾‹</a>æ¥æ„Ÿå—ä¸€ä¸‹å®ƒçš„æ•ˆæœã€‚</p>
<p>å¥½äº†ï¼Œä»¥ä¸Šæ˜¯æ•´ä¸ªæ–‡ç« çš„èƒŒæ™¯ã€‚è¯´çš„æœ‰ç‚¹ç½—å—¦ã€‚ç°åœ¨æˆ‘ä»¬å¼€å§‹æ­£é¢˜ã€‚</p>
<h2 id="protoc-plugin-ä½¿ç”¨æ–¹æ³•"><a class="markdownIt-Anchor" href="#protoc-plugin-ä½¿ç”¨æ–¹æ³•"></a> protoc plugin ä½¿ç”¨æ–¹æ³•</h2>
<p>å¦‚æœè¦æ ¹æ® proto æ–‡ä»¶ç”Ÿæˆä»£ç ï¼ˆæˆ–æ–‡æ¡£ï¼‰ï¼Œé¦–å…ˆè¦å®‰è£… protoc ç¼–è¯‘å·¥å…·ã€‚protoc å¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿçš„åŒ…ç®¡ç†å™¨ï¼ˆapt/homebrewç­‰ï¼‰å®‰è£…ï¼Œä¹Ÿå¯ä»¥åˆ° GitHub ä¸Šä¸‹è½½ç¼–è¯‘å¥½çš„ç‰ˆæœ¬ã€‚æ¨èç›´æ¥ä¸‹è½½ï¼Œå› ä¸ºåŒ…ç®¡ç†å™¨å¯èƒ½æ— æ³•å®‰è£…æœ€æ–°ç‰ˆæœ¬ã€‚è§£å‹åæœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼šbin ä¸‹çš„ protoc ç›´æ¥å¤åˆ¶  <code>/usr/local/bin/</code>  ç›®å½•å°±å¥½ï¼Œinclude ä¸‹çš„ google æ–‡ä»¶å¤¹è¦å¤åˆ¶åˆ°  <code>/usr/local/include</code>  ç›®å½•ã€‚</p>
<p>protoc çš„æ’ä»¶æ¡†æ¶ä¹Ÿæ¯”è¾ƒç®€å•ã€‚å¦‚æœè¦å¼€å‘æŸæ’ä»¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å–ä¸ªåå­—ã€‚æ¯”å¦‚è¦ç”Ÿæˆ markdown çš„æ’ä»¶ï¼Œåå­—å°±å®šæˆ markdownã€‚å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨ markdown æ’ä»¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --markdown_out=. hello.proto</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™é‡Œæœ‰ä¸€ä¸ª  <code>--markdown_out</code>  å‚æ•°ã€‚å› ä¸ºæˆ‘ä»¬çš„åå­—å« markdownï¼Œæ‰€ä»¥å‚æ•°åå­—å« markdown_outï¼›å¦‚æœåå­—å« XXXï¼Œé‚£å‚æ•°åå­—å°±å« XXX_outã€‚protoc åœ¨è¿è¡Œçš„æ—¶å€™é¦–å…ˆä¼šè§£æ proto æ–‡ä»¶çš„æ‰€æœ‰å†…å®¹ï¼Œç”Ÿæˆä¸€ç»„ Protocol Buffers ç¼–ç çš„æè¿°æ•°æ®ï¼Œç„¶åå°è¯•è¿è¡Œ protoc-gen-markdown å‘½ä»¤ï¼Œå¹¶ä¸”é€šè¿‡ stdin å°†æè¿°æ•°æ®å‘é€ç»™æ’ä»¶å‘½ä»¤ã€‚æ’ä»¶ç”Ÿæˆå¥½æ–‡ä»¶å†…å®¹åå†å‘ stdout è¾“å…¥ Protocol Buffers ç¼–ç çš„æ•°æ®æ¥å‘Šè¯‰ protoc ç”Ÿæˆå…·ä½“çš„æ–‡ä»¶ã€‚</p>
<p>æ³¨æ„ï¼Œæ’ä»¶çš„å‘½ä»¤å« protoc-gen-<strong>markdown</strong>ï¼Œæ’ä»¶å‘½ä»¤ç»Ÿä¸€ä½¿ç”¨  <code>protoc-gen-</code>  å‰ç¼€ï¼Œè¿™ä¹Ÿæ˜¯ protoc çš„çº¦å®šã€‚</p>
<p>æˆ‘ä»¬åˆšæ‰è¯´ protoc è·Ÿ protoc-gen-XXX é€šä¿¡ç”¨çš„ä¹Ÿæ˜¯ Protocol Buffers ç¼–ç ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹è‡ªä¸¾çš„æ„æ€ã€‚Protocol Buffers ç¼–ç éœ€è¦ proto æ–‡ä»¶å®šä¹‰ï¼Œprotoc è·Ÿæ’ä»¶é€šä¿¡ç”¨çš„ proto æ–‡ä»¶å°±æ˜¯<code>protobuf/descriptor.proto</code>ï¼Œä½ å¯ä»¥åœ¨<code>/usr/include/google</code>æˆ–è€…<code>/usr/local/include/google</code>ç›®å½•ä¸‹æ‰¾åˆ°å®ƒã€‚è€Œä¸”ï¼Œè¿™ä¸ª proto ç”¨çš„æ˜¯ v2 ç‰ˆæœ¬è¯­æ³•ï¼</p>
<h2 id="æ’ä»¶å¼€å‘è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#æ’ä»¶å¼€å‘è¿‡ç¨‹"></a> æ’ä»¶å¼€å‘è¿‡ç¨‹</h2>
<p>ç†è®ºä¸Šï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å¼€å‘ protoc æ’ä»¶äº†ï¼Œè¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ï¼š</p>
<ol>
<li>é€‰æ‹©ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”å¦‚ go</li>
<li>æ ¹æ®  <code>protobuf/descriptor.proto</code>  ç”Ÿæˆå¯¹åº”è¯­è¨€çš„ç¼–è§£ç ä»£ç </li>
<li>å¼€å‘ proto-gen-XXX ç¨‹åº
<ol>
<li>ä» stdin è¯»å–æ•°æ®å¹¶ä½¿ç”¨ç”Ÿæˆçš„ pb æ–‡ä»¶è§£ç </li>
<li>æ ¹æ® descriptor æè¿°æ•°æ®ç”Ÿæˆä»£ç ç‰‡æ–­</li>
<li>æ‹¼è£…æ–°ç”Ÿæˆçš„æ–‡ä»¶æè¿°æ•°æ®å¹¶é€šè¿‡ stdout è¾“å‡º</li>
</ol>
</li>
</ol>
<p>è¿™æ ·åšä¼šæœ‰ä¸¤ä¸ªé—®é¢˜ã€‚</p>
<ol>
<li>ç›´æ¥è¯»å– descriptor æ•°æ®éå¸¸éº»çƒ¦ï¼Œå°±è¿æœ€ç®€å•çš„æŸ¥è¯¢æŸå­—æ®µçš„æ³¨é‡Šè¿™æ ·çš„åŠŸèƒ½éƒ½éœ€è¦éå¸¸å¤æ‚çš„ä»£ç æ‰èƒ½å®ç°ã€‚æ‰€ä»¥è¯´ç›´æ¥å¤„ç† descriptor ç»éæ˜æ™ºä¹‹ä¸¾ã€‚</li>
<li>è¿™äº› descriptor æ•°æ®ä½¿ç”¨ v2 ç‰ˆæœ¬çš„è¯­æ³•ï¼Œprotoc çš„å¥½å¤šè¯­è¨€æ’ä»¶ï¼ˆæ¯”å¦‚ PHPï¼‰å·²ç»ä¸æ”¯æŒ v2 è¯­æ³•äº†ã€‚</li>
</ol>
<p>æ€»ä¹‹ï¼Œæˆ‘ä»¬éœ€è¦æ›´å¥½çš„æ¡†æ¶æ¥å®Œæˆè¿™ä¸€å·¥ä½œã€‚protoc-gen-markdown æ—©æœŸä½¿ç”¨ <a target="_blank" rel="noopener" href="http://github.com/pseudomuto/protokit">github.com/pseudomuto/protokit</a> æ¥ç®€åŒ–å¼€å‘å·¥ä½œã€‚å¯ä»¥æå–æ³¨é‡Šï¼Œä½†ä¸æ”¯æŒç›´æ¥æŸ¥è¯¢å†…åµŒæ¶ˆæ¯çš„ç»“æ„ï¼Œéœ€è¦å¤§é‡çš„è¾…åŠ©ä»£ç ã€‚protoc-gen-markdown çš„ä»£ç ä¹Ÿå¾ˆéš¾ç»´æŠ¤ï¼ˆé™¤äº†æˆ‘å¾ˆå°‘æœ‰äººèƒ½æ”¹ï¼‰ã€‚</p>
<p>ç›´åˆ°å»å¹´ä¸‰æœˆä»½ï¼Œè°·æ­Œå‘å¸ƒäº†<a target="_blank" rel="noopener" href="https://blog.golang.org/protobuf-apiv2">æ–°ç‰ˆ Go è¯­è¨€ API</a>ï¼Œå…¶ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°åŒ…<code>google.golang.org/protobuf/compiler/protogen</code>å¯ä»¥å¤§å¹…ç®€åŒ–æ’ä»¶çš„å¼€å‘ã€‚æˆ‘è¿™ä¸¤å¤©åŸºäº protogen é‡æ„äº† protoc-gen-markdown çš„å®ç°ï¼Œæ‰€æœ‰æ‰å¥½æ„æ€æ‹¿å‡ºæ¥è·Ÿå¤§å®¶åˆ†äº«ğŸ˜­</p>
<h2 id="æ’ä»¶ä»£ç ç»“æ„"><a class="markdownIt-Anchor" href="#æ’ä»¶ä»£ç ç»“æ„"></a> æ’ä»¶ä»£ç ç»“æ„</h2>
<p>æ’ä»¶ä»£ç çš„ä¸»è¦ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func main() {</span><br><span class="line">  g := markdown{}</span><br><span class="line">  var flags flag.FlagSet</span><br><span class="line">  flags.StringVar(&amp;g.Prefix, "prefix", "/", "API path prefix")</span><br><span class="line"></span><br><span class="line">  protogen.Options{</span><br><span class="line">    ParamFunc: flags.Set,</span><br><span class="line">  }.Run(g.Generate)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">func (md *markdown) Generate(plugin *protogen.Plugin) error {</span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ª<code>protogen.Options</code>ï¼Œç„¶åè°ƒç”¨å®ƒçš„<code>Run</code>æ–¹æ³•ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ª  <code>func(*protogen.Plugin) error</code>å›è°ƒã€‚ä¸»æµç¨‹ä»£ç åˆ°æ­¤å°±ç»“æŸäº†ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®<code>protogen.Options</code>çš„<code>ParamFunc</code>å‚æ•°ï¼Œè¿™æ · protogen ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬è§£æå‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°ã€‚è¯¸å¦‚ä»æ ‡å‡†è¾“å…¥è¯»å–å¹¶è§£ç  protobuf ä¿¡æ¯ï¼Œå°†è¾“å…¥ä¿¡æ¯ç¼–ç æˆ protobuf å†™å…¥ stdout ç­‰æ“ä½œå…¨éƒ¨ç”± protogen åŒ…åŠäº†ã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯ä¸  <code>protogen.Plugin</code>  äº¤äº’å®ç°ä»£ç ç”Ÿæˆé€»è¾‘ã€‚å¦‚æœå¤§å®¶å¯¹è¿™ç§ç®€åŒ–æ²¡æœ‰æ¦‚å¿µï¼Œå¯ä»¥å»ç¿»ä¸€ä¸‹ protoc-gen-markdown æœ€åˆçš„ä»£ç ã€‚æ²¡æœ‰å¯¹æ¯”å°±æ²¡æœ‰ä¼¤å®³ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠæ³¨æ„åŠ›è½¬å‘  <code>Generate</code>  æ–¹æ³•ã€‚è¯»ä»£ç ï¼ˆå°¤å…¶æ˜¯è¯»åˆ«äººçš„ä»£ç ï¼‰æ˜¯æ¯ç‡¥çš„ï¼Œæˆ‘å°½é‡è¯´æ€è·¯ã€‚</p>
<h2 id="å¤„ç†-proto-æ–‡ä»¶"><a class="markdownIt-Anchor" href="#å¤„ç†-proto-æ–‡ä»¶"></a> å¤„ç† proto æ–‡ä»¶</h2>
<p>è¦æƒ³ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯è¦éå†æ¯ä¸€ä¸ª proto æ–‡ä»¶çš„æ¯ä¸€ä¸ª service çš„æ¯ä¸€ä¸ª rpc å®šä¹‰ï¼Œæ‰€ä»¥ä¸»æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">func (md *markdown) Generate(plugin *protogen.Plugin) error {</span><br><span class="line">  for _, f := range plugin.Files {</span><br><span class="line">    // è·³è¿‡æ²¡æœ‰å®šä¹‰ service çš„ proto æ–‡ä»¶</span><br><span class="line">    if len(f.Services) == 0 {</span><br><span class="line">      continue</span><br><span class="line">    }</span><br><span class="line">    // æŒ‡å®šè¦ç”Ÿæˆçš„æ–‡ä»¶åï¼Œç­–ç•¥å¯ä»¥æ ¹æ®éœ€è¦æŒ‡å®š</span><br><span class="line">    fname := f.GeneratedFilenamePrefix + ".md"</span><br><span class="line">    // å‘Šè¯‰ protoc è¦ç”Ÿæˆä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå¹¶è·å–ä¸€ä¸ªå¼•ç”¨</span><br><span class="line">    // åé¢å¯ä»¥é€šè¿‡ t æ¥å†™å…¥æ–°æ–‡ä»¶çš„å†…å®¹</span><br><span class="line">    t := plugin.NewGeneratedFile(fname, f.GoImportPath)</span><br><span class="line">    // éå†æ¯ä¸€ä¸ª service</span><br><span class="line">    for _, s := range f.Services {</span><br><span class="line">      // ...</span><br><span class="line">      for _, m := range s.Methods {</span><br><span class="line">        // ...</span><br><span class="line">      }</span><br><span class="line">      // ...</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å¯¹äº proto çš„æ¯ä¸€çº§ç»“æ„ï¼Œprotogen éƒ½æœ‰å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ File, Service, Method, Fieldã€‚é™¤äº† File å¤–ï¼Œå…¶ä»–æ•°æ®ç±»å‹éƒ½æœ‰ Comments å±æ€§ï¼Œæ¯ä¸ª Comments åˆåŒ…å« LeadingDetached, Leading, Trailing ä¸‰ç§ç±»å‹çš„æ³¨é‡Šï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// LeadingDetached</span><br><span class="line"></span><br><span class="line">// Leading</span><br><span class="line">message Foo {} // Trailing</span><br></pre></td></tr></tbody></table></figure>
<p>ç”Ÿæˆæ–‡æ¡£å°±éœ€è¦æ°å½“å¤„ç†è¿™äº›æ³¨é‡Šã€‚è€Œæ³¨é‡Šè·Ÿè¢«æè¿°å¯¹è±¡çš„å…³è”å…³ç³» protogen å·²ç»å¸®æˆ‘ä»¬å¤„ç†å¥½äº†ã€‚</p>
<p>é™¤äº†æ³¨é‡Šï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¯»å–æ›´å¤šä¿¡æ¯ï¼Œæ¯”å¦‚æ¶ˆæ¯æˆ–è€…å­—æ®µçš„åå­—ã€ç±»å‹ç­‰ï¼Œè¿™äº›éœ€è¦é€šè¿‡æ¯ä¸ªå¯¹è±¡çš„ Desc å­—æ®µè¯»å–ï¼Œå®ƒçš„ç±»å‹æ˜¯ protoreflect.ServiceDescriptorï¼Œè·Ÿæˆ‘ä»¬å‰é¢è¯´çš„ descriptor.proto å¯¹åº”ã€‚</p>
<h2 id="ç”Ÿæˆæ–‡æ¡£"><a class="markdownIt-Anchor" href="#ç”Ÿæˆæ–‡æ¡£"></a> ç”Ÿæˆæ–‡æ¡£</h2>
<p>ç”Ÿæˆçš„æ–‡æ¡£ç»“æ„å¦‚ä¸‹ï¼Œé€»è¾‘è§æ³¨é‡Šï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">for _, s := range f.Services {</span><br><span class="line">  // è¾“å‡º service åç§°</span><br><span class="line">  t.P("# ", s.Desc.Name())</span><br><span class="line">  t.P()</span><br><span class="line">  // è¾“å‡º service çš„æ³¨é‡Š</span><br><span class="line">  t.P(string(s.Comments.Leading))</span><br><span class="line">  // ç”Ÿæˆæ¥å£ç›®å½•</span><br><span class="line">  for _, m := range s.Methods {</span><br><span class="line">    // ...</span><br><span class="line">    t.P(fmt.Sprintf("- [%s](#%s)", api, anchor))</span><br><span class="line">  }</span><br><span class="line">  t.P()</span><br><span class="line">  for _, m := range s.Methods {</span><br><span class="line">    // è¾“å‡ºæ¥å£è·¯å¾„</span><br><span class="line">    t.P("## ", md.api(string(m.Desc.FullName())))</span><br><span class="line">    t.P()</span><br><span class="line">    // è¾“å‡ºæ¥å£æ³¨é‡Š</span><br><span class="line">    t.P(string(m.Comments.Leading))</span><br><span class="line">    t.P()</span><br><span class="line">    // è¾“å‡ºå…¥å‚ç»“æ„ï¼Œjson æ ¼å¼</span><br><span class="line">    t.P("### Request")</span><br><span class="line">    // è¯­è¨€æŒ‡å®šä¸º javacriptï¼Œè¿™æ ·å¯ä»¥åœ¨ json é‡ŒåŠ å…¥æ³¨é‡Šå†…å®¹</span><br><span class="line">    t.P("```javascript")</span><br><span class="line">    // æ¯ä¸ª method éƒ½æœ‰ Input å’Œ Output ä¸¤ä¸ªå­—æ®µ</span><br><span class="line">    t.P(md.jsDocForMessage(m.Input))</span><br><span class="line">    t.P("```")</span><br><span class="line">    t.P()</span><br><span class="line">    // è¾“å‡ºå…¥å‚ç»“æ„ï¼Œjson æ ¼å¼</span><br><span class="line">    t.P("### Reply")</span><br><span class="line">    t.P("```javascript")</span><br><span class="line">    t.P(md.jsDocForMessage(m.Output))</span><br><span class="line">    t.P("```")</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æˆ‘ä»¬æ˜¯æƒ³ç”¨ json è¡¨ç¤ºæ¯ä¸€ä¸ª Protocol Buffers ç»“æ„ã€‚ä½† json ä¸èƒ½æ·»åŠ æ³¨é‡Šï¼Œæ‰€ä»¥æˆ‘æŠŠè¯­è¨€æŒ‡å®šä¸º javacriptï¼Œè¿™æ ·æ—¢èƒ½ä½¿ç”¨ json åˆèƒ½åŠ å­—æ®µæ³¨é‡Šäº†ã€‚ä½†ä¸ºä»€ä¹ˆç”¨ json å‘¢ï¼Ÿå› ä¸º Protocol Buffers å®˜æ–¹å®šä¹‰äº† json çš„è¡¨ç¤ºæ ¼å¼ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡æ¡†æ¶åŒæ—¶æ”¯æŒ protobuf å’Œ json ä¸¤ç§ç¼–ç ã€‚ä½¿ç”¨ json è¡¨è¾¾ä¸ä¼šä¸¢å¤±å®šä¹‰ä¿¡æ¯ï¼Œè€Œä¸”é˜…è¯»ä¹Ÿç¨å¾®æ–¹ä¾¿ä¸€äº›ã€‚</p>
<p>æ¯ä¸ª method éƒ½æœ‰ Input å’Œ Output ä¸¤ä¸ªå­—æ®µï¼Œåˆ†åˆ«è¡¨ç¤ºæ¥å£çš„å…¥å‚å’Œå‡ºå‚ã€‚ä¸‹é¢å¼€å§‹è®¨è®ºå¦‚ä½•æå–æ¯ä¸ªå­—æ®µçš„ä¿¡æ¯ã€‚</p>
<h3 id="markdown-æ–‡æ¡£æ•ˆæœ"><a class="markdownIt-Anchor" href="#markdown-æ–‡æ¡£æ•ˆæœ"></a> markdown æ–‡æ¡£æ•ˆæœ</h3>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•è¯´ä¸€ä¸‹ markdown æ¶ˆæ¯è¾“å‡ºæ•ˆæœï¼ˆè¿™éƒ¨åˆ†æ˜¯æˆ‘è‡ªå·±å®šä¹‰çš„ï¼Œä»…ä¾›å¤§å®¶å‚è€ƒï¼‰ã€‚</p>
<p>å¯¹äºç®€å•ç±»å‹å­—æ®µï¼Œæ¯”å¦‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// å­—æ®µæ³¨é‡Š</span><br><span class="line">int32 a = 1; // è¡Œå°¾æ³¨é‡Š</span><br><span class="line">double b = 2;</span><br><span class="line">string c = 3;</span><br></pre></td></tr></tbody></table></figure>
<p>æˆ‘ä¼šè½¬æ¢æˆï¼ˆè¿™æ˜¯åˆæ³•çš„ javascript ä»£ç ï¼Œç±» jsonï¼‰</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// å­—æ®µæ³¨é‡Š</span><br><span class="line">a: 0, // type&lt;int32&gt;, è¡Œå°¾æ³¨é‡Š</span><br><span class="line">b: 0.0,</span><br><span class="line">c: "",</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ç±»å‹æ˜ å°„"><a class="markdownIt-Anchor" href="#ç±»å‹æ˜ å°„"></a> ç±»å‹æ˜ å°„</h3>
<p>å­—æ®µåä¿æŒä¸å˜ï¼Œå­—æ®µå€¼æ ¹æ®ç±»å‹è‡ªåŠ¨ç”Ÿæˆï¼Œä¸€èˆ¬å–å¯¹åº”çš„ç±»å‹çš„ç©ºå€¼ï¼ˆæ•´æ•°ç±»çš„ä¸º  <code>0</code>ï¼Œå­—ç¬¦ä¸²ä¸º  <code>""</code>ï¼Œå¸ƒå°”å€¼ä¸º  <code>false</code>ï¼Œæµ®ç‚¹æ•°ä¸º  <code>0.0</code>  ç­‰ï¼Œä½† 64 ä½æ•´æ•°å¯¹åº”  <code>"0"</code>ï¼Œè¿™ä¸ªä¹Ÿæ˜¯éµå®ˆ Protocol Buffers ä¸ json çš„å®˜æ–¹æ˜ å°„è§„åˆ™ï¼‰ã€‚</p>
<p>ç„¶åä¼šç»™æ¯ä¸ªå­—æ®µæ·»åŠ ç±»å‹æ³¨é‡Šï¼Œæ ¼å¼æ˜¯<code>type&lt;T&gt;</code>ï¼Œè¿™é‡Œçš„ T å¯¹åº” proto æ–‡ä»¶çš„ç±»å‹å£°æ˜ã€‚å¦‚æœ proto å­—æ®µæœ¬èº«ä¹Ÿæœ‰è¡Œä¸ºæ³¨é‡Šï¼Œåˆ™ä¼šè¿½åŠ åˆ°ç±»å‹æ³¨é‡Šä¹‹åã€‚</p>
<h4 id="message"><a class="markdownIt-Anchor" href="#message"></a> message</h4>
<p>å¦‚æœå­—æ®µçš„ç±»å‹æ˜¯ messageï¼Œåˆ™ä¼šè½¬æ¢æˆ json çš„ object è¯­æ³•ï¼Œå¹¶ä¸”ç±»å‹æ³¨é‡Š<code>type&lt;MessageName&gt;</code>ã€‚æ¶ˆæ¯çš„æ¯ä¸ªå­—æ®µä¼šæŒ‰ç…§å‰é¢è¯´çš„å­—æ®µè§„åˆ™è½¬æ¢ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Foo a = 1;</span><br></pre></td></tr></tbody></table></figure>
<p>ä¼šå˜æˆï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a: {</span><br><span class="line">  // ...</span><br><span class="line">} // type&lt;Foo&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="repeated"><a class="markdownIt-Anchor" href="#repeated"></a> repeated</h4>
<p>å¦‚æœæ˜¯ repeated ç±»å‹çš„å­—æ®µï¼Œåˆ™ä¼šåœ¨è½¬æ¢ä¹‹åçš„ç»“æœä¸¤ä¾§æ·»åŠ <code>[]</code>ï¼Œç„¶åå†è¿½åŠ ç±»å‹æ³¨é‡Š<code>list&lt;T&gt;</code>ã€‚è¿™é‡Œ T å¯ä»¥æ˜¯æ™®é€šç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ message ç±»å‹ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">repeated int32 a = 1;</span><br><span class="line">repeated Foo b = 2;</span><br></pre></td></tr></tbody></table></figure>
<p>ä¼šå˜æˆï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a: [</span><br><span class="line">  0</span><br><span class="line">], // list&lt;int32&gt;</span><br><span class="line">b: [{</span><br><span class="line">  // ...</span><br><span class="line">}], // list&lt;Foo&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="map"><a class="markdownIt-Anchor" href="#map"></a> map</h4>
<p>å¦‚æœæ˜¯ map ç±»å‹çš„å­—æ®µï¼ŒåŒæ ·ä¹Ÿä¼šè½¬æ¢æˆ javascript çš„ object è¯­æ³•ï¼Œä½† key ä¼šä½¿ç”¨å­—ç¬¦ä¸²ï¼Œkey å’Œ value çš„å€¼éƒ½ä½¿ç”¨å¯¹åº”ç©ºå€¼ã€‚åŒæ—¶ä¼šè¿½åŠ ç±»å‹æ³¨é‡Š<code>map&lt;k,v&gt;</code>ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map&lt;int32,string&gt; a = 1;</span><br></pre></td></tr></tbody></table></figure>
<p>ä¼šè½¬æ¢æˆ</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a: {</span><br><span class="line">  "0": ""</span><br><span class="line">}, // map&lt;in32,string&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="enum"><a class="markdownIt-Anchor" href="#enum"></a> enum</h4>
<p>protoc-gen-markdown å¯¹äºæšä¸¾ç±»å‹ä¼šç›´æ¥è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå€¼ä¸ºæšä¸¾çš„é»˜è®¤å€¼ï¼ˆé›¶å€¼ï¼‰ï¼ŒåŒæ—¶è¿½åŠ ç±»å‹æ³¨é‡Š<code>enum&lt;E1,E2,...&gt;</code>ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">enum Platform {</span><br><span class="line">  All = 0;</span><br><span class="line">  Web = 1;</span><br><span class="line">  Ios = 2;</span><br><span class="line">  Android = 3;</span><br><span class="line">}</span><br><span class="line">Platform a = 1;</span><br></pre></td></tr></tbody></table></figure>
<p>ä¼šè½¬åŒ–æˆï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a: "All", // enum&lt;All,Web,Ios,Android&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="é€’å½’å¤„ç†"><a class="markdownIt-Anchor" href="#é€’å½’å¤„ç†"></a> é€’å½’å¤„ç†</h3>
<p>å› ä¸º proto æ”¯æŒåµŒå¥—å®šä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»æœ€å¤–å±‚çš„ message å¼€å§‹<strong>é€’å½’å¤„ç†</strong>æ‰€æœ‰å­—æ®µã€‚</p>
<p>å¯¹äºæ¯ä¸€ä¸ª messageï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">func (md *markdown) jsDocForMessage(m *protogen.Message) string {</span><br><span class="line">  js := "{\n"</span><br><span class="line">  for _, field := range m.Fields {</span><br><span class="line">    js += md.jsDocForField(field)</span><br><span class="line">  }</span><br><span class="line">  js += "}"</span><br><span class="line">  return js</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸»è¦æ˜¯ç”Ÿæˆæœ€å¤–é¢çš„â€{}â€œï¼Œç„¶åæ˜¯å¤„ç†æ¯ä¸€ä¸ªå­—æ®µã€‚<code>jsDocForField</code>çš„æ•´ä½“ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">func (md *markdown) jsDocForField(field *protogen.Field) string {</span><br><span class="line">  // è¿½åŠ å­—æ®µæ³¨é‡Š</span><br><span class="line">  js := field.Comments.Leading.String()</span><br><span class="line">  // ç”Ÿæˆå­—æ®µå</span><br><span class="line">  js += string(field.Desc.Name()) + ":"</span><br><span class="line">  // ç¡®å®šå­—æ®µå€¼çš„å–å€¼å’Œç±»å‹</span><br><span class="line">  var vv,vt string</span><br><span class="line">  if field.Desc.IsMap() {</span><br><span class="line">  } else if field.Message != nil {</span><br><span class="line">  } else if field.Enum != nil {</span><br><span class="line">  } else if field.Oneof != nil {</span><br><span class="line">  } else {</span><br><span class="line">  }</span><br><span class="line">  // æ·»åŠ ç±»å‹æ³¨é‡Š</span><br><span class="line">  if field.Desc.IsList() {</span><br><span class="line">    js += fmt.Sprintf("[%s], // list&lt;%s&gt;", vv, vt)</span><br><span class="line">  } else if field.Desc.IsMap() {</span><br><span class="line">    js += vv + fmt.Sprintf(", // map&lt;%s&gt;", vt)</span><br><span class="line">  } else if field.Enum != nil {</span><br><span class="line">    js += vv + fmt.Sprintf(", // enum&lt;%s&gt;", vt)</span><br><span class="line">  } else {</span><br><span class="line">    js += vv + fmt.Sprintf(", // type&lt;%s&gt;", vt)</span><br><span class="line">  }</span><br><span class="line">  // è¿½åŠ è¡Œå°¾æ³¨é‡Š</span><br><span class="line">  return js</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å¯¹äºç®€å•å­—æ®µï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨  <code>scalarDefaultValue</code>  ç¡®å®šé»˜è®¤å€¼ã€‚è€Œå¯¹åº”çš„ç±»å‹å¯ä»¥ç›´æ¥é€šè¿‡<code>field.Desc.Kind().String()</code>  è·å–ã€‚è¿™ä¸ªæ¯”è¾ƒç®€å•ã€‚</p>
<p>Protocol Buffers åœ¨å†…éƒ¨ä¼šæŠŠ map è½¬æ¢æˆä¸‹é¢è¿™æ ·çš„ messageï¼Œ</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">message MapFieldEntry {</span><br><span class="line">  key_type key = 1;</span><br><span class="line">  value_type value = 2;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå¤„ç† map ç±»å‹çš„å­—æ®µï¼Œå†å¤„ç† message ç±»å‹çš„å­—æ®µã€‚protogen æä¾›äº†  <code>IsMap</code>  æ–¹æ³•ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚å¦‚æœ  <code>IsMap</code>  è¿”å›  <code>false</code>ï¼Œè€Œ  <code>filed.Message</code>  ä¸ä¸º  <code>nil</code>ï¼Œé‚£æ‰ message ç±»å‹å­—æ®µã€‚</p>
<p>å¯¹äº message ç±»å‹çš„å­—æ®µä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥é€’å½’è°ƒç”¨  <code>jsDocForMessage</code>  è·å–å–å€¼çš„ json è¡¨ç¤ºï¼Œå…¶ç±»å‹å¯ä»¥é€šè¿‡<code>field.Message.Desc.Name()</code>è·å¾—ã€‚</p>
<p>å¦‚æœæ˜¯ map ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡  <code>.Message</code>  å­—æ®µå–åˆ°  <code>MapFieldEntry</code>  æ¶ˆæ¯ã€‚ç„¶åæ ¹æ®<code>Fields[0]</code>å’Œ<code>Fields[1]</code>æ„é€  map çš„å–å€¼å’Œç±»å‹ã€‚</p>
<p>å¯¹äº Enum ç±»å‹ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡  <code>.Enum</code>  è¯»å–ç›¸å…³ä¿¡æ¯ï¼Œä¹Ÿæ¯”è¾ƒç®€å•ã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬éœ€è¦ç¾åŒ–ä¸€ä¸‹ json çš„æ ¼å¼ï¼Œä¸»è¦æ˜¯è°ƒæ•´ç¼©è¿›ã€‚æœ¬èº«å¤„ç† protogen æ¶ˆæ¯å·²ç»å¾ˆå¤æ‚äº†ï¼Œå¦‚æœè¿˜è¦æ‰‹å·¥ç»´æŠ¤ç¼©è¿›åªä¼šéš¾ä¸ŠåŠ éš¾ã€‚äºæ˜¯æˆ‘æ‰¾äº†ä¸€ä¸ª go è¯­è¨€å®ç°çš„ javascript æ ¼å¼åŒ–åº“ jsbeautifierï¼Œåœ¨æ¶ˆæ¯è¿”å›ä¹‹å‰ç»Ÿä¸€æ ¼å¼åŒ–ä¸€ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">options := jsbeautifier.DefaultOptions()</span><br><span class="line">js, _ = jsbeautifier.Beautify(&amp;js, options)</span><br></pre></td></tr></tbody></table></figure>
<p>å› ä¸ºæˆ‘ä»¬æ˜¯é€’å½’å®ç°çš„ï¼Œå¦‚æœåœ¨ proto æ–‡ä»¶ä¸­ä½¿ç”¨äº†é€’å½’å®šä¹‰ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">message Foo {</span><br><span class="line">  int32 a = 1;</span><br><span class="line">  Foo b = 2;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="é€’å½’å®šä¹‰æ¶ˆæ¯"><a class="markdownIt-Anchor" href="#é€’å½’å®šä¹‰æ¶ˆæ¯"></a> é€’å½’å®šä¹‰æ¶ˆæ¯</h4>
<p>ä¸åŠ å¤„ç†çš„è¯ä¼šå¯¼è‡´æ ˆæº¢å‡ºé”™è¯¯ã€‚ä¸ºæ­¤ï¼Œæˆ‘ç»´æŠ¤äº†ä¸€ä¸ªæ ˆï¼Œä¿å­˜å½“å‰æ­£åœ¨å¤„ç†æ¶ˆæ¯ã€‚å¦‚æœç¢°åˆ°é€’å½’å®šä¹‰ï¼Œåˆ™ç›´æ¥è¿”å›<code>{}</code>ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œåˆšæ‰çš„å®šä¹‰ä¼šè½¬åŒ–æˆï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  a: 0,</span><br><span class="line">  b: {}, // type&lt;Foo&gt;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h2>
<p>ä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹äº†ã€‚æœ¬æ–‡å®šä¹‰äº†ä¸€å¥—ä» proto ç”Ÿæˆ markdown æ–‡æ¡£çš„è§„åˆ™å¹¶åŸºäºæœ€æ–°çš„<code>google.golang.org/protobuf/compiler/protogen</code>åŒ…å®ç°äº† protoc-gen-markdown æ’ä»¶ã€‚é˜…è¯»æœ¬æ–‡å’Œ protoc-gen-markdown æºç ï¼Œå¯ä»¥æŒæ¡ protoc æ’ä»¶å¼€å‘çš„åŸºç¡€çŸ¥è¯†ã€‚å¸Œæœ›æ¯ä¸€ä½è¯»è€…éƒ½èƒ½æŒæ¡è¿™ä¸€æŠ€èƒ½ã€‚</p>
<p>ä»Šå¤©(2022-05-12)æ”¶åˆ° knight0zh çš„ç•™è¨€ï¼š</p>
<blockquote>
<p>å¦‚æœæ¯æ¬¡è°ƒè¯•éƒ½éœ€è¦ç¼–è¯‘ä¸€ä¸‹ä¼šç‰¹åˆ«éº»çƒ¦ï¼Œä¹Ÿæ— æ³•ä½¿ç”¨debugç­‰å·¥å…·</p>
</blockquote>
<p>è¿™æ˜¯ä¸€ä¸ªå¥½é—®é¢˜ã€‚å› ä¸ºæ’ä»¶æ˜¯é€šè¿‡ protoc è°ƒç”¨çš„ï¼Œæ²¡æœ‰ç‰¹åˆ«å¥½çš„æ–¹å¼æ¥å®ç°å•æ­¥è°ƒè¯•ã€‚</p>
<p>æˆ‘ä¸€ç›´ä½¿ç”¨ print å¤§æ³•ã€‚ä¸è¿‡ä½ ä¸èƒ½ç›´æ¥æ‰“å°è°ƒè¯•ä¿¡æ¯ï¼Œè¿™ä¼šå½±å“ protoc è·Ÿæ’ä»¶ä¹‹å‰çš„é€šä¿¡ã€‚æ­£ç¡®çš„åšæ³•æ˜¯æ‰“å°åˆ°<code>stderr</code>æµã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Fprintf(os.Stderr, "Fprintln: %v\n", err)</span><br></pre></td></tr></tbody></table></figure>
    </div>

    
    
    
        

  <div class="followme">
    <p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/protobuf/" rel="tag"># protobuf</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/12/21/gameserver/" rel="prev" title="æ¸¸æˆæœåŠ¡å™¨å¼€å‘ä¸è¿ç»´">
      <i class="fa fa-chevron-left"></i> æ¸¸æˆæœåŠ¡å™¨å¼€å‘ä¸è¿ç»´
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  
  <div class="comments">
    <script src="https://giscus.app/client.js"
        data-repo="mars315/mars315.github.io" 
        data-repo-id="MDEwOlJlcG9zaXRvcnkzNzA2MTk2NTM=" 
        data-category="General"
        data-category-id="DIC_kwDOFhc1Bc4COdCX"
        data-mapping="pathname" 
        data-reactions-enabled="1" 
        data-emit-metadata="0" 
        data-theme="light"
        data-lang="zh-CN"
        crossorigin="anonymous"
        data-input-position="bottom"
        data-loading="lazy"
        async>
    </script>
  </div>
  
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#protobuf-idl"><span class="nav-number">1.</span> <span class="nav-text"> Protobuf IDL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#protoc-plugin-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text"> protoc plugin ä½¿ç”¨æ–¹æ³•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B"><span class="nav-number">3.</span> <span class="nav-text"> æ’ä»¶å¼€å‘è¿‡ç¨‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84"><span class="nav-number">4.</span> <span class="nav-text"> æ’ä»¶ä»£ç ç»“æ„</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%84%E7%90%86-proto-%E6%96%87%E4%BB%B6"><span class="nav-number">5.</span> <span class="nav-text"> å¤„ç† proto æ–‡ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E6%96%87%E6%A1%A3"><span class="nav-number">6.</span> <span class="nav-text"> ç”Ÿæˆæ–‡æ¡£</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#markdown-%E6%96%87%E6%A1%A3%E6%95%88%E6%9E%9C"><span class="nav-number">6.1.</span> <span class="nav-text"> markdown æ–‡æ¡£æ•ˆæœ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E6%98%A0%E5%B0%84"><span class="nav-number">6.2.</span> <span class="nav-text"> ç±»å‹æ˜ å°„</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#message"><span class="nav-number">6.2.1.</span> <span class="nav-text"> message</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#repeated"><span class="nav-number">6.2.2.</span> <span class="nav-text"> repeated</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#map"><span class="nav-number">6.2.3.</span> <span class="nav-text"> map</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#enum"><span class="nav-number">6.2.4.</span> <span class="nav-text"> enum</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%92%E5%BD%92%E5%A4%84%E7%90%86"><span class="nav-number">6.3.</span> <span class="nav-text"> é€’å½’å¤„ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%92%E5%BD%92%E5%AE%9A%E4%B9%89%E6%B6%88%E6%81%AF"><span class="nav-number">6.3.1.</span> <span class="nav-text"> é€’å½’å®šä¹‰æ¶ˆæ¯</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">7.</span> <span class="nav-text"> æ€»ç»“</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="mars315"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">mars315</p>
  <div class="site-description" itemprop="description">æ—¶å…‰åŒ†åŒ†ï¼Œä¸‡ç‰©å˜å¹»ã€‚</br> è¿™ä¸–é—´ï¼Œæˆ‘æ›¾åœç•™è¿‡ã€‚</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>


<!-- CloudCalendar -->
<div class="widget-wrap" style="width: 90%;margin-left: auto;margin-right: auto; opacity: 0.97;">
	<div class="widget" id="CloudCalendar"></div>
</div>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mars315</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">93k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">1:25</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'http://example.com/2023/03/03/protobuf-plugins/',]
      });
      });
  </script>
<!-- calendar widget -->

    <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-calendar/calendar.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-calendar/languages.min.js"></script>
    <script>
    $(function() {
        $('#CloudCalendar').aCalendar('zh-CN',
            $.extend(
                '', {
                    single:true,
                    root:'/calendar/'
                }
            )
        );
    });
    </script>


</body>
</html>
